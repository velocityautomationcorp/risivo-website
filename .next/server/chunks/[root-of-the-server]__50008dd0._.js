module.exports=[93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},20606,e=>{"use strict";class t{accountSid;authToken;baseUrl="https://api.twilio.com/2010-04-01";constructor(e){this.accountSid=e.accountSid,this.authToken=e.authToken}getAuthHeader(){let e=Buffer.from(`${this.accountSid}:${this.authToken}`).toString("base64");return`Basic ${e}`}async request(e,t,s,r=!0){let i,n=`${this.baseUrl}${t}`,o={Authorization:this.getAuthHeader()};s&&r?(o["Content-Type"]="application/x-www-form-urlencoded",i=new URLSearchParams(Object.entries(s).reduce((e,[t,a])=>(null!=a&&(e[t]=String(a)),e),{})).toString()):s&&(o["Content-Type"]="application/json",i=JSON.stringify(s));let c=await fetch(n,{method:e,headers:o,body:i});if(!c.ok){let e=await c.json();throw new a(e.message||"Twilio API error",e.code,c.status)}return c.json()}async createSubaccount(e){return this.request("POST","/Accounts.json",{FriendlyName:e})}async getSubaccount(e){return this.request("GET",`/Accounts/${e}.json`)}async updateSubaccountStatus(e,t){return this.request("POST",`/Accounts/${e}.json`,{Status:t})}async searchAvailableNumbers(e,t,a={}){let s=new URLSearchParams;return a.areaCode&&s.append("AreaCode",a.areaCode),a.contains&&s.append("Contains",a.contains),a.locality&&s.append("InLocality",a.locality),a.region&&s.append("InRegion",a.region),s.append("PageSize",String(a.limit||20)),this.request("GET",`/Accounts/${this.accountSid}/AvailablePhoneNumbers/${e}/${"toll_free"===t?"TollFree":"Local"}.json?${s.toString()}`,void 0,!1)}async purchaseNumber(e,t={}){return this.request("POST",`/Accounts/${this.accountSid}/IncomingPhoneNumbers.json`,{PhoneNumber:e,FriendlyName:t.friendlyName,VoiceUrl:t.voiceUrl,VoiceMethod:t.voiceMethod||"POST",SmsUrl:t.smsUrl,SmsMethod:t.smsMethod||"POST",StatusCallback:t.statusCallbackUrl})}async updateNumber(e,t){return this.request("POST",`/Accounts/${this.accountSid}/IncomingPhoneNumbers/${e}.json`,{FriendlyName:t.friendlyName,VoiceUrl:t.voiceUrl,VoiceMethod:t.voiceMethod,SmsUrl:t.smsUrl,SmsMethod:t.smsMethod,StatusCallback:t.statusCallbackUrl,VoiceApplicationSid:t.voiceApplicationSid,SmsApplicationSid:t.smsApplicationSid})}async releaseNumber(e){await this.request("DELETE",`/Accounts/${this.accountSid}/IncomingPhoneNumbers/${e}.json`)}async listNumbers(e={}){let t=new URLSearchParams;return t.append("PageSize",String(e.pageSize||50)),e.page&&t.append("Page",String(e.page)),this.request("GET",`/Accounts/${this.accountSid}/IncomingPhoneNumbers.json?${t.toString()}`,void 0,!1)}async makeCall(e,t,a){let s={To:e,From:t};return a.url&&(s.Url=a.url),a.twiml&&(s.Twiml=a.twiml),a.statusCallback&&(s.StatusCallback=a.statusCallback),a.statusCallbackMethod&&(s.StatusCallbackMethod=a.statusCallbackMethod),a.statusCallbackEvent&&a.statusCallbackEvent.forEach((e,t)=>{s[`StatusCallbackEvent[${t}]`]=e}),void 0!==a.record&&(s.Record=a.record),a.recordingStatusCallback&&(s.RecordingStatusCallback=a.recordingStatusCallback),a.machineDetection&&(s.MachineDetection=a.machineDetection),a.machineDetectionTimeout&&(s.MachineDetectionTimeout=a.machineDetectionTimeout),a.timeout&&(s.Timeout=a.timeout),this.request("POST",`/Accounts/${this.accountSid}/Calls.json`,s)}async getCall(e){return this.request("GET",`/Accounts/${this.accountSid}/Calls/${e}.json`)}async updateCall(e,t){return this.request("POST",`/Accounts/${this.accountSid}/Calls/${e}.json`,{Url:t.url,Twiml:t.twiml,Status:t.status})}async sendMessage(e,t,a,s={}){let r={To:e,From:t,Body:a};return s.mediaUrl&&s.mediaUrl.forEach((e,t)=>{r[`MediaUrl[${t}]`]=e}),s.statusCallback&&(r.StatusCallback=s.statusCallback),s.messagingServiceSid&&(r.MessagingServiceSid=s.messagingServiceSid),this.request("POST",`/Accounts/${this.accountSid}/Messages.json`,r)}async getUsageRecords(e={}){let t=new URLSearchParams;return e.category&&t.append("Category",e.category),e.startDate&&t.append("StartDate",e.startDate),e.endDate&&t.append("EndDate",e.endDate),this.request("GET",`/Accounts/${this.accountSid}/Usage/Records.json?${t.toString()}`,void 0,!1)}async validateCredentials(){try{return await this.request("GET",`/Accounts/${this.accountSid}.json`),{valid:!0}}catch(e){if(e instanceof a)return{valid:!1,error:e.message};return{valid:!1,error:"Unknown error"}}}}class a extends Error{code;status;constructor(e,t,a){super(e),this.name="TwilioApiError",this.code=t,this.status=a}}let s=new class{masterClient=null;config=null;async initialize(e){this.config=e,this.masterClient=new t({accountSid:e.accountSid,authToken:e.authToken})}getSubaccountClient(e,a){return new t({accountSid:e,authToken:a})}async validateMasterCredentials(e,a){return new t({accountSid:e,authToken:a}).validateCredentials()}async provisionSubaccount(e,t){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{let a,s=await this.masterClient.createSubaccount(e.friendlyName),r={subAccountId:e.subAccountId,twilioAccountSid:s.sid,twilioAuthToken:s.auth_token,friendlyName:s.friendly_name,status:"active",provisionedAt:new Date().toISOString(),canMakeCalls:!0,canSendSms:!1};if(e.autoProvisionPhoneNumber&&this.config?.autoProvisionPhoneNumber)try{let r=await this.purchaseNumberForSubaccount(s.sid,s.auth_token,{subAccountId:e.subAccountId,agencyId:e.agencyId||"",type:e.phoneNumberType||this.config.defaultPhoneNumberType,country:this.config.defaultPhoneNumberCountry,areaCode:e.areaCode||this.config.defaultPhoneNumberAreaCode||void 0,initiatedByUserId:"system"},t);r.success&&r.phoneNumber&&(a=r.phoneNumber)}catch(e){console.error("Failed to auto-provision phone number:",e)}return{success:!0,subaccount:r,phoneNumber:a}}catch(e){if(console.error("Failed to provision subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to provision subaccount"}}}async suspendSubaccount(e,t){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{return await this.masterClient.updateSubaccountStatus(e,"suspended"),{success:!0}}catch(e){if(console.error("Failed to suspend subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to suspend subaccount"}}}async reactivateSubaccount(e){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{return await this.masterClient.updateSubaccountStatus(e,"active"),{success:!0}}catch(e){if(console.error("Failed to reactivate subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to reactivate subaccount"}}}async searchAvailableNumbers(e,t,a={}){if(!this.masterClient)throw Error("Twilio service not initialized");return(await this.masterClient.searchAvailableNumbers(e,t,a)).available_phone_numbers.map(e=>({phoneNumber:e.phone_number,friendlyName:e.friendly_name,locality:e.locality,region:e.region,postalCode:e.postal_code,country:e.iso_country,areaCode:e.phone_number.slice(2,5),capabilities:{voice:e.capabilities.voice,sms:e.capabilities.sms,mms:e.capabilities.mms,fax:e.capabilities.fax},monthlyPrice:"toll_free"===t?2:1,setupPrice:0}))}async purchaseNumberForSubaccount(e,t,s,r){let i=this.getSubaccountClient(e,t);try{let t=await this.searchAvailableNumbers(s.country||"US",s.type,{areaCode:s.areaCode,locality:s.locality,contains:s.contains,limit:1});if(0===t.length)return{success:!1,error:"No phone numbers available matching your criteria"};let a=t[0],n=await i.purchaseNumber(a.phoneNumber,{friendlyName:s.friendlyName||`RISIVO - ${s.subAccountId}`,voiceUrl:`${r}/api/v1/webhooks/twilio/voice`,smsUrl:`${r}/api/v1/webhooks/twilio/sms`,statusCallbackUrl:`${r}/api/v1/webhooks/twilio/status`}),o=this.config?.usageMarkupPercent||5,c=a.monthlyPrice,u={id:"",subAccountId:s.subAccountId,twilioSubaccountId:e,phoneNumber:n.phone_number,phoneNumberSid:n.sid,friendlyName:n.friendly_name,type:s.type,country:a.country,region:a.region,locality:a.locality,areaCode:a.areaCode,isoCountry:a.country,voiceEnabled:n.capabilities.voice,smsEnabled:n.capabilities.sms,mmsEnabled:n.capabilities.mms,faxEnabled:n.capabilities.fax,isPrimary:!0,isDefault:!0,voiceUrl:n.voice_url,voiceMethod:n.voice_method,smsUrl:n.sms_url,smsMethod:n.sms_method,statusCallbackUrl:n.status_callback,assignedFor:s.assignedFor||"all",monthlyFee:c,monthlyFeeWithMarkup:c*(1+o/100),purchasedAt:new Date().toISOString(),purchasePrice:a.setupPrice,paymentStatus:"completed",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return{success:!0,phoneNumber:u}}catch(e){if(console.error("Failed to purchase phone number:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to purchase phone number"}}}async releaseNumber(e,t,s){let r=this.getSubaccountClient(e,t);try{return await r.releaseNumber(s),{success:!0}}catch(e){if(console.error("Failed to release phone number:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to release phone number"}}}async makeCall(e,t,a,s,r,i={}){return this.getSubaccountClient(e,t).makeCall(a,s,{url:i.url||`${r}/api/v1/webhooks/twilio/voice/connect`,twiml:i.twiml,statusCallback:`${r}/api/v1/webhooks/twilio/call-status`,statusCallbackMethod:"POST",statusCallbackEvent:["initiated","ringing","answered","completed"],record:i.record??!0,recordingStatusCallback:`${r}/api/v1/webhooks/twilio/recording-status`,machineDetection:i.machineDetection?"DetectMessageEnd":void 0,machineDetectionTimeout:i.machineDetection?5:void 0,timeout:i.timeout||30})}async endCall(e,t,a){return this.getSubaccountClient(e,t).updateCall(a,{status:"completed"})}async getCallDetails(e,t,a){return this.getSubaccountClient(e,t).getCall(a)}async sendSms(e,t,a,s,r,i,n={}){return this.getSubaccountClient(e,t).sendMessage(a,s,r,{mediaUrl:n.mediaUrl,statusCallback:`${i}/api/v1/webhooks/twilio/message-status`,messagingServiceSid:n.messagingServiceSid})}async getUsageRecords(e,t,a={}){return this.getSubaccountClient(e,t).getUsageRecords(a)}calculateCostWithMarkup(e,t){let a=(t??this.config?.usageMarkupPercent??5)/100*e;return{baseCost:e,markup:a,total:e+a}}};e.s(["twilioService",0,s])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__50008dd0._.js.map