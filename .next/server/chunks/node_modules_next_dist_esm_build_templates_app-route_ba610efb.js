module.exports=[34443,e=>{"use strict";var r=e.i(47909),t=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(14444),o=e.i(37092),d=e.i(69741),l=e.i(16795),c=e.i(87718),u=e.i(95169),m=e.i(47587),p=e.i(66012),_=e.i(70101),v=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(220),R=e.i(89171),w=e.i(89660),b=e.i(75949);async function y(e,{params:r}){try{let{calendarId:e}=await r,t=w.supabaseAdmin,{data:a,error:s}=await t.from("calendars").select("id, calendar_type, name").eq("id",e).single();if(s||!a)return R.NextResponse.json({success:!1,error:"Calendar not found"},{status:404});let{data:n,error:i}=await t.from("calendar_members").select(`
        *,
        users:user_id (id, name, email, avatar_url)
      `).eq("calendar_id",e).order("priority_order",{ascending:!0});if(i)return console.error("Error fetching members:",i),R.NextResponse.json({success:!1,error:"Failed to fetch members"},{status:500});let o=(n||[]).map(e=>({id:e.id,calendarId:e.calendar_id,userId:e.user_id,role:e.role,isPrimaryOwner:e.is_primary_owner,priorityOrder:e.priority_order,weight:e.weight,isActive:e.is_active,canEditCalendar:e.can_edit_calendar,canManageAppointments:e.can_manage_appointments,createdAt:e.created_at,user:e.users?{id:e.users.id,name:e.users.name,email:e.users.email,avatar:e.users.avatar_url}:null})),d=null;if("round_robin"===a.calendar_type){let{data:r}=await t.from("round_robin_assignments").select("*").eq("calendar_id",e).single();r&&(d={lastAssignedUserId:r.last_assigned_user_id,lastAssignedAt:r.last_assigned_at,assignmentCounts:r.assignment_counts||{},periodStart:r.period_start,periodEnd:r.period_end})}return R.NextResponse.json({success:!0,data:{calendarId:e,calendarType:a.calendar_type,calendarName:a.name,members:o,roundRobinStats:d,totalMembers:o.length,activeMembers:o.filter(e=>e.isActive).length}})}catch(e){return console.error("Error in GET /api/v1/calendars/[calendarId]/members:",e),R.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function E(e,{params:r}){try{let{calendarId:t}=await r,a=w.supabaseAdmin,{userId:s,email:n,role:i="member",isPrimaryOwner:o=!1,priorityOrder:d,weight:l=1,isActive:c=!0,canEditCalendar:u=!1,canManageAppointments:m=!0}=await e.json(),p=["owner","member","viewer"];if(!p.includes(i))return R.NextResponse.json({success:!1,error:`Invalid role. Must be one of: ${p.join(", ")}`},{status:400});let _=s;if(!_&&n){let{data:e}=await a.from("users").select("id").eq("email",n).single();if(!e)return R.NextResponse.json({success:!1,error:"User not found with that email"},{status:404});_=e.id}if(!_)return R.NextResponse.json({success:!1,error:"userId or email is required"},{status:400});let{data:v}=await a.from("calendar_members").select("id").eq("calendar_id",t).eq("user_id",_).single();if(v)return R.NextResponse.json({success:!1,error:"User is already a member of this calendar"},{status:409});let f=d;if(void 0===f){let{data:e}=await a.from("calendar_members").select("priority_order").eq("calendar_id",t).order("priority_order",{ascending:!1}).limit(1).single();f=(e?.priority_order||0)+1}let g=(0,b.v4)(),{data:h,error:y}=await a.from("calendar_members").insert({id:g,calendar_id:t,user_id:_,role:i,is_primary_owner:o,priority_order:f,weight:l,is_active:c,can_edit_calendar:u,can_manage_appointments:m}).select(`
        *,
        users:user_id (id, name, email, avatar_url)
      `).single();if(y)return console.error("Error creating member:",y),R.NextResponse.json({success:!1,error:"Failed to add member"},{status:500});let{data:E}=await a.from("calendars").select("calendar_type").eq("id",t).single();if(E?.calendar_type==="round_robin"){let{data:e}=await a.from("round_robin_assignments").select("id").eq("calendar_id",t).single();e||await a.from("round_robin_assignments").insert({calendar_id:t,assignment_counts:{}})}return R.NextResponse.json({success:!0,data:{id:h.id,calendarId:h.calendar_id,userId:h.user_id,role:h.role,isPrimaryOwner:h.is_primary_owner,priorityOrder:h.priority_order,weight:h.weight,isActive:h.is_active,canEditCalendar:h.can_edit_calendar,canManageAppointments:h.can_manage_appointments,createdAt:h.created_at,user:h.users?{id:h.users.id,name:h.users.name,email:h.users.email,avatar:h.users.avatar_url}:null}},{status:201})}catch(e){return console.error("Error in POST /api/v1/calendars/[calendarId]/members:",e),R.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function x(e,{params:r}){try{let{calendarId:t}=await r,a=w.supabaseAdmin,{memberId:s,userId:n,role:i,isPrimaryOwner:o,priorityOrder:d,weight:l,isActive:c,canEditCalendar:u,canManageAppointments:m}=await e.json();if(!s&&!n)return R.NextResponse.json({success:!1,error:"memberId or userId is required"},{status:400});let p={};if(void 0!==i){let e=["owner","member","viewer"];if(!e.includes(i))return R.NextResponse.json({success:!1,error:`Invalid role. Must be one of: ${e.join(", ")}`},{status:400});p.role=i}if(void 0!==o&&(p.is_primary_owner=o),void 0!==d&&(p.priority_order=d),void 0!==l&&(p.weight=l),void 0!==c&&(p.is_active=c),void 0!==u&&(p.can_edit_calendar=u),void 0!==m&&(p.can_manage_appointments=m),0===Object.keys(p).length)return R.NextResponse.json({success:!1,error:"No fields to update"},{status:400});let _=a.from("calendar_members").update(p).eq("calendar_id",t);s?_=_.eq("id",s):n&&(_=_.eq("user_id",n));let{data:v,error:f}=await _.select(`
        *,
        users:user_id (id, name, email, avatar_url)
      `).single();if(f||!v)return console.error("Error updating member:",f),R.NextResponse.json({success:!1,error:"Failed to update member or member not found"},{status:f?500:404});return R.NextResponse.json({success:!0,data:{id:v.id,calendarId:v.calendar_id,userId:v.user_id,role:v.role,isPrimaryOwner:v.is_primary_owner,priorityOrder:v.priority_order,weight:v.weight,isActive:v.is_active,canEditCalendar:v.can_edit_calendar,canManageAppointments:v.can_manage_appointments,createdAt:v.created_at,user:v.users?{id:v.users.id,name:v.users.name,email:v.users.email,avatar:v.users.avatar_url}:null}})}catch(e){return console.error("Error in PUT /api/v1/calendars/[calendarId]/members:",e),R.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function A(e,{params:r}){try{let{calendarId:t}=await r,a=w.supabaseAdmin,{searchParams:s}=new URL(e.url),n=s.get("memberId"),i=s.get("userId");if(!n&&!i)return R.NextResponse.json({success:!1,error:"memberId or userId is required"},{status:400});let o=a.from("calendar_members").select("is_primary_owner").eq("calendar_id",t);n?o=o.eq("id",n):i&&(o=o.eq("user_id",i));let{data:d}=await o.single();if(d?.is_primary_owner)return R.NextResponse.json({success:!1,error:"Cannot remove the primary owner. Transfer ownership first."},{status:400});let l=a.from("calendar_members").delete().eq("calendar_id",t);n?l=l.eq("id",n):i&&(l=l.eq("user_id",i));let{error:c}=await l;if(c)return console.error("Error removing member:",c),R.NextResponse.json({success:!1,error:"Failed to remove member"},{status:500});return R.NextResponse.json({success:!0,message:"Member removed successfully"})}catch(e){return console.error("Error in DELETE /api/v1/calendars/[calendarId]/members:",e),R.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function N(e,{params:r}){try{let{calendarId:t}=await r,a=w.supabaseAdmin,{memberOrder:s}=await e.json();if(!s||!Array.isArray(s))return R.NextResponse.json({success:!1,error:"memberOrder array is required"},{status:400});let n=s.map(({memberId:e,priorityOrder:r})=>a.from("calendar_members").update({priority_order:r}).eq("id",e).eq("calendar_id",t));return await Promise.all(n),R.NextResponse.json({success:!0,message:"Member order updated successfully"})}catch(e){return console.error("Error in PATCH /api/v1/calendars/[calendarId]/members:",e),R.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}e.s(["DELETE",()=>A,"GET",()=>y,"PATCH",()=>N,"POST",()=>E,"PUT",()=>x],57106);var I=e.i(57106);let C=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/v1/calendars/[calendarId]/members/route",pathname:"/api/v1/calendars/[calendarId]/members",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/calendars/[calendarId]/members/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:j,workUnitAsyncStorage:q,serverHooks:T}=C;function P(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:q})}async function O(e,r,a){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/v1/calendars/[calendarId]/members/route";R=R.replace(/\/index$/,"")||"/";let w=await C.prepare(e,r,{srcPage:R,multiZoneDraftMode:!1});if(!w)return r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:b,params:y,nextConfig:E,parsedUrl:x,isDraftMode:A,prerenderManifest:N,routerServerContext:I,isOnDemandRevalidate:j,revalidateOnlyGenerated:q,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:O}=w,M=(0,d.normalizeAppPath)(R),S=!!(N.dynamicRoutes[M]||N.routes[T]),U=async()=>((null==I?void 0:I.render404)?await I.render404(e,r,x,!1):r.end("This page could not be found"),null);if(S&&!A){let e=!!N.routes[T],r=N.dynamicRoutes[M];if(r&&!1===r.fallback&&!e){if(E.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let H=null;!S||C.isDev||A||(H="/index"===(H=T)?"/":H);let D=!0===C.isDev||!S,k=S&&!D;O&&P&&(0,i.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:P,serverActionsManifest:O,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:O})});let F=e.method||"GET",$=(0,n.getTracer)(),K=$.getActiveScopeSpan(),L={params:y,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>C.onRequestError(e,r,a,I)},sharedContext:{buildId:b}},B=new l.NodeNextRequest(e),G=new l.NodeNextResponse(r),V=c.NextRequestAdapter.fromNodeNextRequest(B,(0,c.signalFromNodeResponse)(r));try{let i=async e=>C.handle(V,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=$.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let r=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":r}),e.updateName(r)}else e.updateName(`${F} ${R}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:t})=>{try{if(!o&&j&&q&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let d=L.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=L.renderOpts.collectedTags;if(!S)return await (0,p.sendResponse)(B,G,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),r=(0,_.toNodeOutgoingHttpHeaders)(n.headers);l&&(r[f.NEXT_CACHE_TAGS_HEADER]=l),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:a}}}}catch(r){throw(null==t?void 0:t.isStale)&&await C.onRequestError(e,r,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:j})},I),r}},c=await C.handleResponse({req:e,nextConfig:E,cacheKey:H,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:q,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!S)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||r.setHeader("x-nextjs-cache",j?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,_.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&S||u.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||r.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(B,G,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};K?await d(K):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${R}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},d))}catch(r){if(r instanceof g.NoFallbackError||await C.onRequestError(e,r,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:j})}),S)throw r;return await (0,p.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>P,"routeModule",()=>C,"serverHooks",()=>T,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>q],34443)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ba610efb.js.map