module.exports=[93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},20606,e=>{"use strict";class t{accountSid;authToken;baseUrl="https://api.twilio.com/2010-04-01";constructor(e){this.accountSid=e.accountSid,this.authToken=e.authToken}getAuthHeader(){let e=Buffer.from(`${this.accountSid}:${this.authToken}`).toString("base64");return`Basic ${e}`}async request(e,t,r,n=!0){let s,i=`${this.baseUrl}${t}`,o={Authorization:this.getAuthHeader()};r&&n?(o["Content-Type"]="application/x-www-form-urlencoded",s=new URLSearchParams(Object.entries(r).reduce((e,[t,a])=>(null!=a&&(e[t]=String(a)),e),{})).toString()):r&&(o["Content-Type"]="application/json",s=JSON.stringify(r));let c=await fetch(i,{method:e,headers:o,body:s});if(!c.ok){let e=await c.json();throw new a(e.message||"Twilio API error",e.code,c.status)}return c.json()}async createSubaccount(e){return this.request("POST","/Accounts.json",{FriendlyName:e})}async getSubaccount(e){return this.request("GET",`/Accounts/${e}.json`)}async updateSubaccountStatus(e,t){return this.request("POST",`/Accounts/${e}.json`,{Status:t})}async searchAvailableNumbers(e,t,a={}){let r=new URLSearchParams;return a.areaCode&&r.append("AreaCode",a.areaCode),a.contains&&r.append("Contains",a.contains),a.locality&&r.append("InLocality",a.locality),a.region&&r.append("InRegion",a.region),r.append("PageSize",String(a.limit||20)),this.request("GET",`/Accounts/${this.accountSid}/AvailablePhoneNumbers/${e}/${"toll_free"===t?"TollFree":"Local"}.json?${r.toString()}`,void 0,!1)}async purchaseNumber(e,t={}){return this.request("POST",`/Accounts/${this.accountSid}/IncomingPhoneNumbers.json`,{PhoneNumber:e,FriendlyName:t.friendlyName,VoiceUrl:t.voiceUrl,VoiceMethod:t.voiceMethod||"POST",SmsUrl:t.smsUrl,SmsMethod:t.smsMethod||"POST",StatusCallback:t.statusCallbackUrl})}async updateNumber(e,t){return this.request("POST",`/Accounts/${this.accountSid}/IncomingPhoneNumbers/${e}.json`,{FriendlyName:t.friendlyName,VoiceUrl:t.voiceUrl,VoiceMethod:t.voiceMethod,SmsUrl:t.smsUrl,SmsMethod:t.smsMethod,StatusCallback:t.statusCallbackUrl,VoiceApplicationSid:t.voiceApplicationSid,SmsApplicationSid:t.smsApplicationSid})}async releaseNumber(e){await this.request("DELETE",`/Accounts/${this.accountSid}/IncomingPhoneNumbers/${e}.json`)}async listNumbers(e={}){let t=new URLSearchParams;return t.append("PageSize",String(e.pageSize||50)),e.page&&t.append("Page",String(e.page)),this.request("GET",`/Accounts/${this.accountSid}/IncomingPhoneNumbers.json?${t.toString()}`,void 0,!1)}async makeCall(e,t,a){let r={To:e,From:t};return a.url&&(r.Url=a.url),a.twiml&&(r.Twiml=a.twiml),a.statusCallback&&(r.StatusCallback=a.statusCallback),a.statusCallbackMethod&&(r.StatusCallbackMethod=a.statusCallbackMethod),a.statusCallbackEvent&&a.statusCallbackEvent.forEach((e,t)=>{r[`StatusCallbackEvent[${t}]`]=e}),void 0!==a.record&&(r.Record=a.record),a.recordingStatusCallback&&(r.RecordingStatusCallback=a.recordingStatusCallback),a.machineDetection&&(r.MachineDetection=a.machineDetection),a.machineDetectionTimeout&&(r.MachineDetectionTimeout=a.machineDetectionTimeout),a.timeout&&(r.Timeout=a.timeout),this.request("POST",`/Accounts/${this.accountSid}/Calls.json`,r)}async getCall(e){return this.request("GET",`/Accounts/${this.accountSid}/Calls/${e}.json`)}async updateCall(e,t){return this.request("POST",`/Accounts/${this.accountSid}/Calls/${e}.json`,{Url:t.url,Twiml:t.twiml,Status:t.status})}async sendMessage(e,t,a,r={}){let n={To:e,From:t,Body:a};return r.mediaUrl&&r.mediaUrl.forEach((e,t)=>{n[`MediaUrl[${t}]`]=e}),r.statusCallback&&(n.StatusCallback=r.statusCallback),r.messagingServiceSid&&(n.MessagingServiceSid=r.messagingServiceSid),this.request("POST",`/Accounts/${this.accountSid}/Messages.json`,n)}async getUsageRecords(e={}){let t=new URLSearchParams;return e.category&&t.append("Category",e.category),e.startDate&&t.append("StartDate",e.startDate),e.endDate&&t.append("EndDate",e.endDate),this.request("GET",`/Accounts/${this.accountSid}/Usage/Records.json?${t.toString()}`,void 0,!1)}async validateCredentials(){try{return await this.request("GET",`/Accounts/${this.accountSid}.json`),{valid:!0}}catch(e){if(e instanceof a)return{valid:!1,error:e.message};return{valid:!1,error:"Unknown error"}}}}class a extends Error{code;status;constructor(e,t,a){super(e),this.name="TwilioApiError",this.code=t,this.status=a}}let r=new class{masterClient=null;config=null;async initialize(e){this.config=e,this.masterClient=new t({accountSid:e.accountSid,authToken:e.authToken})}getSubaccountClient(e,a){return new t({accountSid:e,authToken:a})}async validateMasterCredentials(e,a){return new t({accountSid:e,authToken:a}).validateCredentials()}async provisionSubaccount(e,t){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{let a,r=await this.masterClient.createSubaccount(e.friendlyName),n={subAccountId:e.subAccountId,twilioAccountSid:r.sid,twilioAuthToken:r.auth_token,friendlyName:r.friendly_name,status:"active",provisionedAt:new Date().toISOString(),canMakeCalls:!0,canSendSms:!1};if(e.autoProvisionPhoneNumber&&this.config?.autoProvisionPhoneNumber)try{let n=await this.purchaseNumberForSubaccount(r.sid,r.auth_token,{subAccountId:e.subAccountId,agencyId:e.agencyId||"",type:e.phoneNumberType||this.config.defaultPhoneNumberType,country:this.config.defaultPhoneNumberCountry,areaCode:e.areaCode||this.config.defaultPhoneNumberAreaCode||void 0,initiatedByUserId:"system"},t);n.success&&n.phoneNumber&&(a=n.phoneNumber)}catch(e){console.error("Failed to auto-provision phone number:",e)}return{success:!0,subaccount:n,phoneNumber:a}}catch(e){if(console.error("Failed to provision subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to provision subaccount"}}}async suspendSubaccount(e,t){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{return await this.masterClient.updateSubaccountStatus(e,"suspended"),{success:!0}}catch(e){if(console.error("Failed to suspend subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to suspend subaccount"}}}async reactivateSubaccount(e){if(!this.masterClient)return{success:!1,error:"Twilio service not initialized"};try{return await this.masterClient.updateSubaccountStatus(e,"active"),{success:!0}}catch(e){if(console.error("Failed to reactivate subaccount:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to reactivate subaccount"}}}async searchAvailableNumbers(e,t,a={}){if(!this.masterClient)throw Error("Twilio service not initialized");return(await this.masterClient.searchAvailableNumbers(e,t,a)).available_phone_numbers.map(e=>({phoneNumber:e.phone_number,friendlyName:e.friendly_name,locality:e.locality,region:e.region,postalCode:e.postal_code,country:e.iso_country,areaCode:e.phone_number.slice(2,5),capabilities:{voice:e.capabilities.voice,sms:e.capabilities.sms,mms:e.capabilities.mms,fax:e.capabilities.fax},monthlyPrice:"toll_free"===t?2:1,setupPrice:0}))}async purchaseNumberForSubaccount(e,t,r,n){let s=this.getSubaccountClient(e,t);try{let t=await this.searchAvailableNumbers(r.country||"US",r.type,{areaCode:r.areaCode,locality:r.locality,contains:r.contains,limit:1});if(0===t.length)return{success:!1,error:"No phone numbers available matching your criteria"};let a=t[0],i=await s.purchaseNumber(a.phoneNumber,{friendlyName:r.friendlyName||`RISIVO - ${r.subAccountId}`,voiceUrl:`${n}/api/v1/webhooks/twilio/voice`,smsUrl:`${n}/api/v1/webhooks/twilio/sms`,statusCallbackUrl:`${n}/api/v1/webhooks/twilio/status`}),o=this.config?.usageMarkupPercent||5,c=a.monthlyPrice,l={id:"",subAccountId:r.subAccountId,twilioSubaccountId:e,phoneNumber:i.phone_number,phoneNumberSid:i.sid,friendlyName:i.friendly_name,type:r.type,country:a.country,region:a.region,locality:a.locality,areaCode:a.areaCode,isoCountry:a.country,voiceEnabled:i.capabilities.voice,smsEnabled:i.capabilities.sms,mmsEnabled:i.capabilities.mms,faxEnabled:i.capabilities.fax,isPrimary:!0,isDefault:!0,voiceUrl:i.voice_url,voiceMethod:i.voice_method,smsUrl:i.sms_url,smsMethod:i.sms_method,statusCallbackUrl:i.status_callback,assignedFor:r.assignedFor||"all",monthlyFee:c,monthlyFeeWithMarkup:c*(1+o/100),purchasedAt:new Date().toISOString(),purchasePrice:a.setupPrice,paymentStatus:"completed",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return{success:!0,phoneNumber:l}}catch(e){if(console.error("Failed to purchase phone number:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to purchase phone number"}}}async releaseNumber(e,t,r){let n=this.getSubaccountClient(e,t);try{return await n.releaseNumber(r),{success:!0}}catch(e){if(console.error("Failed to release phone number:",e),e instanceof a)return{success:!1,error:e.message};return{success:!1,error:"Failed to release phone number"}}}async makeCall(e,t,a,r,n,s={}){return this.getSubaccountClient(e,t).makeCall(a,r,{url:s.url||`${n}/api/v1/webhooks/twilio/voice/connect`,twiml:s.twiml,statusCallback:`${n}/api/v1/webhooks/twilio/call-status`,statusCallbackMethod:"POST",statusCallbackEvent:["initiated","ringing","answered","completed"],record:s.record??!0,recordingStatusCallback:`${n}/api/v1/webhooks/twilio/recording-status`,machineDetection:s.machineDetection?"DetectMessageEnd":void 0,machineDetectionTimeout:s.machineDetection?5:void 0,timeout:s.timeout||30})}async endCall(e,t,a){return this.getSubaccountClient(e,t).updateCall(a,{status:"completed"})}async getCallDetails(e,t,a){return this.getSubaccountClient(e,t).getCall(a)}async sendSms(e,t,a,r,n,s,i={}){return this.getSubaccountClient(e,t).sendMessage(a,r,n,{mediaUrl:i.mediaUrl,statusCallback:`${s}/api/v1/webhooks/twilio/message-status`,messagingServiceSid:i.messagingServiceSid})}async getUsageRecords(e,t,a={}){return this.getSubaccountClient(e,t).getUsageRecords(a)}calculateCostWithMarkup(e,t){let a=(t??this.config?.usageMarkupPercent??5)/100*e;return{baseCost:e,markup:a,total:e+a}}};e.s(["twilioService",0,r])},33207,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(14444),o=e.i(37092),c=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),h=e.i(66012),m=e.i(70101),g=e.i(26937),b=e.i(10372),y=e.i(93695);e.i(52474);var S=e.i(220),f=e.i(89171),v=e.i(89660),w=e.i(20606);async function C(e){try{let{searchParams:t}=new URL(e.url),a=t.get("agencyId"),r=v.supabaseAdmin.from("AgencyTwilioConfig").select("*");a?r.eq("agencyId",a):r.is("agencyId",null);let{data:n,error:s}=await r.single();if(s&&"PGRST116"!==s.code)throw s;if(n){let e={...n,authToken:n.authToken?"••••••••":null,apiKeySecret:n.apiKeySecret?"••••••••":null,sendgridApiKey:n.sendgridApiKey?"••••••••":null,webhookSecretKey:n.webhookSecretKey?"••••••••":null};return f.NextResponse.json({success:!0,data:e})}return f.NextResponse.json({success:!0,data:null})}catch(e){return console.error("Error fetching Twilio config:",e),f.NextResponse.json({success:!1,error:"Failed to fetch configuration"},{status:500})}}async function T(e){try{let t=await e.json();if(!t.accountSid||!t.authToken)return f.NextResponse.json({success:!1,error:"Account SID and Auth Token are required"},{status:400});let a=await w.twilioService.validateMasterCredentials(t.accountSid,t.authToken);if(!a.valid)return f.NextResponse.json({success:!1,error:`Invalid Twilio credentials: ${a.error}`},{status:400});let{data:r}=await v.supabaseAdmin.from("AgencyTwilioConfig").select("id").is("agencyId",t.agencyId||null).single();if(r)return f.NextResponse.json({success:!1,error:"Configuration already exists. Use PUT to update."},{status:409});let n={platformId:t.agencyId||null,accountSid:t.accountSid,authToken:t.authToken,apiKeySid:t.apiKeySid||null,apiKeySecret:t.apiKeySecret||null,sendgridApiKey:t.sendgridApiKey||null,usageMarkupPercent:t.usageMarkupPercent??5,enableSubaccountBilling:t.enableSubaccountBilling??!0,billingCurrency:t.billingCurrency||"USD",autoProvisionEnabled:t.autoProvisionEnabled??!0,autoProvisionPhoneNumber:t.autoProvisionPhoneNumber??!1,defaultPhoneNumberType:t.defaultPhoneNumberType||"local",defaultPhoneNumberCountry:t.defaultPhoneNumberCountry||"US",defaultPhoneNumberAreaCode:t.defaultPhoneNumberAreaCode||null,webhookBaseUrl:t.webhookBaseUrl||null,smsEnabled:t.smsEnabled??!0,voiceEnabled:t.voiceEnabled??!0,faxEnabled:t.faxEnabled??!1,mmsEnabled:t.mmsEnabled??!0,brandRegistrationEnabled:t.brandRegistrationEnabled??!0,defaultBrandType:t.defaultBrandType||"STANDARD",require10DLCForSms:t.require10DLCForSms??!0,smsBounceWarningThreshold:t.smsBounceWarningThreshold??5,smsBounceSuspendThreshold:t.smsBounceSuspendThreshold??10,smsSpamReportThreshold:t.smsSpamReportThreshold??.1,callAbandonRateWarning:t.callAbandonRateWarning??3,dailySmsLimitDefault:t.dailySmsLimitDefault??1e3,dailyCallLimitDefault:t.dailyCallLimitDefault??500,smsPerSecondLimit:t.smsPerSecondLimit??10,callsPerSecondLimit:t.callsPerSecondLimit??5,isActive:!0,lastValidatedAt:new Date().toISOString()},{data:s,error:i}=await v.supabaseAdmin.from("AgencyTwilioConfig").insert(n).select().single();if(i)throw i;let o={...s,authToken:"••••••••",apiKeySecret:s.apiKeySecret?"••••••••":null,sendgridApiKey:s.sendgridApiKey?"••••••••":null,webhookSecretKey:s.webhookSecretKey?"••••••••":null};return f.NextResponse.json({success:!0,data:o},{status:201})}catch(e){return console.error("Error creating Twilio config:",e),f.NextResponse.json({success:!1,error:"Failed to create configuration"},{status:500})}}async function A(e){try{let t=await e.json();if(!t.id)return f.NextResponse.json({success:!1,error:"Configuration ID is required"},{status:400});let{data:a,error:r}=await v.supabaseAdmin.from("AgencyTwilioConfig").select("*").eq("id",t.id).single();if(r||!a)return f.NextResponse.json({success:!1,error:"Configuration not found"},{status:404});let n=t.accountSid||a.accountSid,s=t.authToken&&"••••••••"!==t.authToken?t.authToken:a.authToken;if(t.accountSid||t.authToken&&"••••••••"!==t.authToken){let e=await w.twilioService.validateMasterCredentials(n,s);if(!e.valid)return f.NextResponse.json({success:!1,error:`Invalid Twilio credentials: ${e.error}`},{status:400})}let i={updatedAt:new Date().toISOString()};["accountSid","apiKeySid","sendgridApiKey","usageMarkupPercent","enableSubaccountBilling","billingCurrency","autoProvisionEnabled","autoProvisionPhoneNumber","defaultPhoneNumberType","defaultPhoneNumberCountry","defaultPhoneNumberAreaCode","webhookBaseUrl","webhookSecretKey","smsEnabled","voiceEnabled","faxEnabled","mmsEnabled","brandRegistrationEnabled","defaultBrandType","require10DLCForSms","smsBounceWarningThreshold","smsBounceSuspendThreshold","smsSpamReportThreshold","callAbandonRateWarning","dailySmsLimitDefault","dailyCallLimitDefault","smsPerSecondLimit","callsPerSecondLimit","isActive"].forEach(e=>{void 0!==t[e]&&(i[e]=t[e])}),t.authToken&&"••••••••"!==t.authToken&&(i.authToken=t.authToken,i.lastValidatedAt=new Date().toISOString()),t.apiKeySecret&&"••••••••"!==t.apiKeySecret&&(i.apiKeySecret=t.apiKeySecret),t.sendgridApiKey&&"••••••••"!==t.sendgridApiKey&&(i.sendgridApiKey=t.sendgridApiKey);let{data:o,error:c}=await v.supabaseAdmin.from("AgencyTwilioConfig").update(i).eq("id",t.id).select().single();if(c)throw c;let l={...o,authToken:"••••••••",apiKeySecret:o.apiKeySecret?"••••••••":null,sendgridApiKey:o.sendgridApiKey?"••••••••":null,webhookSecretKey:o.webhookSecretKey?"••••••••":null};return f.NextResponse.json({success:!0,data:l})}catch(e){return console.error("Error updating Twilio config:",e),f.NextResponse.json({success:!1,error:"Failed to update configuration"},{status:500})}}async function k(e){try{let{searchParams:t}=new URL(e.url),a=t.get("id");if(!a)return f.NextResponse.json({success:!1,error:"Configuration ID is required"},{status:400});let{data:r}=await v.supabaseAdmin.from("TwilioSubaccount").select("id").eq("agencyConfigId",a).limit(1);if(r&&r.length>0)return f.NextResponse.json({success:!1,error:"Cannot delete configuration with active subaccounts"},{status:409});let{error:n}=await v.supabaseAdmin.from("AgencyTwilioConfig").delete().eq("id",a);if(n)throw n;return f.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting Twilio config:",e),f.NextResponse.json({success:!1,error:"Failed to delete configuration"},{status:500})}}e.s(["DELETE",()=>k,"GET",()=>C,"POST",()=>T,"PUT",()=>A],22033);var R=e.i(22033);let N=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v1/telephony/config/route",pathname:"/api/v1/telephony/config",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/telephony/config/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:P,workUnitAsyncStorage:x,serverHooks:E}=N;function U(){return(0,r.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:x})}async function D(e,t,r){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/v1/telephony/config/route";f=f.replace(/\/index$/,"")||"/";let v=await N.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:C,nextConfig:T,parsedUrl:A,isDraftMode:k,prerenderManifest:R,routerServerContext:P,isOnDemandRevalidate:x,revalidateOnlyGenerated:E,resolvedPathname:U,clientReferenceManifest:D,serverActionsManifest:I}=v,j=(0,c.normalizeAppPath)(f),M=!!(R.dynamicRoutes[j]||R.routes[U]),$=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,A,!1):t.end("This page could not be found"),null);if(M&&!k){let e=!!R.routes[U],t=R.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await $();throw new y.NoFallbackError}}let q=null;!M||N.isDev||k||(q="/index"===(q=U)?"/":q);let K=!0===N.isDev||!M,O=M&&!K;I&&D&&(0,i.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:D,serverActionsManifest:I,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:I})});let _=e.method||"GET",F=(0,s.getTracer)(),L=F.getActiveScopeSpan(),B={params:C,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:K,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>N.onRequestError(e,t,r,P)},sharedContext:{buildId:w}},H=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(H,(0,u.signalFromNodeResponse)(t));try{let i=async e=>N.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${_} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${_} ${f}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var s,c;let l=async({previousCacheEntry:a})=>{try{if(!o&&x&&E&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let c=B.renderOpts.pendingWaitUntil;c&&r.waitUntil&&(r.waitUntil(c),c=void 0);let l=B.renderOpts.collectedTags;if(!M)return await (0,h.sendResponse)(H,G,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[b.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=b.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=b.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:S.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:x})},P),t}},u=await N.handleResponse({req:e,nextConfig:T,cacheKey:q,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:E,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!M)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==S.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&M||d.delete(b.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(H,G,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};L?await c(L):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${_} ${f}`,kind:s.SpanKind.SERVER,attributes:{"http.method":_,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:x})}),M)throw t;return await (0,h.sendResponse)(H,G,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>U,"routeModule",()=>N,"serverHooks",()=>E,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>x],33207)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__99fe3e48._.js.map