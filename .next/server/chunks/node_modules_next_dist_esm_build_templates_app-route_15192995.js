module.exports=[80346,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(14444),o=e.i(37092),d=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),_=e.i(66012),m=e.i(70101),v=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var g=e.i(220),b=e.i(89171),y=e.i(89660),R=e.i(75949);async function w(e){try{let t=y.supabaseAdmin,{searchParams:a}=new URL(e.url),r=a.get("subAccountId"),s=a.get("id"),n=a.get("type"),i=a.get("status"),o=parseInt(a.get("page")||"1"),d=Math.min(parseInt(a.get("limit")||"20"),100);if(!r)return b.NextResponse.json({success:!1,error:"subAccountId is required"},{status:400});if(s){let{data:e,error:a}=await t.from("calendars").select(`
          *,
          calendar_working_hours (*),
          calendar_date_overrides (*),
          calendar_members (
            *,
            users:user_id (id, name, email, avatar_url)
          ),
          appointment_types (*)
        `).eq("id",s).eq("sub_account_id",r).single();if(a||!e)return b.NextResponse.json({success:!1,error:"Calendar not found"},{status:404});let n=k(e);return b.NextResponse.json({success:!0,data:n})}let l=t.from("calendars").select("*",{count:"exact"}).eq("sub_account_id",r).order("created_at",{ascending:!1});n&&(l=l.eq("calendar_type",n)),l=i?l.eq("status",i):l.neq("status","archived");let u=(o-1)*d;l=l.range(u,u+d-1);let{data:c,error:p,count:_}=await l;if(p){if(console.error("Error fetching calendars:",p),p.message?.includes("does not exist")||"42P01"===p.code)return b.NextResponse.json({success:!1,error:"Calendar tables not found. Please run the database migration: supabase/migrations/015_calendar_appointment_system.sql",details:p.message},{status:500});return b.NextResponse.json({success:!1,error:"Failed to fetch calendars",details:p.message},{status:500})}let m=(c||[]).map(k);return b.NextResponse.json({success:!0,data:m,pagination:{page:o,limit:d,total:_||0,totalPages:Math.ceil((_||0)/d)}})}catch(e){return console.error("Error in GET /api/v1/calendars:",e),b.NextResponse.json({success:!1,error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function x(e){try{let t,a=y.supabaseAdmin,{subAccountId:r,name:s,calendarType:n,timezone:i,description:o,durationMinutes:d=30,slotIntervalMinutes:l=15,bufferBeforeMinutes:u=0,bufferAfterMinutes:c=0,minimumNoticeHours:p=0,maximumBookingDays:_=60,autoConfirm:m=!0,requiresApproval:v=!1,maxCapacity:f,minAttendees:h,workingHours:g,customBranding:w,createdBy:x}=await e.json();if(!r||!s||!n||!i)return b.NextResponse.json({success:!1,error:"subAccountId, name, calendarType, and timezone are required"},{status:400});let A=["individual","team","collective","round_robin","service","class"];if(!A.includes(n))return b.NextResponse.json({success:!1,error:`Invalid calendar type. Must be one of: ${A.join(", ")}`},{status:400});let E=s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),N=`${E}-${(0,R.v4)().slice(0,8)}`,C=(0,R.v4)(),{data:T,error:q}=await a.from("calendars").insert({id:C,sub_account_id:r,name:s,slug:N,description:o,calendar_type:n,status:"active",timezone:i,duration_minutes:d,slot_interval_minutes:l,buffer_before_minutes:u,buffer_after_minutes:c,minimum_notice_hours:p,maximum_booking_days:_,auto_confirm:m,requires_approval:v,max_capacity:f,min_attendees:h,custom_branding:w,waitlist_enabled:!1,allow_reschedule:!0,allow_cancellation:!0,created_by:x}).select().single();if(q)return console.error("Error creating calendar:",q),b.NextResponse.json({success:!1,error:"Failed to create calendar"},{status:500});let I=(g||(t=[{startTime:"09:00",endTime:"17:00"}],[{dayOfWeek:0,isAvailable:!1,timeBlocks:[]},{dayOfWeek:1,isAvailable:!0,timeBlocks:t},{dayOfWeek:2,isAvailable:!0,timeBlocks:t},{dayOfWeek:3,isAvailable:!0,timeBlocks:t},{dayOfWeek:4,isAvailable:!0,timeBlocks:t},{dayOfWeek:5,isAvailable:!0,timeBlocks:t},{dayOfWeek:6,isAvailable:!1,timeBlocks:[]}])).map(e=>({id:(0,R.v4)(),calendar_id:C,day_of_week:e.dayOfWeek,is_available:e.isAvailable,time_blocks:e.timeBlocks})),{error:O}=await a.from("calendar_working_hours").insert(I);O&&console.error("Error creating working hours:",O);let P=`${process.env.NEXT_PUBLIC_APP_URL||""}/book/${N}`;return b.NextResponse.json({success:!0,data:{...k(T),bookingUrl:P}},{status:201})}catch(e){return console.error("Error in POST /api/v1/calendars:",e),b.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function A(e){try{let t=y.supabaseAdmin,{id:a,subAccountId:r,name:s,description:n,status:i,timezone:o,durationMinutes:d,slotIntervalMinutes:l,bufferBeforeMinutes:u,bufferAfterMinutes:c,minimumNoticeHours:p,maximumBookingDays:_,autoConfirm:m,requiresApproval:v,maxCapacity:f,minAttendees:h,waitlistEnabled:g,allowReschedule:R,rescheduleDeadlineHours:w,maxReschedules:x,allowCancellation:A,cancellationDeadlineHours:E,customBranding:N}=await e.json();if(!a||!r)return b.NextResponse.json({success:!1,error:"id and subAccountId are required"},{status:400});let C={updated_at:new Date().toISOString()};void 0!==s&&(C.name=s),void 0!==n&&(C.description=n),void 0!==i&&(C.status=i),void 0!==o&&(C.timezone=o),void 0!==d&&(C.duration_minutes=d),void 0!==l&&(C.slot_interval_minutes=l),void 0!==u&&(C.buffer_before_minutes=u),void 0!==c&&(C.buffer_after_minutes=c),void 0!==p&&(C.minimum_notice_hours=p),void 0!==_&&(C.maximum_booking_days=_),void 0!==m&&(C.auto_confirm=m),void 0!==v&&(C.requires_approval=v),void 0!==f&&(C.max_capacity=f),void 0!==h&&(C.min_attendees=h),void 0!==g&&(C.waitlist_enabled=g),void 0!==R&&(C.allow_reschedule=R),void 0!==w&&(C.reschedule_deadline_hours=w),void 0!==x&&(C.max_reschedules=x),void 0!==A&&(C.allow_cancellation=A),void 0!==E&&(C.cancellation_deadline_hours=E),void 0!==N&&(C.custom_branding=N);let{data:T,error:q}=await t.from("calendars").update(C).eq("id",a).eq("sub_account_id",r).select().single();if(q||!T)return console.error("Error updating calendar:",q),b.NextResponse.json({success:!1,error:"Failed to update calendar"},{status:500});return b.NextResponse.json({success:!0,data:k(T)})}catch(e){return console.error("Error in PUT /api/v1/calendars:",e),b.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function E(e){try{let t=y.supabaseAdmin,{searchParams:a}=new URL(e.url),r=a.get("id"),s=a.get("subAccountId"),n="true"===a.get("permanent");if(!r||!s)return b.NextResponse.json({success:!1,error:"id and subAccountId are required"},{status:400});if(n){let{error:e}=await t.from("calendars").delete().eq("id",r).eq("sub_account_id",s);if(e)return console.error("Error deleting calendar:",e),b.NextResponse.json({success:!1,error:"Failed to delete calendar"},{status:500})}else{let{error:e}=await t.from("calendars").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",r).eq("sub_account_id",s);if(e)return console.error("Error archiving calendar:",e),b.NextResponse.json({success:!1,error:"Failed to archive calendar"},{status:500})}return b.NextResponse.json({success:!0},{status:200})}catch(e){return console.error("Error in DELETE /api/v1/calendars:",e),b.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}function k(e){return{id:e.id,subAccountId:e.sub_account_id,name:e.name,slug:e.slug,description:e.description,calendarType:e.calendar_type,status:e.status,timezone:e.timezone,color:e.color,avatarUrl:e.avatar_url,customBranding:e.custom_branding,durationMinutes:e.duration_minutes,slotIntervalMinutes:e.slot_interval_minutes,bufferBeforeMinutes:e.buffer_before_minutes,bufferAfterMinutes:e.buffer_after_minutes,minimumNoticeHours:e.minimum_notice_hours,maximumBookingDays:e.maximum_booking_days,autoConfirm:e.auto_confirm,requiresApproval:e.requires_approval,maxCapacity:e.max_capacity,minAttendees:e.min_attendees,waitlistEnabled:e.waitlist_enabled,allowReschedule:e.allow_reschedule,rescheduleDeadlineHours:e.reschedule_deadline_hours,maxReschedules:e.max_reschedules,allowCancellation:e.allow_cancellation,cancellationDeadlineHours:e.cancellation_deadline_hours,createdAt:e.created_at,updatedAt:e.updated_at,createdBy:e.created_by,workingHours:e.calendar_working_hours?.map(e=>({id:e.id,calendarId:e.calendar_id,dayOfWeek:e.day_of_week,isAvailable:e.is_available,timeBlocks:e.time_blocks,createdAt:e.created_at,updatedAt:e.updated_at})),dateOverrides:e.calendar_date_overrides?.map(e=>({id:e.id,calendarId:e.calendar_id,overrideDate:e.override_date,overrideType:e.override_type,reason:e.reason,customHours:e.custom_hours,isRecurring:e.is_recurring,recurrencePattern:e.recurrence_pattern,createdAt:e.created_at})),members:e.calendar_members?.map(e=>({id:e.id,calendarId:e.calendar_id,userId:e.user_id,role:e.role,isPrimaryOwner:e.is_primary_owner,priorityOrder:e.priority_order,weight:e.weight,isActive:e.is_active,canEditCalendar:e.can_edit_calendar,canManageAppointments:e.can_manage_appointments,createdAt:e.created_at,user:e.users?{id:e.users.id,name:e.users.name,email:e.users.email,avatar:e.users.avatar_url}:void 0})),appointmentTypes:e.appointment_types?.map(e=>({id:e.id,calendarId:e.calendar_id,name:e.name,description:e.description,slug:e.slug,durationMinutes:e.duration_minutes,bufferBeforeMinutes:e.buffer_before_minutes,bufferAfterMinutes:e.buffer_after_minutes,isActive:e.is_active,minimumNoticeHours:e.minimum_notice_hours,maximumBookingDays:e.maximum_booking_days,defaultLocationType:e.default_location_type,defaultLocation:e.default_location,videoProvider:e.video_provider,price:e.price,currency:e.currency,requirePayment:e.require_payment,depositAmount:e.deposit_amount,customQuestions:e.custom_questions,maxCapacity:e.max_capacity,color:e.color,icon:e.icon,displayOrder:e.display_order,createdAt:e.created_at,updatedAt:e.updated_at}))}}e.s(["DELETE",()=>E,"GET",()=>w,"POST",()=>x,"PUT",()=>A],98557);var N=e.i(98557);let C=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v1/calendars/route",pathname:"/api/v1/calendars",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/calendars/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:T,workUnitAsyncStorage:q,serverHooks:I}=C;function O(){return(0,r.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:q})}async function P(e,t,r){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/v1/calendars/route";b=b.replace(/\/index$/,"")||"/";let y=await C.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:w,nextConfig:x,parsedUrl:A,isDraftMode:E,prerenderManifest:k,routerServerContext:N,isOnDemandRevalidate:T,revalidateOnlyGenerated:q,resolvedPathname:I,clientReferenceManifest:O,serverActionsManifest:P}=y,j=(0,d.normalizeAppPath)(b),M=!!(k.dynamicRoutes[j]||k.routes[I]),S=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(M&&!E){let e=!!k.routes[I],t=k.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await S();throw new h.NoFallbackError}}let U=null;!M||C.isDev||E||(U="/index"===(U=I)?"/":U);let H=!0===C.isDev||!M,D=M&&!H;P&&O&&(0,i.setReferenceManifestsSingleton)({page:b,clientReferenceManifest:O,serverActionsManifest:P,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:P})});let B=e.method||"GET",$=(0,n.getTracer)(),L=$.getActiveScopeSpan(),F={params:w,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>C.onRequestError(e,t,r,N)},sharedContext:{buildId:R}},W=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(W,(0,u.signalFromNodeResponse)(t));try{let i=async e=>C.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${B} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${B} ${b}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:a})=>{try{if(!o&&T&&q&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let d=F.renderOpts.pendingWaitUntil;d&&r.waitUntil&&(r.waitUntil(d),d=void 0);let l=F.renderOpts.collectedTags;if(!M)return await (0,_.sendResponse)(W,K,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})},N),t}},u=await C.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:q,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!M)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&M||c.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,v.getCacheControlHeader)(u.cacheControl)),await (0,_.sendResponse)(W,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};L?await d(L):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${B} ${b}`,kind:n.SpanKind.SERVER,attributes:{"http.method":B,"http.target":e.url}},d))}catch(t){if(t instanceof h.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})}),M)throw t;return await (0,_.sendResponse)(W,K,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>O,"routeModule",()=>C,"serverHooks",()=>I,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>q],80346)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_15192995.js.map