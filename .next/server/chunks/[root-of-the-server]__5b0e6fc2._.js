module.exports=[93695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,n)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93799,e=>{"use strict";var t=e.i(47909),n=e.i(74017),r=e.i(96250),a=e.i(59756),s=e.i(61916),i=e.i(74677),o=e.i(69741),d=e.i(16795),u=e.i(87718),l=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),f=e.i(26937),v=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(220),x=e.i(89171),w=e.i(89660);async function R(e,t){try{let{id:n}=await t.params,{searchParams:r}=new URL(e.url),a=r.get("token"),s=w.supabaseAdmin.from("Document").select(`
        *,
        contact:Contact (id, firstName, lastName, email, phone),
        template:DocumentTemplate (id, name),
        signers:DocumentSigner (*),
        fields:DocumentField (*),
        activities:DocumentActivity (*)
      `).eq("id",n),{data:i,error:o}=await s.single();if(o||!i)return x.NextResponse.json({success:!1,error:"Document not found"},{status:404});if(a){let e=i.signers?.find(e=>e.accessToken===a);if(!e)return x.NextResponse.json({success:!1,error:"Invalid access token"},{status:403});"sent"===i.status&&(await w.supabaseAdmin.from("Document").update({status:"viewed",viewedAt:new Date().toISOString()}).eq("id",n),await w.supabaseAdmin.from("DocumentActivity").insert({documentId:n,signerId:e.id,action:"viewed",description:`${e.name} viewed the document`}))}return x.NextResponse.json({success:!0,data:{document:i}})}catch(e){return console.error(`GET /api/v1/revenue-engine/documents/${(await t.params).id} error:`,e),x.NextResponse.json({success:!1,error:e.message||"Failed to fetch document"},{status:500})}}async function A(t,n){try{let{id:r}=await n.params,a=await t.json(),{data:s,error:i}=await w.supabaseAdmin.from("Document").select("id, status").eq("id",r).single();if(i||!s)return x.NextResponse.json({success:!1,error:"Document not found"},{status:404});if("draft"!==s.status)return x.NextResponse.json({success:!1,error:"Can only update draft documents"},{status:400});let{title:o,description:d,documentType:u,content:l,recipientName:c,recipientEmail:p,requiresSignature:m,allowDecline:f,expiresAt:v,attachments:g,metadata:h,signers:R,fields:A}=a,y={updatedAt:new Date().toISOString()};void 0!==o&&(y.title=o),void 0!==d&&(y.description=d),void 0!==u&&(y.documentType=u),void 0!==l&&(y.content=l),void 0!==c&&(y.recipientName=c),void 0!==p&&(y.recipientEmail=p),void 0!==m&&(y.requiresSignature=m),void 0!==f&&(y.allowDecline=f),void 0!==v&&(y.expiresAt=v),void 0!==g&&(y.attachments=g),void 0!==h&&(y.metadata=h);let{data:b,error:E}=await w.supabaseAdmin.from("Document").update(y).eq("id",r).select().single();if(E)throw E;if(void 0!==R&&(await w.supabaseAdmin.from("DocumentSigner").delete().eq("documentId",r),R.length>0)){let{randomBytes:t}=await e.A(85685),n=R.map((e,n)=>({documentId:r,name:e.name,email:e.email,role:e.role||"signer",signingOrder:e.signingOrder||n+1,status:"pending",accessToken:t(32).toString("hex"),accessPin:e.requirePin?Math.random().toString().slice(2,8):null,requireIdVerification:e.requireIdVerification||!1,idVerificationMethods:e.idVerificationMethods||[]}));await w.supabaseAdmin.from("DocumentSigner").insert(n)}if(void 0!==A&&(await w.supabaseAdmin.from("DocumentField").delete().eq("documentId",r),A.length>0)){let e=A.map((e,t)=>({documentId:r,signerId:e.signerId||null,type:e.type||"text",label:e.label||null,placeholder:e.placeholder||null,required:!1!==e.required,pageNumber:e.pageNumber||1,positionX:e.positionX||0,positionY:e.positionY||0,width:e.width||200,height:e.height||50,options:e.options||[],defaultValue:e.defaultValue||null,order:e.order||t+1}));await w.supabaseAdmin.from("DocumentField").insert(e)}await w.supabaseAdmin.from("DocumentActivity").insert({documentId:r,action:"updated",description:"Document updated"});let{data:D}=await w.supabaseAdmin.from("Document").select(`
        *,
        signers:DocumentSigner (*),
        fields:DocumentField (*)
      `).eq("id",r).single();return x.NextResponse.json({success:!0,data:{document:D}})}catch(e){return console.error(`PUT /api/v1/revenue-engine/documents/${(await n.params).id} error:`,e),x.NextResponse.json({success:!1,error:e.message||"Failed to update document"},{status:500})}}async function y(e,t){try{let{id:e}=await t.params,{data:n,error:r}=await w.supabaseAdmin.from("Document").select("id, status, title").eq("id",e).single();if(r||!n)return x.NextResponse.json({success:!1,error:"Document not found"},{status:404});if(!["draft","voided"].includes(n.status))return x.NextResponse.json({success:!1,error:"Can only delete draft or voided documents. Use void action for sent documents."},{status:400});await w.supabaseAdmin.from("DocumentFieldValue").delete().eq("documentId",e),await w.supabaseAdmin.from("DocumentField").delete().eq("documentId",e),await w.supabaseAdmin.from("SignerIdVerification").delete().eq("documentId",e),await w.supabaseAdmin.from("DocumentSigner").delete().eq("documentId",e),await w.supabaseAdmin.from("DocumentActivity").delete().eq("documentId",e);let{error:a}=await w.supabaseAdmin.from("Document").delete().eq("id",e);if(a)throw a;return x.NextResponse.json({success:!0,message:"Document deleted successfully"})}catch(e){return console.error(`DELETE /api/v1/revenue-engine/documents/${(await t.params).id} error:`,e),x.NextResponse.json({success:!1,error:e.message||"Failed to delete document"},{status:500})}}e.s(["DELETE",()=>y,"GET",()=>R,"PUT",()=>A],36230);var b=e.i(36230);let E=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/revenue-engine/documents/[id]/route",pathname:"/api/v1/revenue-engine/documents/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/revenue-engine/documents/[id]/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:D,workUnitAsyncStorage:q,serverHooks:N}=E;function C(){return(0,r.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:q})}async function I(e,t,r){E.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/v1/revenue-engine/documents/[id]/route";x=x.replace(/\/index$/,"")||"/";let w=await E.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:A,nextConfig:y,parsedUrl:b,isDraftMode:D,prerenderManifest:q,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:I,resolvedPathname:T,clientReferenceManifest:S,serverActionsManifest:j}=w,P=(0,o.normalizeAppPath)(x),k=!!(q.dynamicRoutes[P]||q.routes[T]),O=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,b,!1):t.end("This page could not be found"),null);if(k&&!D){let e=!!q.routes[T],t=q.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await O();throw new g.NoFallbackError}}let _=null;!k||E.isDev||D||(_="/index"===(_=T)?"/":_);let U=!0===E.isDev||!k,F=k&&!U;j&&S&&(0,i.setManifestsSingleton)({page:x,clientReferenceManifest:S,serverActionsManifest:j});let H=e.method||"GET",M=(0,s.getTracer)(),$=M.getActiveScopeSpan(),V={params:A,prerenderManifest:q,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,a)=>E.onRequestError(e,t,r,a,N)},sharedContext:{buildId:R}},K=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let i=async e=>E.handle(B,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=M.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${H} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${x}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),d=async a=>{var s,d;let u=async({previousCacheEntry:n})=>{try{if(!o&&C&&I&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(a);e.fetchMetrics=V.renderOpts.fetchMetrics;let d=V.renderOpts.pendingWaitUntil;d&&r.waitUntil&&(r.waitUntil(d),d=void 0);let u=V.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)(K,L,s,V.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,r=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,N),t}},l=await E.handleResponse({req:e,nextConfig:y,cacheKey:_,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:q,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!k)return null;if((null==l||null==(s=l.value)?void 0:s.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(d=l.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),D&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,m.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&k||g.delete(v.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,f.getCacheControlHeader)(l.cacheControl)),await (0,p.sendResponse)(K,L,new Response(l.value.body,{headers:g,status:l.value.status||200})),null};$?await d($):await M.withPropagatedContext(e.headers,()=>M.trace(l.BaseServerSpan.handleRequest,{spanName:`${H} ${x}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,N),k)throw t;return await (0,p.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>C,"routeModule",()=>E,"serverHooks",()=>N,"workAsyncStorage",()=>D,"workUnitAsyncStorage",()=>q],93799)},85685,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_crypto_c412f66b._.js"].map(t=>e.l(t))).then(()=>t(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5b0e6fc2._.js.map