module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},94699,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),p=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),h=e.i(66012),m=e.i(70101),f=e.i(26937),y=e.i(10372),g=e.i(93695);e.i(52474);var x=e.i(220),v=e.i(89171);let w=[{key:"firstName",label:"First Name",type:"text",aliases:["first name","fname","first","given name"]},{key:"lastName",label:"Last Name",type:"text",aliases:["last name","lname","last","surname","family name"]},{key:"email",label:"Email",type:"email",aliases:["email","e-mail","email address","mail"]},{key:"phone",label:"Phone",type:"phone",aliases:["phone","phone number","mobile","cell","telephone","tel"]},{key:"company",label:"Company",type:"text",aliases:["company","company name","organization","org","business"]},{key:"jobTitle",label:"Job Title",type:"text",aliases:["job title","title","position","role","job"]},{key:"address",label:"Address",type:"text",aliases:["address","street","address1","street address"]},{key:"city",label:"City",type:"text",aliases:["city","town"]},{key:"state",label:"State",type:"text",aliases:["state","province","region"]},{key:"country",label:"Country",type:"text",aliases:["country","nation"]},{key:"zipCode",label:"Zip Code",type:"text",aliases:["zip","zip code","postal code","postcode","zipcode"]},{key:"website",label:"Website",type:"url",aliases:["website","web","url","site","homepage"]},{key:"dateOfBirth",label:"Date of Birth",type:"date",aliases:["dob","date of birth","birthday","birth date"]},{key:"leadSource",label:"Lead Source",type:"text",aliases:["source","lead source","how did you hear","referral"]},{key:"tags",label:"Tags",type:"tags",aliases:["tags","labels","categories"]},{key:"notes",label:"Notes",type:"textarea",aliases:["notes","comments","description","remarks"]}];function R(e){let t=e.split(/\r?\n/).filter(e=>e.trim());if(0===t.length)return{headers:[],rows:[]};let r=b(t[0]),a=[];for(let e=1;e<t.length;e++){let n=b(t[e]),s={};r.forEach((e,t)=>{s[e]=n[t]||""}),a.push(s)}return{headers:r,rows:a}}function b(e){let t=[],r="",a=!1;for(let n=0;n<e.length;n++){let s=e[n];'"'===s?a&&'"'===e[n+1]?(r+='"',n++):a=!a:","!==s||a?r+=s:(t.push(r.trim()),r="")}return t.push(r.trim()),t}async function C(e){try{let t=await e.formData(),r=t.get("file"),a=t.get("subAccountId"),n=t.get("action");if(!a)return v.NextResponse.json({success:!1,error:"subAccountId is required"},{status:400});if("preview"===n&&r){let e=await r.text(),{headers:t,rows:a}=R(e),n=[];for(let e of t){let t=function(e){let t=e.toLowerCase().trim();for(let r of w){if(r.key.toLowerCase()===t||r.label.toLowerCase()===t)return{csvColumn:e,risivoField:r.key,confidence:1,transform:"email"===r.type?"lowercase":"phone"===r.type?"phone_format":"date"===r.type?"date_format":"none"};for(let a of r.aliases)if(a===t||t.includes(a))return{csvColumn:e,risivoField:r.key,confidence:.9,transform:"email"===r.type?"lowercase":"phone"===r.type?"phone_format":"date"===r.type?"date_format":"none"};let a=function(e,t){let r=e.length>t.length?e:t,a=e.length>t.length?t:e;if(0===r.length)return 1;let n=function(e,t){let r=[];for(let t=0;t<=e.length;t++)r[t]=[t];for(let e=0;e<=t.length;e++)r[0][e]=e;for(let a=1;a<=e.length;a++)for(let n=1;n<=t.length;n++){let s=+(e[a-1]!==t[n-1]);r[a][n]=Math.min(r[a-1][n]+1,r[a][n-1]+1,r[a-1][n-1]+s)}return r[e.length][t.length]}(r,a);return(r.length-n)/r.length}(t,r.key.toLowerCase());if(a>.7)return{csvColumn:e,risivoField:r.key,confidence:a,transform:"none"}}return null}(e);t?n.push(t):n.push({csvColumn:e,risivoField:"",confidence:0})}let s={headers:t,rows:a.slice(0,10),totalRows:a.length,suggestedMappings:n};return v.NextResponse.json({success:!0,data:s})}if("import"===n&&r){let e=await r.text(),n=t.get("mappings"),s=n?JSON.parse(n):[];t.get("skipDuplicates"),t.get("mergeExisting");let{headers:o,rows:i}=R(e),l=0,p=0,u=0,d=[];for(let e=0;e<i.length;e++){let t=i[e];try{let e={subAccountId:a};for(let r of s)r.risivoField&&t[r.csvColumn]&&(e[r.risivoField]=function(e,t){if(!e)return e;switch(t){case"lowercase":return e.toLowerCase();case"uppercase":return e.toUpperCase();case"phone_format":let r=e.replace(/[^\d+]/g,"");if(10===r.length)return`+1 (${r.slice(0,3)}) ${r.slice(3,6)}-${r.slice(6)}`;return e;case"date_format":try{return new Date(e).toISOString()}catch{return e}default:return e}}(t[r.csvColumn],r.transform));if(!e.email){p++;continue}l++}catch(t){u++,d.push({row:e+2,error:t instanceof Error?t.message:"Unknown error"})}}return v.NextResponse.json({success:!0,data:{imported:l,skipped:p,errors:u,totalRows:i.length,errorDetails:d.slice(0,10),completedAt:new Date().toISOString()}})}return v.NextResponse.json({success:!1,error:'Invalid action. Use "preview" or "import"'},{status:400})}catch(e){return console.error("CSV Import Error:",e),v.NextResponse.json({success:!1,error:e instanceof Error?e.message:"CSV import failed"},{status:500})}}async function E(){return v.NextResponse.json({success:!0,data:{fields:w.map(e=>({key:e.key,label:e.label,type:e.type,aliases:e.aliases})),supportedFormats:["csv","txt"],maxFileSize:"50MB",maxRows:5e4}})}e.s(["GET",()=>E,"POST",()=>C],86395);var k=e.i(86395);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/import/csv/route",pathname:"/api/v1/import/csv",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/import/csv/route.ts",nextConfigOutput:"",userland:k}),{workAsyncStorage:A,workUnitAsyncStorage:S,serverHooks:T}=N;function j(){return(0,a.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:S})}async function O(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/v1/import/csv/route";v=v.replace(/\/index$/,"")||"/";let w=await N.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:b,nextConfig:C,parsedUrl:E,isDraftMode:k,prerenderManifest:A,routerServerContext:S,isOnDemandRevalidate:T,revalidateOnlyGenerated:j,resolvedPathname:O,clientReferenceManifest:_,serverActionsManifest:P}=w,q=(0,l.normalizeAppPath)(v),I=!!(A.dynamicRoutes[q]||A.routes[O]),D=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,E,!1):t.end("This page could not be found"),null);if(I&&!k){let e=!!A.routes[O],t=A.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let U=null;!I||N.isDev||k||(U="/index"===(U=O)?"/":U);let M=!0===N.isDev||!I,F=I&&!M;P&&_&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:_,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",L=(0,s.getTracer)(),$=L.getActiveScopeSpan(),B={params:b,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>N.onRequestError(e,t,a,S)},sharedContext:{buildId:R}},K=new p.NodeNextRequest(e),z=new p.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let o=async e=>N.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let p=async({previousCacheEntry:r})=>{try{if(!i&&T&&j&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let p=B.renderOpts.collectedTags;if(!I)return await (0,h.sendResponse)(K,z,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);p&&(t[y.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})},S),t}},u=await N.handleResponse({req:e,nextConfig:C,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:j,responseGenerator:p,waitUntil:a.waitUntil,isMinimalMode:i});if(!I)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&I||d.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(K,z,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};$?await l($):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})}),I)throw t;return await (0,h.sendResponse)(K,z,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>j,"routeModule",()=>N,"serverHooks",()=>T,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>S],94699)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f1b78b4c._.js.map