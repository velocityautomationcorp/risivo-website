module.exports=[23682,t=>{"use strict";var e=t.i(75949);t.s(["ActionExecutors",0,{create_contact:async(t,r,o)=>{try{let a=(0,e.v4)(),{data:s,error:c}=await o.from("contacts").insert({id:a,sub_account_id:r.workflow.subAccountId,...t.contactFields,created_at:new Date().toISOString()}).select().single();if(c)throw Error(c.message);return{success:!0,output:{createdContactId:a,contact:s}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to create contact"}}},find_contact:async(t,e,r)=>{try{let{contactFields:e}=t,o=r.from("contacts").select("*");e?.email&&(o=o.eq("email",e.email)),e?.phone&&(o=o.eq("phone",e.phone));let{data:a,error:s}=await o.limit(1).single();if(s&&"PGRST116"!==s.code)throw Error(s.message);return{success:!0,output:{foundContact:a||null,contactFound:!!a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to find contact"}}},update_contact_field:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let{data:o,error:a}=await r.from("contacts").update({...t.contactFields,updated_at:new Date().toISOString()}).eq("id",e.contactId).select().single();if(a)throw Error(a.message);return{success:!0,output:{updatedContact:o}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to update contact"}}},add_contact_tag:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let o=t.tagIds||[];for(let t of o)await r.from("contact_tags").upsert({contact_id:e.contactId,tag_id:t,created_at:new Date().toISOString()},{onConflict:"contact_id,tag_id",ignoreDuplicates:!0});return{success:!0,output:{tagsAdded:o.length}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to add tags"}}},remove_contact_tag:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let o=t.tagIds||[],{error:a}=await r.from("contact_tags").delete().eq("contact_id",e.contactId).in("tag_id",o);if(a)throw Error(a.message);return{success:!0,output:{tagsRemoved:o.length}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to remove tags"}}},assign_to_user:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let{error:o}=await r.from("contacts").update({assigned_to:t.userId,updated_at:new Date().toISOString()}).eq("id",e.contactId);if(o)throw Error(o.message);return{success:!0,output:{assignedToUserId:t.userId}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to assign user"}}},remove_assigned_user:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let{error:t}=await r.from("contacts").update({assigned_to:null,updated_at:new Date().toISOString()}).eq("id",e.contactId);if(t)throw Error(t.message);return{success:!0,output:{assignmentRemoved:!0}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to remove assignment"}}},add_note:async(t,r,o)=>{try{if(!r.contactId)return{success:!1,error:"No contact in context"};let a=(0,e.v4)(),{error:s}=await o.from("contact_notes").insert({id:a,contact_id:r.contactId,content:t.noteContent,created_by:t.userId,created_at:new Date().toISOString()});if(s)throw Error(s.message);return{success:!0,output:{noteId:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to add note"}}},add_task:async(t,r,o)=>{try{let a=(0,e.v4)(),{error:s}=await o.from("tasks").insert({id:a,contact_id:r.contactId,title:t.taskTitle,due_date:t.taskDueDate,assigned_to:t.userId,status:"pending",created_at:new Date().toISOString()});if(s)throw Error(s.message);return{success:!0,output:{taskId:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to add task"}}},modify_engagement_score:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let{data:o}=await r.from("contacts").select("engagement_score").eq("id",e.contactId).single(),a=o?.engagement_score||0,s=Math.max(0,Math.min(100,a+(t.engagementScoreDelta||0))),{error:c}=await r.from("contacts").update({engagement_score:s,updated_at:new Date().toISOString()}).eq("id",e.contactId);if(c)throw Error(c.message);return{success:!0,output:{previousScore:a,newScore:s}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to modify engagement score"}}},delete_contact:async(t,e,r)=>{try{if(!e.contactId)return{success:!1,error:"No contact in context"};let{error:t}=await r.from("contacts").delete().eq("id",e.contactId);if(t)throw Error(t.message);return{success:!0,output:{deletedContactId:e.contactId},skipRemainingActions:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to delete contact"}}},send_email:async(t,r,o)=>{try{let a=r.contact?.email||t.contactFields?.email;if(!a)return{success:!1,error:"No email address available"};let s=(0,e.v4)(),{error:c}=await o.from("email_queue").insert({id:s,sub_account_id:r.workflow.subAccountId,contact_id:r.contactId,to_email:a,from_email:t.emailFrom,reply_to:t.emailReplyTo,subject:t.emailSubject,body:t.emailBody,template_id:t.emailTemplateId,status:"queued",workflow_execution_id:r.executionId,created_at:new Date().toISOString()});if(c)throw Error(c.message);return{success:!0,output:{emailId:s,sentTo:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to queue email"}}},send_sms:async(t,r,o)=>{try{let a=r.contact?.phone||t.contactFields?.phone;if(!a)return{success:!1,error:"No phone number available"};let s=(0,e.v4)(),{error:c}=await o.from("sms_queue").insert({id:s,sub_account_id:r.workflow.subAccountId,contact_id:r.contactId,to_phone:a,from_phone:t.smsFrom,message:t.smsMessage,status:"queued",workflow_execution_id:r.executionId,created_at:new Date().toISOString()});if(c)throw Error(c.message);return{success:!0,output:{smsId:s,sentTo:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to queue SMS"}}},send_slack_message:async(t,e,r)=>{try{let{data:o}=await r.from("integrations").select("*").eq("sub_account_id",e.workflow.subAccountId).eq("integration_type","slack").eq("is_active",!0).single();if(!o)return{success:!1,error:"Slack integration not configured"};return{success:!0,output:{channel:t.slackChannelId,message:t.slackMessage,status:"queued"}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to send Slack message"}}},send_internal_notification:async(t,r,o)=>{try{let a=(0,e.v4)(),{error:s}=await o.from("notifications").insert({id:a,sub_account_id:r.workflow.subAccountId,user_id:t.userId,type:"workflow",title:t.noteContent||"Workflow Notification",message:t.customConfig?.message||"Workflow triggered for contact",data:{workflowId:r.workflowId,executionId:r.executionId,contactId:r.contactId},read:!1,created_at:new Date().toISOString()});if(s)throw Error(s.message);return{success:!0,output:{notificationId:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to send notification"}}},manual_action:async(t,r,o)=>{try{let a=(0,e.v4)(),{error:s}=await o.from("manual_action_tasks").insert({id:a,sub_account_id:r.workflow.subAccountId,workflow_execution_id:r.executionId,contact_id:r.contactId,instructions:t.manualActionInstructions,assigned_to:t.userId,status:"pending",created_at:new Date().toISOString()});if(s)throw Error(s.message);return{success:!0,output:{manualTaskId:a}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to create manual action"}}},webhook:async(t,e,r)=>{try{let r,o={...t.webhookBody,contact:e.contact,triggerData:e.triggerData,workflowId:e.workflowId,executionId:e.executionId,timestamp:new Date().toISOString()},a=await fetch(t.webhookUrl,{method:t.webhookMethod||"POST",headers:{"Content-Type":"application/json",...t.webhookHeaders},body:JSON.stringify(o)});if(!a.ok)throw Error(`Webhook failed with status ${a.status}`);try{r=await a.json()}catch{r=await a.text()}return{success:!0,output:{webhookStatus:a.status,webhookResponse:r}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Webhook failed"}}},if_else:async(t,e,r)=>{try{let r=t.ifElseConditions||[],o=!0;for(let t of r){let{field:r,operator:a,value:s,logicOperator:c}=t,n=function(t,e){let r,o=t.split("."),a=o[0],s=o.slice(1);switch(a){case"contact":r=e.contact;break;case"company":r=e.company;break;case"trigger":r=e.triggerData;break;case"variables":r=e.variables;break;default:r=e.variables[a]}for(let t of s){if(null==r)return;r=r[t]}return r}(r,e),i=function(t,e,r){switch(e){case"equals":return t==r;case"not_equals":return t!=r;case"contains":return String(t).includes(String(r));case"not_contains":return!String(t).includes(String(r));case"greater_than":return Number(t)>Number(r);case"less_than":return Number(t)<Number(r);case"is_empty":return null==t||""===t;case"is_not_empty":return null!=t&&""!==t;default:return!1}}(n,a,s);o="OR"===c?o||i:o&&i}return{success:!0,output:{conditionMet:o,branch:o?"if_true":"if_false"}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"If/else evaluation failed"}}},wait_step:async(t,e,r)=>{let o=t.waitDuration||0,a=t.waitUnit||"minutes";return{success:!0,output:{waitDuration:o,waitUnit:a,message:`Waiting ${o} ${a}`}}},goal_event:async(t,r,o)=>{try{let{data:a}=await o.from("workflow_goals").select("id").eq("workflow_id",r.workflowId).eq("name",t.goalEventName).single();return a&&(await o.from("goal_conversions").insert({id:(0,e.v4)(),goal_id:a.id,workflow_execution_id:r.executionId,contact_id:r.contactId,converted_at:new Date().toISOString()}),await o.rpc("increment_goal_conversions",{goal_id:a.id})),{success:!0,output:{goalRecorded:t.goalEventName}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to record goal"}}},split:async(t,e,r)=>{try{let e=t.splitPercentages||{a:50,b:50},r=100*Math.random(),o=r<e.a?"split_a":"split_b";return{success:!0,output:{branch:o,randomValue:r,percentages:e}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Split failed"}}},update_custom_value:async(t,e,r)=>{try{return{success:!0,output:{[t.customValueKey]:t.customValueValue}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to update custom value"}}},go_to:async(t,e,r)=>({success:!0,nextActionId:t.targetWorkflowId,output:{goToAction:t.targetWorkflowId}}),remove_from_workflow:async(t,e,r)=>({success:!0,skipRemainingActions:!0,output:{removedFromWorkflow:!0}}),text_formatter:async(t,e,r)=>{try{let e=t.customConfig?.inputText||"";switch(t.textFormatterOperation){case"uppercase":e=e.toUpperCase();break;case"lowercase":e=e.toLowerCase();break;case"capitalize":e=e.replace(/\b\w/g,t=>t.toUpperCase());break;case"trim":e=e.trim();break;case"replace":e=e.replace(RegExp(t.textFormatterPattern||"","g"),t.textFormatterReplacement||"");break;case"extract":let r=e.match(new RegExp(t.textFormatterPattern||""));e=r?r[0]:""}return{success:!0,output:{formattedText:e}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Text formatting failed"}}},ai_prompt:async(t,e,r)=>{try{return{success:!0,output:{aiPrompt:t.aiPrompt,aiModel:t.aiModel,status:"queued",message:"AI prompt queued for processing"}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"AI prompt failed"}}},update_appointment_status:async(t,e,r)=>{try{let o=e.triggerData?.appointmentId||t.customConfig?.appointmentId;if(!o)return{success:!1,error:"No appointment ID in context"};let{error:a}=await r.from("appointments").update({status:t.appointmentStatus,updated_at:new Date().toISOString()}).eq("id",o);if(a)throw Error(a.message);return{success:!0,output:{appointmentId:o,newStatus:t.appointmentStatus}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to update appointment"}}},generate_booking_link:async(t,r,o)=>{try{let a=(0,e.v4)(),s=t.bookingLinkExpiresIn?new Date(Date.now()+60*t.bookingLinkExpiresIn*6e4):null,{data:c}=await o.from("calendars").select("slug").eq("sub_account_id",r.workflow.subAccountId).limit(1).single(),n=c?`${process.env.NEXT_PUBLIC_APP_URL}/book/${c.slug}?ref=${a}`:null;return{success:!0,output:{bookingLinkId:a,bookingUrl:n,expiresAt:s?.toISOString()}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to generate booking link"}}},create_update_opportunity:async(t,r,o)=>{try{let a={id:t.customConfig?.opportunityId||(0,e.v4)(),sub_account_id:r.workflow.subAccountId,contact_id:r.contactId,title:t.opportunityTitle,value:t.opportunityValue||0,pipeline_id:t.opportunityPipelineId,stage_id:t.opportunityStageId,...t.opportunityFields,updated_at:new Date().toISOString()},{data:s,error:c}=await o.from("opportunities").upsert(a,{onConflict:"id"}).select().single();if(c)throw Error(c.message);return{success:!0,output:{opportunityId:s.id,opportunity:s}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to create/update opportunity"}}},remove_opportunity:async(t,e,r)=>{try{let e=t.customConfig?.opportunityId;if(!e)return{success:!1,error:"No opportunity ID provided"};let{error:o}=await r.from("opportunities").delete().eq("id",e);if(o)throw Error(o.message);return{success:!0,output:{deletedOpportunityId:e}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to remove opportunity"}}}}])}];

//# sourceMappingURL=lib_accelerator_action-executors_ts_25c78788._.js.map