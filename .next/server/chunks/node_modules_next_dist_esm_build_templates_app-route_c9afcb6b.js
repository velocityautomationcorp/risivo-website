module.exports=[39220,e=>{"use strict";var r=e.i(47909),t=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(37092),d=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),_=e.i(66012),v=e.i(70101),m=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(220),w=e.i(89171),R=e.i(89660),y=e.i(75949);async function x(e,{params:r}){try{let{calendarId:e}=await r,t=R.supabaseAdmin,{data:a,error:s}=await t.from("calendars").select(`
        *,
        calendar_working_hours (*),
        calendar_date_overrides (*)
      `).eq("id",e).single();if(s||!a)return w.NextResponse.json({success:!1,error:"Calendar not found"},{status:404});let n={calendar:{id:a.id,name:a.name,slug:a.slug,description:a.description,calendarType:a.calendar_type,status:a.status,timezone:a.timezone,color:a.color,avatarUrl:a.avatar_url,customBranding:a.custom_branding},bookingSettings:{durationMinutes:a.duration_minutes,slotIntervalMinutes:a.slot_interval_minutes,bufferBeforeMinutes:a.buffer_before_minutes,bufferAfterMinutes:a.buffer_after_minutes,minimumNoticeHours:a.minimum_notice_hours,maximumBookingDays:a.maximum_booking_days,autoConfirm:a.auto_confirm,requiresApproval:a.requires_approval,maxCapacity:a.max_capacity,minAttendees:a.min_attendees,waitlistEnabled:a.waitlist_enabled,allowGuests:a.allow_guests??!1,maxGuests:a.max_guests??5},reschedulingSettings:{allowReschedule:a.allow_reschedule,rescheduleDeadlineHours:a.reschedule_deadline_hours,maxReschedules:a.max_reschedules,allowCancellation:a.allow_cancellation,cancellationDeadlineHours:a.cancellation_deadline_hours},workingHours:(a.calendar_working_hours||[]).map(e=>({id:e.id,calendarId:e.calendar_id,dayOfWeek:e.day_of_week,isAvailable:e.is_available,timeBlocks:e.time_blocks,createdAt:e.created_at,updatedAt:e.updated_at})).sort((e,r)=>e.dayOfWeek-r.dayOfWeek),dateOverrides:(a.calendar_date_overrides||[]).map(e=>({id:e.id,calendarId:e.calendar_id,overrideDate:e.override_date,overrideType:e.override_type,reason:e.reason,customHours:e.custom_hours,isRecurring:e.is_recurring,recurrencePattern:e.recurrence_pattern,createdAt:e.created_at})).sort((e,r)=>new Date(e.overrideDate).getTime()-new Date(r.overrideDate).getTime())};return w.NextResponse.json({success:!0,data:n})}catch(e){return console.error("Error in GET /api/v1/calendars/[calendarId]/settings:",e),w.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function E(e,{params:r}){try{let{calendarId:t}=await r,a=R.supabaseAdmin,{name:s,description:n,timezone:o,color:i,avatarUrl:d,customBranding:l,durationMinutes:u,slotIntervalMinutes:c,bufferBeforeMinutes:p,bufferAfterMinutes:_,minimumNoticeHours:v,maximumBookingDays:m,autoConfirm:f,requiresApproval:g,maxCapacity:h,minAttendees:x,waitlistEnabled:E,allowGuests:b,maxGuests:k,allowReschedule:N,rescheduleDeadlineHours:A,maxReschedules:C,allowCancellation:T,cancellationDeadlineHours:I,workingHours:j,dateOverrides:q}=await e.json(),D={updated_at:new Date().toISOString()};void 0!==s&&(D.name=s),void 0!==n&&(D.description=n),void 0!==o&&(D.timezone=o),void 0!==i&&(D.color=i),void 0!==d&&(D.avatar_url=d),void 0!==l&&(D.custom_branding=l),void 0!==u&&(D.duration_minutes=u),void 0!==c&&(D.slot_interval_minutes=c),void 0!==p&&(D.buffer_before_minutes=p),void 0!==_&&(D.buffer_after_minutes=_),void 0!==v&&(D.minimum_notice_hours=v),void 0!==m&&(D.maximum_booking_days=m),void 0!==f&&(D.auto_confirm=f),void 0!==g&&(D.requires_approval=g),void 0!==h&&(D.max_capacity=h),void 0!==x&&(D.min_attendees=x),void 0!==E&&(D.waitlist_enabled=E),void 0!==b&&(D.allow_guests=b),void 0!==k&&(D.max_guests=k),void 0!==N&&(D.allow_reschedule=N),void 0!==A&&(D.reschedule_deadline_hours=A),void 0!==C&&(D.max_reschedules=C),void 0!==T&&(D.allow_cancellation=T),void 0!==I&&(D.cancellation_deadline_hours=I);let{error:O}=await a.from("calendars").update(D).eq("id",t);if(O)return console.error("Error updating calendar:",O),w.NextResponse.json({success:!1,error:"Failed to update calendar settings"},{status:500});if(j&&Array.isArray(j)){await a.from("calendar_working_hours").delete().eq("calendar_id",t);let e=j.map(e=>({id:e.id||(0,y.v4)(),calendar_id:t,day_of_week:e.dayOfWeek,is_available:e.isAvailable,time_blocks:e.timeBlocks||[]})),{error:r}=await a.from("calendar_working_hours").insert(e);r&&console.error("Error updating working hours:",r)}if(q&&Array.isArray(q)&&(await a.from("calendar_date_overrides").delete().eq("calendar_id",t),q.length>0)){let e=q.map(e=>({id:e.id||(0,y.v4)(),calendar_id:t,override_date:e.overrideDate,override_type:e.overrideType,reason:e.reason,custom_hours:e.customHours,is_recurring:e.isRecurring||!1,recurrence_pattern:e.recurrencePattern})),{error:r}=await a.from("calendar_date_overrides").insert(e);r&&console.error("Error updating date overrides:",r)}return w.NextResponse.json({success:!0,message:"Calendar settings updated successfully"})}catch(e){return console.error("Error in PUT /api/v1/calendars/[calendarId]/settings:",e),w.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function b(e,{params:r}){try{let{calendarId:t}=await r,a=R.supabaseAdmin,s=await e.json(),{searchParams:n}=new URL(e.url),o=n.get("action");if("date-override"===o){let{overrideDate:e,overrideType:r,reason:n,customHours:o,isRecurring:i,recurrencePattern:d}=s;if(!e||!r)return w.NextResponse.json({success:!1,error:"overrideDate and overrideType are required"},{status:400});let l=["blocked","available","holiday"];if(!l.includes(r))return w.NextResponse.json({success:!1,error:`Invalid overrideType. Must be one of: ${l.join(", ")}`},{status:400});let{data:u}=await a.from("calendar_date_overrides").select("id").eq("calendar_id",t).eq("override_date",e).single();if(u){let{error:e}=await a.from("calendar_date_overrides").update({override_type:r,reason:n,custom_hours:o,is_recurring:i||!1,recurrence_pattern:d}).eq("id",u.id);if(e)return w.NextResponse.json({success:!1,error:"Failed to update date override"},{status:500});return w.NextResponse.json({success:!0,data:{id:u.id},message:"Date override updated"})}let c=(0,y.v4)(),{error:p}=await a.from("calendar_date_overrides").insert({id:c,calendar_id:t,override_date:e,override_type:r,reason:n,custom_hours:o,is_recurring:i||!1,recurrence_pattern:d});if(p)return console.error("Error creating date override:",p),w.NextResponse.json({success:!1,error:"Failed to create date override"},{status:500});return w.NextResponse.json({success:!0,data:{id:c},message:"Date override created"},{status:201})}let{dayOfWeek:i,isAvailable:d,timeBlocks:l}=s;if(void 0===i||i<0||i>6)return w.NextResponse.json({success:!1,error:"dayOfWeek must be a number between 0 (Sunday) and 6 (Saturday)"},{status:400});let{data:u}=await a.from("calendar_working_hours").select("id").eq("calendar_id",t).eq("day_of_week",i).single();if(u){let{error:e}=await a.from("calendar_working_hours").update({is_available:void 0===d||d,time_blocks:l||[],updated_at:new Date().toISOString()}).eq("id",u.id);if(e)return w.NextResponse.json({success:!1,error:"Failed to update working hours"},{status:500});return w.NextResponse.json({success:!0,data:{id:u.id,dayOfWeek:i},message:"Working hours updated"})}let c=(0,y.v4)(),{error:p}=await a.from("calendar_working_hours").insert({id:c,calendar_id:t,day_of_week:i,is_available:void 0===d||d,time_blocks:l||[]});if(p)return console.error("Error creating working hours:",p),w.NextResponse.json({success:!1,error:"Failed to create working hours"},{status:500});return w.NextResponse.json({success:!0,data:{id:c,dayOfWeek:i},message:"Working hours created"},{status:201})}catch(e){return console.error("Error in POST /api/v1/calendars/[calendarId]/settings:",e),w.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function k(e,{params:r}){try{let{calendarId:t}=await r,a=R.supabaseAdmin,{searchParams:s}=new URL(e.url),n=s.get("overrideId"),o=s.get("overrideDate");if(!n&&!o)return w.NextResponse.json({success:!1,error:"overrideId or overrideDate is required"},{status:400});let i=a.from("calendar_date_overrides").delete().eq("calendar_id",t);n?i=i.eq("id",n):o&&(i=i.eq("override_date",o));let{error:d}=await i;if(d)return console.error("Error deleting date override:",d),w.NextResponse.json({success:!1,error:"Failed to delete date override"},{status:500});return w.NextResponse.json({success:!0,message:"Date override deleted"})}catch(e){return console.error("Error in DELETE /api/v1/calendars/[calendarId]/settings:",e),w.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}e.s(["DELETE",()=>k,"GET",()=>x,"POST",()=>b,"PUT",()=>E],93159);var N=e.i(93159);let A=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/v1/calendars/[calendarId]/settings/route",pathname:"/api/v1/calendars/[calendarId]/settings",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/calendars/[calendarId]/settings/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:C,workUnitAsyncStorage:T,serverHooks:I}=A;function j(){return(0,a.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:T})}async function q(e,r,a){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/v1/calendars/[calendarId]/settings/route";w=w.replace(/\/index$/,"")||"/";let R=await A.prepare(e,r,{srcPage:w,multiZoneDraftMode:!1});if(!R)return r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:x,nextConfig:E,parsedUrl:b,isDraftMode:k,prerenderManifest:N,routerServerContext:C,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:j,clientReferenceManifest:q,serverActionsManifest:D}=R,O=(0,d.normalizeAppPath)(w),S=!!(N.dynamicRoutes[O]||N.routes[j]),P=async()=>((null==C?void 0:C.render404)?await C.render404(e,r,b,!1):r.end("This page could not be found"),null);if(S&&!k){let e=!!N.routes[j],r=N.dynamicRoutes[O];if(r&&!1===r.fallback&&!e){if(E.experimental.adapterPath)return await P();throw new g.NoFallbackError}}let H=null;!S||A.isDev||k||(H="/index"===(H=j)?"/":H);let M=!0===A.isDev||!S,U=S&&!M;D&&q&&(0,o.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:q,serverActionsManifest:D,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:D})});let F=e.method||"GET",B=(0,n.getTracer)(),$=B.getActiveScopeSpan(),L={params:x,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>A.onRequestError(e,r,a,C)},sharedContext:{buildId:y}},W=new l.NodeNextRequest(e),K=new l.NodeNextResponse(r),G=u.NextRequestAdapter.fromNodeNextRequest(W,(0,u.signalFromNodeResponse)(r));try{let o=async e=>A.handle(G,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=B.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let r=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":r}),e.updateName(r)}else e.updateName(`${F} ${w}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:t})=>{try{if(!i&&T&&I&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let d=L.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=L.renderOpts.collectedTags;if(!S)return await (0,_.sendResponse)(W,K,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),r=(0,v.toNodeOutgoingHttpHeaders)(n.headers);l&&(r[f.NEXT_CACHE_TAGS_HEADER]=l),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:a}}}}catch(r){throw(null==t?void 0:t.isStale)&&await A.onRequestError(e,r,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},C),r}},u=await A.handleResponse({req:e,nextConfig:E,cacheKey:H,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:i});if(!S)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||r.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),k&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,v.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&S||c.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||r.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,_.sendResponse)(W,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await d($):await B.withPropagatedContext(e.headers,()=>B.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},d))}catch(r){if(r instanceof g.NoFallbackError||await A.onRequestError(e,r,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})}),S)throw r;return await (0,_.sendResponse)(W,K,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>j,"routeModule",()=>A,"serverHooks",()=>I,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>T],39220)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_c9afcb6b.js.map