module.exports=[37375,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),o=e.i(14444),i=e.i(37092),d=e.i(69741),u=e.i(16795),c=e.i(87718),l=e.i(95169),p=e.i(47587),m=e.i(66012),f=e.i(70101),_=e.i(26937),v=e.i(10372),y=e.i(93695);e.i(52474);var R=e.i(220),h=e.i(89171),g=e.i(89660),x=e.i(75949);async function w(e,{params:t}){try{let{calendarId:r}=await t,a=g.supabaseAdmin,{searchParams:n}=new URL(e.url),s=n.get("id"),o="false"!==n.get("activeOnly"),{data:i,error:d}=await a.from("calendars").select("id, name, sub_account_id").eq("id",r).single();if(d||!i)return h.NextResponse.json({success:!1,error:"Calendar not found"},{status:404});if(s){let{data:e,error:t}=await a.from("appointment_types").select("*").eq("id",s).eq("calendar_id",r).single();if(t||!e)return h.NextResponse.json({success:!1,error:"Appointment type not found"},{status:404});return h.NextResponse.json({success:!0,data:C(e)})}let u=a.from("appointment_types").select("*").eq("calendar_id",r).order("display_order",{ascending:!0});o&&(u=u.eq("is_active",!0));let{data:c,error:l}=await u;if(l)return console.error("Error fetching appointment types:",l),h.NextResponse.json({success:!1,error:"Failed to fetch appointment types"},{status:500});return h.NextResponse.json({success:!0,data:(c||[]).map(C)})}catch(e){return console.error("Error in GET /api/v1/calendars/[calendarId]/appointment-types:",e),h.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function E(e,{params:t}){try{let{calendarId:r}=await t,a=g.supabaseAdmin,{name:n,description:s,durationMinutes:o=30,bufferBeforeMinutes:i=0,bufferAfterMinutes:d=0,isActive:u=!0,minimumNoticeHours:c=0,maximumBookingDays:l=60,defaultLocationType:p,defaultLocation:m,videoProvider:f,price:_,currency:v="USD",requirePayment:y=!1,depositAmount:R,customQuestions:w=[],maxCapacity:E,color:N,icon:A,displayOrder:b}=await e.json();if(!n)return h.NextResponse.json({success:!1,error:"name is required"},{status:400});let{data:q,error:j}=await a.from("calendars").select("id").eq("id",r).single();if(j||!q)return h.NextResponse.json({success:!1,error:"Calendar not found"},{status:404});let T=n.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),I=`${T}-${(0,x.v4)().slice(0,8)}`,P=b;if(void 0===P){let{data:e}=await a.from("appointment_types").select("display_order").eq("calendar_id",r).order("display_order",{ascending:!1}).limit(1).single();P=(e?.display_order||0)+1}if(p){let e=["physical","phone","video","custom","ask_invitee"];if(!e.includes(p))return h.NextResponse.json({success:!1,error:`Invalid defaultLocationType. Must be one of: ${e.join(", ")}`},{status:400})}if(f){let e=["zoom","google_meet","teams","custom"];if(!e.includes(f))return h.NextResponse.json({success:!1,error:`Invalid videoProvider. Must be one of: ${e.join(", ")}`},{status:400})}let O=(0,x.v4)(),{data:S,error:D}=await a.from("appointment_types").insert({id:O,calendar_id:r,name:n,description:s,slug:I,duration_minutes:o,buffer_before_minutes:i,buffer_after_minutes:d,is_active:u,minimum_notice_hours:c,maximum_booking_days:l,default_location_type:p,default_location:m,video_provider:f,price:_,currency:v,require_payment:y,deposit_amount:R,custom_questions:w,max_capacity:E,color:N,icon:A,display_order:P}).select().single();if(D)return console.error("Error creating appointment type:",D),h.NextResponse.json({success:!1,error:"Failed to create appointment type"},{status:500});return h.NextResponse.json({success:!0,data:C(S)},{status:201})}catch(e){return console.error("Error in POST /api/v1/calendars/[calendarId]/appointment-types:",e),h.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function N(e,{params:t}){try{let{calendarId:r}=await t,a=g.supabaseAdmin,{id:n,name:s,description:o,durationMinutes:i,bufferBeforeMinutes:d,bufferAfterMinutes:u,isActive:c,minimumNoticeHours:l,maximumBookingDays:p,defaultLocationType:m,defaultLocation:f,videoProvider:_,price:v,currency:y,requirePayment:R,depositAmount:x,customQuestions:w,maxCapacity:E,color:N,icon:A,displayOrder:b}=await e.json();if(!n)return h.NextResponse.json({success:!1,error:"id is required"},{status:400});let q={updated_at:new Date().toISOString()};void 0!==s&&(q.name=s),void 0!==o&&(q.description=o),void 0!==i&&(q.duration_minutes=i),void 0!==d&&(q.buffer_before_minutes=d),void 0!==u&&(q.buffer_after_minutes=u),void 0!==c&&(q.is_active=c),void 0!==l&&(q.minimum_notice_hours=l),void 0!==p&&(q.maximum_booking_days=p),void 0!==m&&(q.default_location_type=m),void 0!==f&&(q.default_location=f),void 0!==_&&(q.video_provider=_),void 0!==v&&(q.price=v),void 0!==y&&(q.currency=y),void 0!==R&&(q.require_payment=R),void 0!==x&&(q.deposit_amount=x),void 0!==w&&(q.custom_questions=w),void 0!==E&&(q.max_capacity=E),void 0!==N&&(q.color=N),void 0!==A&&(q.icon=A),void 0!==b&&(q.display_order=b);let{data:j,error:T}=await a.from("appointment_types").update(q).eq("id",n).eq("calendar_id",r).select().single();if(T||!j)return console.error("Error updating appointment type:",T),h.NextResponse.json({success:!1,error:"Failed to update appointment type or type not found"},{status:T?500:404});return h.NextResponse.json({success:!0,data:C(j)})}catch(e){return console.error("Error in PUT /api/v1/calendars/[calendarId]/appointment-types:",e),h.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function A(e,{params:t}){try{let{calendarId:r}=await t,a=g.supabaseAdmin,{searchParams:n}=new URL(e.url),s=n.get("id"),o="true"===n.get("permanent");if(!s)return h.NextResponse.json({success:!1,error:"id is required"},{status:400});let{count:i}=await a.from("appointments").select("id",{count:"exact",head:!0}).eq("appointment_type_id",s).in("status",["scheduled","confirmed"]);if(i&&i>0&&o)return h.NextResponse.json({success:!1,error:`Cannot delete appointment type with ${i} active appointments. Deactivate instead.`},{status:400});if(o){let{error:e}=await a.from("appointment_types").delete().eq("id",s).eq("calendar_id",r);if(e)return console.error("Error deleting appointment type:",e),h.NextResponse.json({success:!1,error:"Failed to delete appointment type"},{status:500})}else{let{error:e}=await a.from("appointment_types").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",s).eq("calendar_id",r);if(e)return console.error("Error deactivating appointment type:",e),h.NextResponse.json({success:!1,error:"Failed to deactivate appointment type"},{status:500})}return h.NextResponse.json({success:!0,message:o?"Appointment type deleted":"Appointment type deactivated"})}catch(e){return console.error("Error in DELETE /api/v1/calendars/[calendarId]/appointment-types:",e),h.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function b(e,{params:t}){try{let{calendarId:r}=await t,a=g.supabaseAdmin,{typeOrder:n}=await e.json();if(!n||!Array.isArray(n))return h.NextResponse.json({success:!1,error:"typeOrder array is required"},{status:400});let s=n.map(({typeId:e,displayOrder:t})=>a.from("appointment_types").update({display_order:t}).eq("id",e).eq("calendar_id",r));return await Promise.all(s),h.NextResponse.json({success:!0,message:"Display order updated successfully"})}catch(e){return console.error("Error in PATCH /api/v1/calendars/[calendarId]/appointment-types:",e),h.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}function C(e){return{id:e.id,calendarId:e.calendar_id,name:e.name,description:e.description,slug:e.slug,durationMinutes:e.duration_minutes,bufferBeforeMinutes:e.buffer_before_minutes,bufferAfterMinutes:e.buffer_after_minutes,isActive:e.is_active,minimumNoticeHours:e.minimum_notice_hours,maximumBookingDays:e.maximum_booking_days,defaultLocationType:e.default_location_type,defaultLocation:e.default_location,videoProvider:e.video_provider,price:e.price,currency:e.currency,requirePayment:e.require_payment,depositAmount:e.deposit_amount,customQuestions:e.custom_questions||[],maxCapacity:e.max_capacity,color:e.color,icon:e.icon,displayOrder:e.display_order,createdAt:e.created_at,updatedAt:e.updated_at}}e.s(["DELETE",()=>A,"GET",()=>w,"PATCH",()=>b,"POST",()=>E,"PUT",()=>N],39407);var q=e.i(39407);let j=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/calendars/[calendarId]/appointment-types/route",pathname:"/api/v1/calendars/[calendarId]/appointment-types",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/calendars/[calendarId]/appointment-types/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:T,workUnitAsyncStorage:I,serverHooks:P}=j;function O(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:I})}async function S(e,t,a){j.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/v1/calendars/[calendarId]/appointment-types/route";h=h.replace(/\/index$/,"")||"/";let g=await j.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:w,nextConfig:E,parsedUrl:N,isDraftMode:A,prerenderManifest:b,routerServerContext:C,isOnDemandRevalidate:q,revalidateOnlyGenerated:T,resolvedPathname:I,clientReferenceManifest:P,serverActionsManifest:O}=g,S=(0,d.normalizeAppPath)(h),D=!!(b.dynamicRoutes[S]||b.routes[I]),M=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,N,!1):t.end("This page could not be found"),null);if(D&&!A){let e=!!b.routes[I],t=b.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await M();throw new y.NoFallbackError}}let U=null;!D||j.isDev||A||(U="/index"===(U=I)?"/":U);let H=!0===j.isDev||!D,k=D&&!H;O&&P&&(0,o.setReferenceManifestsSingleton)({page:h,clientReferenceManifest:P,serverActionsManifest:O,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:O})});let $=e.method||"GET",F=(0,s.getTracer)(),L=F.getActiveScopeSpan(),K={params:w,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>j.onRequestError(e,t,a,C)},sharedContext:{buildId:x}},B=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(B,(0,c.signalFromNodeResponse)(t));try{let o=async e=>j.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${$} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${h}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),d=async n=>{var s,d;let u=async({previousCacheEntry:r})=>{try{if(!i&&q&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let d=K.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let u=K.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(B,G,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await j.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:q})},C),t}},c=await j.handleResponse({req:e,nextConfig:E,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:q,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:i});if(!D)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",q?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let l=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&D||l.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||l.get("Cache-Control")||l.set("Cache-Control",(0,_.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(B,G,new Response(c.value.body,{headers:l,status:c.value.status||200})),null};L?await d(L):await F.withPropagatedContext(e.headers,()=>F.trace(l.BaseServerSpan.handleRequest,{spanName:`${$} ${h}`,kind:s.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},d))}catch(t){if(t instanceof y.NoFallbackError||await j.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:q})}),D)throw t;return await (0,m.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>O,"routeModule",()=>j,"serverHooks",()=>P,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>I],37375)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_8f1ca8f5.js.map