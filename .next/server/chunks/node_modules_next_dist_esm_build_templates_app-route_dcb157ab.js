module.exports=[39848,t=>{"use strict";var e,a,s,n,o,i,c,r,l,u,d,m,h,p,g,f,y,C,w,E,b,I,A,N,v=t.i(47909),S=t.i(74017),_=t.i(96250),R=t.i(59756),O=t.i(61916),$=t.i(14444),T=t.i(37092),k=t.i(69741),x=t.i(16795),M=t.i(87718),P=t.i(95169),U=t.i(47587),D=t.i(66012),H=t.i(70101),L=t.i(26937),j=t.i(10372),F=t.i(93695);t.i(52474);var B=t.i(220),q=t.i(89171);(e=h||(h={})).STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object",(a=p||(p={})).LANGUAGE_UNSPECIFIED="language_unspecified",a.PYTHON="python",(s=g||(g={})).OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let G=["user","model","function","system"];(n=f||(f={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",(o=y||(y={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",(i=C||(C={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",(c=w||(w={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",c.SAFETY="SAFETY",c.OTHER="OTHER",(r=E||(E={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.OTHER="OTHER",(l=b||(b={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",l.RETRIEVAL_QUERY="RETRIEVAL_QUERY",l.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",l.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",l.CLASSIFICATION="CLASSIFICATION",l.CLUSTERING="CLUSTERING",(u=I||(I={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.AUTO="AUTO",u.ANY="ANY",u.NONE="NONE",(d=A||(A={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.MODE_DYNAMIC="MODE_DYNAMIC";class Y extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class K extends Y{constructor(t,e){super(t),this.response=e}}class V extends Y{constructor(t,e,a,s){super(t),this.status=e,this.statusText=a,this.errorDetails=s}}class W extends Y{}(m=N||(N={})).GENERATE_CONTENT="generateContent",m.STREAM_GENERATE_CONTENT="streamGenerateContent",m.COUNT_TOKENS="countTokens",m.EMBED_CONTENT="embedContent",m.BATCH_EMBED_CONTENTS="batchEmbedContents";class z{constructor(t,e,a,s,n){this.model=t,this.task=e,this.apiKey=a,this.stream=s,this.requestOptions=n}toString(){var t,e;let a=(null==(t=this.requestOptions)?void 0:t.apiVersion)||"v1beta",s=(null==(e=this.requestOptions)?void 0:e.baseUrl)||"https://generativelanguage.googleapis.com",n=`${s}/${a}/${this.model}:${this.task}`;return this.stream&&(n+="?alt=sse"),n}}async function J(t){var e,a;let s,n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",(a=t.requestOptions,s=[],(null==a?void 0:a.apiClient)&&s.push(a.apiClient),s.push("genai-js/0.21.0"),s.join(" "))),n.append("x-goog-api-key",t.apiKey);let o=null==(e=t.requestOptions)?void 0:e.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(t){throw new W(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${t.message}`)}for(let[t,e]of o.entries()){if("x-goog-api-key"===t)throw new W(`Cannot set reserved header name ${t}`);if("x-goog-api-client"===t)throw new W(`Header name ${t} can only be set using the apiClient field`);n.append(t,e)}}return n}async function X(t,e,a,s,n,o){let i=new z(t,e,a,s,o);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},function(t){let e={};if((null==t?void 0:t.signal)!==void 0||(null==t?void 0:t.timeout)>=0){let a=new AbortController;(null==t?void 0:t.timeout)>=0&&setTimeout(()=>a.abort(),t.timeout),(null==t?void 0:t.signal)&&t.signal.addEventListener("abort",()=>{a.abort()}),e.signal=a.signal}return e}(o)),{method:"POST",headers:await J(i),body:n})}}async function Z(t,e,a,s,n,o={},i=fetch){let{url:c,fetchOptions:r}=await X(t,e,a,s,n,o);return Q(c,r,i)}async function Q(t,e,a=fetch){let s;try{s=await a(t,e)}catch(a){var n=a,o=t;let e=n;throw n instanceof V||n instanceof W||((e=new Y(`Error fetching from ${o.toString()}: ${n.message}`)).stack=n.stack),e}return s.ok||await tt(s,t),s}async function tt(t,e){let a,s="";try{let e=await t.json();s=e.error.message,e.error.details&&(s+=` ${JSON.stringify(e.error.details)}`,a=e.error.details)}catch(t){}throw new V(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${s}`,t.status,t.statusText,a)}function te(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),tn(t.candidates[0]))throw new K(`${to(t)}`,t);return function(t){var e,a,s,n;let o=[];if(null==(a=null==(e=t.candidates)?void 0:e[0].content)?void 0:a.parts)for(let e of null==(n=null==(s=t.candidates)?void 0:s[0].content)?void 0:n.parts)e.text&&o.push(e.text),e.executableCode&&o.push("\n```"+e.executableCode.language+"\n"+e.executableCode.code+"\n```\n"),e.codeExecutionResult&&o.push("\n```\n"+e.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}(t)}if(t.promptFeedback)throw new K(`Text not available. ${to(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tn(t.candidates[0]))throw new K(`${to(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),ta(t)[0]}if(t.promptFeedback)throw new K(`Function call not available. ${to(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tn(t.candidates[0]))throw new K(`${to(t)}`,t);return ta(t)}if(t.promptFeedback)throw new K(`Function call not available. ${to(t)}`,t)},t}function ta(t){var e,a,s,n;let o=[];if(null==(a=null==(e=t.candidates)?void 0:e[0].content)?void 0:a.parts)for(let e of null==(n=null==(s=t.candidates)?void 0:s[0].content)?void 0:n.parts)e.functionCall&&o.push(e.functionCall);return o.length>0?o:void 0}let ts=[E.RECITATION,E.SAFETY,E.LANGUAGE];function tn(t){return!!t.finishReason&&ts.includes(t.finishReason)}function to(t){var e,a,s;let n="";if((!t.candidates||0===t.candidates.length)&&t.promptFeedback)n+="Response was blocked",(null==(e=t.promptFeedback)?void 0:e.blockReason)&&(n+=` due to ${t.promptFeedback.blockReason}`),(null==(a=t.promptFeedback)?void 0:a.blockReasonMessage)&&(n+=`: ${t.promptFeedback.blockReasonMessage}`);else if(null==(s=t.candidates)?void 0:s[0]){let e=t.candidates[0];tn(e)&&(n+=`Candidate was blocked due to ${e.finishReason}`,e.finishMessage&&(n+=`: ${e.finishMessage}`))}return n}function ti(t){return this instanceof ti?(this.v=t,this):new ti(t)}"function"==typeof SuppressedError&&SuppressedError;let tc=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function tr(t){let e=[],a=t.getReader();for(;;){let{done:t,value:s}=await a.read();if(t)return te(function(t){let e=t[t.length-1],a={promptFeedback:null==e?void 0:e.promptFeedback};for(let e of t){if(e.candidates)for(let t of e.candidates){let e=t.index;if(a.candidates||(a.candidates=[]),a.candidates[e]||(a.candidates[e]={index:t.index}),a.candidates[e].citationMetadata=t.citationMetadata,a.candidates[e].groundingMetadata=t.groundingMetadata,a.candidates[e].finishReason=t.finishReason,a.candidates[e].finishMessage=t.finishMessage,a.candidates[e].safetyRatings=t.safetyRatings,t.content&&t.content.parts){a.candidates[e].content||(a.candidates[e].content={role:t.content.role||"user",parts:[]});let s={};for(let n of t.content.parts)n.text&&(s.text=n.text),n.functionCall&&(s.functionCall=n.functionCall),n.executableCode&&(s.executableCode=n.executableCode),n.codeExecutionResult&&(s.codeExecutionResult=n.codeExecutionResult),0===Object.keys(s).length&&(s.text=""),a.candidates[e].content.parts.push(s)}}e.usageMetadata&&(a.usageMetadata=e.usageMetadata)}return a}(e));e.push(s)}}async function tl(t,e,a,s){return function(t){let e,[a,s]=(e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(t){let a="";return function s(){return e.read().then(({value:e,done:n})=>{let o;if(n)return a.trim()?void t.error(new Y("Failed to parse stream")):void t.close();let i=(a+=e).match(tc);for(;i;){try{o=JSON.parse(i[1])}catch(e){t.error(new Y(`Error parsing JSON response: "${i[1]}"`));return}t.enqueue(o),i=(a=a.substring(i[0].length)).match(tc)}return s()})}()}})).tee();return{stream:function(t){return function(t,e,a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,n=a.apply(t,e||[]),o=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(t){n[t]&&(s[t]=function(e){return new Promise(function(a,s){o.push([t,e,a,s])>1||c(t,e)})})}function c(t,e){try{var a;(a=n[t](e)).value instanceof ti?Promise.resolve(a.value.v).then(r,l):u(o[0][2],a)}catch(t){u(o[0][3],t)}}function r(t){c("next",t)}function l(t){c("throw",t)}function u(t,e){t(e),o.shift(),o.length&&c(o[0][0],o[0][1])}}(this,arguments,function*(){let e=t.getReader();for(;;){let{value:t,done:a}=yield ti(e.read());if(a)break;yield yield ti(te(t))}})}(a),response:tr(s)}}(await Z(e,N.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(a),s))}async function tu(t,e,a,s){let n=await Z(e,N.GENERATE_CONTENT,t,!1,JSON.stringify(a),s);return{response:te(await n.json())}}function td(t){if(null!=t){if("string"==typeof t)return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)if(!t.role)return{role:"system",parts:t.parts};else return t}}function tm(t){let e=[];if("string"==typeof t)e=[{text:t}];else for(let a of t)"string"==typeof a?e.push({text:a}):e.push(a);var a=e;let s={role:"user",parts:[]},n={role:"function",parts:[]},o=!1,i=!1;for(let t of a)"functionResponse"in t?(n.parts.push(t),i=!0):(s.parts.push(t),o=!0);if(o&&i)throw new Y("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!i)throw new Y("No content is provided for sending chat message.");return o?s:n}function th(t){let e;return e=t.contents?t:{contents:[tm(t)]},t.systemInstruction&&(e.systemInstruction=td(t.systemInstruction)),e}let tp=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],tg={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]},tf="SILENT_ERROR";class ty{constructor(t,e,a,s={}){this.model=e,this.params=a,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,(null==a?void 0:a.history)&&(!function(t){let e=!1;for(let a of t){let{role:t,parts:s}=a;if(!e&&"user"!==t)throw new Y(`First content should be with role 'user', got ${t}`);if(!G.includes(t))throw new Y(`Each item should include role field. Got ${t} but valid roles are: ${JSON.stringify(G)}`);if(!Array.isArray(s))throw new Y("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new Y("Each Content should have at least one part");let n={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let t of s)for(let e of tp)e in t&&(n[e]+=1);let o=tg[t];for(let e of tp)if(!o.includes(e)&&n[e]>0)throw new Y(`Content with role '${t}' can't contain '${e}' part`);e=!0}}(a.history),this._history=a.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,e={}){var a,s,n,o,i,c;let r;await this._sendPromise;let l=tm(t),u={safetySettings:null==(a=this.params)?void 0:a.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(n=this.params)?void 0:n.tools,toolConfig:null==(o=this.params)?void 0:o.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(c=this.params)?void 0:c.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),e);return this._sendPromise=this._sendPromise.then(()=>tu(this._apiKey,this.model,u,d)).then(t=>{var e;if(t.response.candidates&&t.response.candidates.length>0){this._history.push(l);let a=Object.assign({parts:[],role:"model"},null==(e=t.response.candidates)?void 0:e[0].content);this._history.push(a)}else{let e=to(t.response);e&&console.warn(`sendMessage() was unsuccessful. ${e}. Inspect response object for details.`)}r=t}),await this._sendPromise,r}async sendMessageStream(t,e={}){var a,s,n,o,i,c;await this._sendPromise;let r=tm(t),l={safetySettings:null==(a=this.params)?void 0:a.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(n=this.params)?void 0:n.tools,toolConfig:null==(o=this.params)?void 0:o.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(c=this.params)?void 0:c.cachedContent,contents:[...this._history,r]},u=Object.assign(Object.assign({},this._requestOptions),e),d=tl(this._apiKey,this.model,l,u);return this._sendPromise=this._sendPromise.then(()=>d).catch(t=>{throw Error(tf)}).then(t=>t.response).then(t=>{if(t.candidates&&t.candidates.length>0){this._history.push(r);let e=Object.assign({},t.candidates[0].content);e.role||(e.role="model"),this._history.push(e)}else{let e=to(t);e&&console.warn(`sendMessageStream() was unsuccessful. ${e}. Inspect response object for details.`)}}).catch(t=>{t.message!==tf&&console.error(t)}),d}}async function tC(t,e,a,s){return(await Z(e,N.COUNT_TOKENS,t,!1,JSON.stringify(a),s)).json()}async function tw(t,e,a,s){return(await Z(e,N.EMBED_CONTENT,t,!1,JSON.stringify(a),s)).json()}async function tE(t,e,a,s){let n=a.requests.map(t=>Object.assign(Object.assign({},t),{model:e}));return(await Z(e,N.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:n}),s)).json()}class tb{constructor(t,e,a={}){this.apiKey=t,this._requestOptions=a,e.model.includes("/")?this.model=e.model:this.model=`models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=td(e.systemInstruction),this.cachedContent=e.cachedContent}async generateContent(t,e={}){var a;let s=th(t),n=Object.assign(Object.assign({},this._requestOptions),e);return tu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(a=this.cachedContent)?void 0:a.name},s),n)}async generateContentStream(t,e={}){var a;let s=th(t),n=Object.assign(Object.assign({},this._requestOptions),e);return tl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(a=this.cachedContent)?void 0:a.name},s),n)}startChat(t){var e;return new ty(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(e=this.cachedContent)?void 0:e.name},t),this._requestOptions)}async countTokens(t,e={}){let a=function(t,e){var a;let s={model:null==e?void 0:e.model,generationConfig:null==e?void 0:e.generationConfig,safetySettings:null==e?void 0:e.safetySettings,tools:null==e?void 0:e.tools,toolConfig:null==e?void 0:e.toolConfig,systemInstruction:null==e?void 0:e.systemInstruction,cachedContent:null==(a=null==e?void 0:e.cachedContent)?void 0:a.name,contents:[]},n=null!=t.generateContentRequest;if(t.contents){if(n)throw new W("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=t.contents}else if(n)s=Object.assign(Object.assign({},s),t.generateContentRequest);else{let e=tm(t);s.contents=[e]}return{generateContentRequest:s}}(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),e);return tC(this.apiKey,this.model,a,s)}async embedContent(t,e={}){let a="string"==typeof t||Array.isArray(t)?{content:tm(t)}:t,s=Object.assign(Object.assign({},this._requestOptions),e);return tw(this.apiKey,this.model,a,s)}async batchEmbedContents(t,e={}){let a=Object.assign(Object.assign({},this._requestOptions),e);return tE(this.apiKey,this.model,t,a)}}var tI=t.i(89660);let tA={update:[/add\s+(the\s+)?tag/i,/tag\s+(him|her|them|the\s+contact|.+)\s+(as|with)/i,/change\s+(his|her|their|the)?\s*(email|phone|status|name|tag)/i,/update\s+(his|her|their|the)?\s*(email|phone|status|name|tag)/i,/edit\s+(his|her|their|the)?\s*(email|phone|status|name|tag)/i,/modify\s+(his|her|their|the)?\s*(email|phone|status|name|tag)/i,/change\s+(.+)\s+(email|phone)\s+(to|from)/i,/update\s+(the\s+)?contact/i,/change\s+(.+)\s+for\s+(.+)/i,/edit\s+(the\s+)?contact/i,/modify\s+(the\s+)?contact/i,/set\s+(.+)\s+to\s+(.+)/i,/mark\s+(.+)\s+as\s+(.+)/i,/(email|phone)\s+(to|=|:)\s*[\w@.-]+/i,/from\s+[\w@.-]+\s+to\s+[\w@.-]+/i],create:[/add\s+(a\s+)?new?\s+contact/i,/create\s+(a\s+)?contact/i,/new\s+contact/i,/add\s+(.+)\s+to\s+(my\s+)?contacts/i,/save\s+(.+)\s+as\s+(a\s+)?contact/i],search:[/find\s+(contacts?|people|mike|john|jane|.+doe)/i,/search\s+(for\s+)?(contacts?|people)\s+(.+)/i,/look\s+(up|for)\s+(.+)/i,/who\s+(is|are)\s+(.+)/i,/show\s+(me\s+)?(contacts?\s+)?(named?|called?|from?)\s+(.+)/i,/get\s+(contact|info|details)\s+(for|about|of)\s+(.+)/i,/pull\s+(up\s+)?(the\s+)?(details|info|contact)/i,/his\s+current\s+email/i,/her\s+current\s+email/i],delete:[/delete\s+(the\s+)?contact/i,/remove\s+(the\s+)?contact/i,/trash\s+(the\s+)?contact/i],list:[/list\s+(all\s+)?(my\s+)?contacts/i,/show\s+(me\s+)?(all\s+)?(my\s+)?contacts/i,/get\s+(all\s+)?contacts/i,/how\s+many\s+contacts/i,/display\s+(all\s+)?contacts/i],analyze:[/analyze\s+(my\s+)?contacts/i,/contact\s+statistics/i,/contact\s+report/i,/summarize\s+(my\s+)?contacts/i,/contact\s+insights/i,/contact\s+analytics/i],bulk_email:[/send\s+email\s+to\s+(all|multiple|selected)/i,/bulk\s+email/i,/email\s+all\s+(.+)?contacts/i,/mass\s+email/i],bulk_sms:[/send\s+sms\s+to\s+(all|multiple|selected)/i,/bulk\s+sms/i,/sms\s+all\s+(.+)?contacts/i,/mass\s+sms/i,/text\s+(all|multiple)\s+contacts/i],bulk_tag:[/add\s+tag\s+(.+)\s+to\s+(all|multiple|selected)/i,/tag\s+(all|multiple)\s+contacts/i,/bulk\s+tag/i],bulk_delete:[/delete\s+(all|multiple|selected)\s+contacts/i,/bulk\s+delete/i,/remove\s+(all|multiple)\s+contacts/i],smart_list:[/create\s+(a\s+)?smart\s+list/i,/save\s+(this\s+)?filter\s+as/i,/save\s+(as\s+)?smart\s+list/i,/new\s+smart\s+list/i],export:[/export\s+(all\s+)?(my\s+)?contacts/i,/download\s+contacts/i,/export\s+to\s+(csv|json)/i,/get\s+contact\s+export/i],import:[/import\s+contacts/i,/upload\s+contacts/i,/import\s+from\s+(csv|file)/i],call:[/call\s+(.+)/i,/dial\s+(.+)/i,/phone\s+(.+)/i,/ring\s+(.+)/i],email:[/send\s+(an\s+)?email\s+to\s+(.+)/i,/compose\s+(an\s+)?email\s+(to\s+)?(.+)/i,/write\s+(an\s+)?email\s+(to\s+)?(.+)/i,/email\s+(him|her|them|this\s+contact)/i],sms:[/sms\s+(.+)/i,/text\s+(.+)/i,/send\s+sms\s+to\s+(.+)/i,/message\s+(.+)/i]},tN=/[\d\s()+-]{10,}/,tv=/(?:named?|called?|for|find|search|get|show)\s+["']?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)["']?/i,tS=/(?:from|at|company)\s+["']?([A-Za-z0-9\s&]+?)["']?(?:\s|$)/i,t_=/(?:status|stage|marked?\s+as)\s*(?:is|:)?\s*(new|contacted|qualified|customer|lost)/i,tR=/(?:tag(?:s|ged)?|add\s+(?:the\s+)?tag)\s*(?:with|:)?\s*["']?([^"']+?)["']?(?:\s+to\s+|$)/i,tO=/(?:list|as)\s+["']?([^"']+?)["']?(?:\s|$)/i,t$=/(?:export|download)\s+(?:as|to)\s+(csv|json)/i,tT=/(?:email|e-mail)(?:\s+address)?\s*(?:to|=|:)\s*([\w.-]+@[\w.-]+\.\w+)/i,tk=/(?:phone|number)\s*(?:to|=|:)\s*([\d\s()+-]{10,})/i,tx=/(?:from\s+)?([\w.-]+@[\w.-]+\.\w+)\s+to\s+([\w.-]+@[\w.-]+\.\w+)/i;class tM{subAccountId;constructor(t){this.subAccountId=t}parseIntent(t){let e=t.toLowerCase().trim(),a="unknown",s=0,n=e.includes("email");if(["change","update","edit","modify","set"].some(t=>e.includes(t))&&n)a="update",s=.95;else for(let[t,n]of Object.entries(tA)){for(let o of n)if(o.test(e)){a=t,s=.9;break}if(s>0)break}let o={},i=t.match(/^for\s+([\w.-]+@[\w.-]+\.\w+|[A-Z][a-z]+\s+[A-Z][a-z]+)\s*:/i);if(i){let t=i[1];if(t.includes("@"))o.email=t.toLowerCase();else{let e=t.split(/\s+/);o.firstName=e[0],e.length>1&&(o.lastName=e.slice(1).join(" "))}}if(!o.email){let e=t.match(/[\w.-]+@[\w.-]+\.\w+/gi)||[],a=t.match(/email\s+to\s+([\w.-]+@[\w.-]+\.\w+)/i),s=a?a[1].toLowerCase():null;for(let t of e)if(t.toLowerCase()!==s){o.email=t.toLowerCase();break}}let c=t.match(tN);c&&(o.phone=c[0].replace(/\s/g,""));let r=t.match(tv);if(r){let t=r[1].split(" ");o.firstName=t[0],t.length>1&&(o.lastName=t.slice(1).join(" "))}let l=t.match(tS);l&&(o.company=l[1].trim());let u=t.match(t_);u&&(o.status=u[1].toLowerCase());let d=t.match(tR);if(d&&(o.tags=d[1].split(/[,;]+/).map(t=>t.trim()).filter(t=>t.length>0)),!o.tags||0===o.tags.length){let e=t.match(/add\s+(?:the\s+)?tag\s+["']?([^"']+?)["']?\s+to/i);e&&(o.tags=[e[1].trim()])}if(!o.tags||0===o.tags.length){let e=t.match(/tag\s+["']([^"']+)["']/i);e&&(o.tags=[e[1].trim()])}let m=t.match(tO);m&&(o.listName=m[1].trim());let h=t.match(t$);h&&(o.exportFormat=h[1].toLowerCase());let p=t.match(tx);if(p&&(o.email=p[1].toLowerCase(),o.newEmail=p[2].toLowerCase(),"update"!==a&&(a="update"),s=.95),!o.newEmail){let e=t.match(tT);e&&(o.newEmail=e[1].toLowerCase())}let g=t.match(tk);if(g&&(o.newPhone=g[1].replace(/\s/g,"")),o.newEmail&&!o.email){let e=(t.match(/[\w.-]+@[\w.-]+\.\w+/gi)||[]).filter(t=>t.toLowerCase()!==o.newEmail);e.length>0&&(o.email=e[0].toLowerCase())}if(["search","call","email","sms"].includes(a)&&!o.firstName&&!o.email){let a="";for(let e of[/(?:find|search|look\s*(?:for|up)?|show|get|pull)\s+(?:contact\s+)?(?:for\s+)?(?:details?\s+)?(?:of\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)/i,/([A-Z][a-z]+\s+[A-Z][a-z]+)/]){let s=t.match(e);if(s&&s[1]){a=s[1].trim();break}}a||(a=e.replace(/^(hi|hello|hey|please|can you|could you|i need you to|i want to|i'd like to)[,\s]*/gi,"").replace(/\b(find|search|look|for|show|me|get|pull|up|contacts?|people|named?|called?|details?|of|the)\b/gi,"").replace(/\s+/g," ").trim()),a&&a.length>1&&(o.query=a)}return{action:a,confidence:s,entities:o}}async executeAction(t){let{action:e,entities:a}=t;switch(e){case"create":return this.createContact(a);case"search":return this.searchContacts(a);case"update":return this.updateContact(a);case"delete":return this.deleteContact(a);case"list":return this.listContacts(a);case"analyze":return this.analyzeContacts();case"bulk_email":return this.bulkEmail(a);case"bulk_sms":return this.bulkSms(a);case"bulk_tag":return this.bulkTag(a);case"bulk_delete":return this.bulkDelete(a);case"smart_list":return this.createSmartList(a);case"export":return this.exportContacts(a);case"import":return this.importContacts();case"call":return this.initiateCall(a);case"email":return this.composeEmail(a);case"sms":return this.composeSms(a);default:return{success:!1,action:"unknown",message:"I can help you manage contacts! Here are some things you can ask me:",suggestions:["Add a new contact","Find contacts named John","Show all my contacts","How many customers do I have?","Analyze my contacts","Export contacts to CSV","Create a smart list","Send email to all customers"],actionButtons:[{label:"Add Contact",action:"create",params:{}},{label:"List Contacts",action:"list",params:{}},{label:"Analyze",action:"analyze",params:{}},{label:"Export",action:"export",params:{}}]}}}async createContact(t){if(!t.firstName&&!t.email)return{success:!1,action:"create",message:"I need at least a name or email to create a contact. What information do you have?",suggestions:["Add John Smith with email john@example.com","Create a contact named Sarah at Tech Corp","New contact: Mike Johnson, mike@acme.com, 555-0123"],actionButtons:[{label:"Open Contact Form",action:"open_form",params:{type:"create"}}]};try{let e={subAccountId:this.subAccountId,firstName:t.firstName||"New",lastName:t.lastName||"Contact",email:t.email,phone:t.phone,company:t.company,status:t.status||"new",tags:t.tags||[],score:50},{data:a,error:s}=await tI.supabaseAdmin.from("Contact").insert(e).select().single();if(s)throw s;let n=`${a.firstName} ${a.lastName}`.trim();return{success:!0,action:"create",message:`I've created a new contact for **${n}**${a.email?` (${a.email})`:""}.

What would you like to do next?`,data:{contact:a,viewUrl:`/sub-account/contacts/${a.id}`},suggestions:[`Add ${a.firstName} to a pipeline`,`Send a welcome email to ${a.firstName}`,`Add more details to ${n}'s profile`],actionButtons:[{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${a.id}`}},{label:"Send Email",action:"email",params:{contactId:a.id}},{label:"Edit Details",action:"edit",params:{contactId:a.id}}]}}catch(t){return{success:!1,action:"create",message:`Sorry, I couldn't create the contact: ${t.message}`}}}async searchContacts(t){try{let e=tI.supabaseAdmin.from("Contact").select("*").eq("subAccountId",this.subAccountId).limit(10);if(t.email)e=e.ilike("email",`%${t.email}%`);else if(t.firstName||t.lastName||t.query){let a=t.query||`${t.firstName||""} ${t.lastName||""}`.trim(),s=a.split(/\s+/).filter(t=>t.length>0);if(s.length>=2){let t=s[0],n=s.slice(1).join(" ");e=e.or(`and(firstName.ilike.%${t}%,lastName.ilike.%${n}%),email.ilike.%${a}%,company.ilike.%${a}%`)}else if(1===s.length){let t=s[0];e=e.or(`firstName.ilike.%${t}%,lastName.ilike.%${t}%,email.ilike.%${t}%,company.ilike.%${t}%`)}}t.company&&(e=e.ilike("company",`%${t.company}%`)),t.status&&(e=e.eq("status",t.status));let{data:a,error:s}=await e.order("createdAt",{ascending:!1});if(s)throw s;if(!a||0===a.length)return{success:!0,action:"search",message:"I couldn't find any contacts matching your search. Would you like to create a new contact?",data:{contacts:[]},suggestions:["Add a new contact","Show all my contacts","Search with different criteria"],actionButtons:[{label:"Add Contact",action:"create",params:{}},{label:"View All Contacts",action:"navigate",params:{url:"/sub-account/contacts"}}]};let n=a.slice(0,5).map((t,e)=>`${e+1}. **${t.firstName} ${t.lastName}** - ${t.email||"No email"}${t.company?` (${t.company})`:""} - *${t.status}*`).join("\n");return{success:!0,action:"search",message:`Found **${a.length}** contact${1!==a.length?"s":""}:

${n}${a.length>5?"\n\n...and more":""}

What would you like to do?`,data:{contacts:a,count:a.length},suggestions:a.slice(0,3).map(t=>`View ${t.firstName}'s profile`),actionButtons:a.slice(0,3).map(t=>({label:`View ${t.firstName}`,action:"navigate",params:{url:`/sub-account/contacts/${t.id}`}}))}}catch(t){return{success:!1,action:"search",message:`Sorry, I had trouble searching contacts: ${t.message}`}}}async updateContact(t){if(!t.contactId&&!t.email&&!t.firstName)return{success:!1,action:"update",message:"I need to know which contact to update. Please specify a name or email.",suggestions:["Update John Smith's email","Change phone for john@example.com","Mark Jane as customer"]};let e=await this.searchContacts(t);if(!e.data?.contacts?.length)return{success:!1,action:"update",message:"I couldn't find a contact to update. Please check the name or email."};let a=e.data.contacts[0],s={lastActivityAt:new Date().toISOString()},n=[];if(t.newEmail&&(s.email=t.newEmail,n.push(`email to **${t.newEmail}**`)),t.newPhone&&(s.phone=t.newPhone,n.push(`phone to **${t.newPhone}**`)),t.status&&(s.status=t.status,n.push(`status to **${t.status}**`)),t.tags&&t.tags.length>0&&(s.tags=[...a.tags||[],...t.tags],n.push(`added tags: **${t.tags.join(", ")}**`)),n.length>0)try{let{data:t,error:e}=await tI.supabaseAdmin.from("Contact").update(s).eq("id",a.id).eq("subAccountId",this.subAccountId).select().single();if(e)throw e;return{success:!0,action:"update",message:`âœ… Updated **${a.firstName} ${a.lastName}**:
â€¢ ${n.join("\nâ€¢ ")}`,data:{contact:t},actionButtons:[{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${a.id}`}}]}}catch(t){return{success:!1,action:"update",message:`Failed to update contact: ${t.message}`}}return{success:!0,action:"update",message:`Found **${a.firstName} ${a.lastName}** (${a.email||"no email"}). What would you like to update?

Examples:
â€¢ "Update email to newemail@example.com"
â€¢ "Change status to customer"
â€¢ "Add tag VIP"`,data:{contact:a},suggestions:["Set status to customer","Update email to newemail@example.com",'Add tag "VIP"'],actionButtons:[{label:"Edit Contact",action:"edit",params:{contactId:a.id}}]}}async deleteContact(t){if(!t.contactId&&!t.email&&!t.firstName)return{success:!1,action:"delete",message:"I need to know which contact to delete. Please specify a name or email.",suggestions:["Delete contact john@example.com","Remove John Smith from contacts"]};let e=await this.searchContacts(t);if(!e.data?.contacts?.length)return{success:!1,action:"delete",message:"I couldn't find that contact. Please check the name or email."};let a=e.data.contacts[0],s=`${a.firstName} ${a.lastName}`.trim();return{success:!0,action:"delete",message:`Are you sure you want to delete **${s}** (${a.email})?

This action cannot be undone.`,data:{contact:a,requiresConfirmation:!0},actionButtons:[{label:"Yes, Delete",action:"confirm_delete",params:{contactId:a.id}},{label:"Cancel",action:"cancel",params:{}}]}}async listContacts(t){try{let e=tI.supabaseAdmin.from("Contact").select("*").eq("subAccountId",this.subAccountId);t.status&&(e=e.eq("status",t.status)),t.filterStatus&&(e=e.eq("status",t.filterStatus));let{data:a,count:s,error:n}=await e.order("createdAt",{ascending:!1}).limit(10);if(n)throw n;if(!a||0===a.length)return{success:!0,action:"list",message:"You don't have any contacts yet. Would you like to add your first contact or import contacts?",data:{contacts:[],count:0},suggestions:["Add a new contact","Import contacts from CSV","Import from GoHighLevel"],actionButtons:[{label:"Add Contact",action:"create",params:{}},{label:"Import Contacts",action:"navigate",params:{url:"/sub-account/settings/import"}}]};let{count:o}=await tI.supabaseAdmin.from("Contact").select("*",{count:"exact",head:!0}).eq("subAccountId",this.subAccountId),i=a.reduce((t,e)=>(t[e.status]=(t[e.status]||0)+1,t),{}),c=Object.entries(i).map(([t,e])=>`${t}: ${e}`).join(", "),r=a.slice(0,5).map((t,e)=>`${e+1}. **${t.firstName} ${t.lastName}** - ${t.status}${t.company?` at ${t.company}`:""}`).join("\n");return{success:!0,action:"list",message:`You have **${o||a.length}** total contacts.

**Recent contacts:**
${r}

**By status:** ${c}`,data:{contacts:a,totalCount:o||a.length,statusCounts:i},suggestions:["Show me customers only","Find new leads","Export all contacts"],actionButtons:[{label:"View All",action:"navigate",params:{url:"/sub-account/contacts"}},{label:"Add Contact",action:"create",params:{}},{label:"Export",action:"export",params:{}}]}}catch(t){return{success:!1,action:"list",message:`Sorry, I couldn't list contacts: ${t.message}`}}}async analyzeContacts(){try{let{data:t,error:e}=await tI.supabaseAdmin.from("Contact").select("*").eq("subAccountId",this.subAccountId);if(e)throw e;if(!t||0===t.length)return{success:!0,action:"analyze",message:"You don't have any contacts to analyze yet. Let's get started by adding some contacts!",suggestions:["Add a new contact","Import from GoHighLevel"],actionButtons:[{label:"Add Contact",action:"create",params:{}},{label:"Import",action:"navigate",params:{url:"/sub-account/settings/import"}}]};let a=t.length,s=t.reduce((t,e)=>(t[e.status]=(t[e.status]||0)+1,t),{}),n=t.filter(t=>t.email).length,o=t.filter(t=>t.phone).length,i=Math.round(t.reduce((t,e)=>t+(e.score||0),0)/a),c={};t.forEach(t=>{(t.tags||[]).forEach(t=>{c[t]=(c[t]||0)+1})});let r=Object.entries(c).sort(([,t],[,e])=>e-t).slice(0,5),l={};t.forEach(t=>{let e=t.source||"Unknown";l[e]=(l[e]||0)+1});let u=Object.entries(l).sort(([,t],[,e])=>e-t).slice(0,5),d=`## Contact Database Analysis

**Total Contacts:** ${a}

### By Status
${Object.entries(s).map(([t,e])=>`- **${t}:** ${e} (${Math.round(e/a*100)}%)`).join("\n")}

### Data Quality
- With email: ${n} (${Math.round(n/a*100)}%)
- With phone: ${o} (${Math.round(o/a*100)}%)
- Average lead score: ${i}/100

${r.length>0?`### Top Tags
${r.map(([t,e])=>`- ${t}: ${e}`).join("\n")}`:""}

${u.length>0?`### Top Sources
${u.map(([t,e])=>`- ${t}: ${e}`).join("\n")}`:""}`;return{success:!0,action:"analyze",message:d,data:{total:a,statusBreakdown:s,dataQuality:{withEmail:n,withPhone:o,avgScore:i},topTags:r,topSources:u},suggestions:["Show me contacts without email","Find hot leads (score > 80)","Export contact report","Create smart list for customers"],actionButtons:[{label:"View Contacts",action:"navigate",params:{url:"/sub-account/contacts"}},{label:"Export Report",action:"export",params:{format:"csv"}}]}}catch(t){return{success:!1,action:"analyze",message:`Sorry, I couldn't analyze contacts: ${t.message}`}}}async bulkEmail(t){let e=tI.supabaseAdmin.from("Contact").select("id, firstName, lastName, email").eq("subAccountId",this.subAccountId).not("email","is",null);t.filterStatus&&(e=e.eq("status",t.filterStatus));let{data:a,error:s}=await e;return s||!a||0===a.length?{success:!1,action:"bulk_email",message:"No contacts found matching your criteria. Try a different filter."}:{success:!0,action:"bulk_email",message:`Ready to send email to **${a.length}** contacts.

Please compose your email:`,data:{contacts:a,count:a.length},suggestions:["What subject line would you like?","What message would you like to send?"],actionButtons:[{label:"Open Bulk Email",action:"navigate",params:{url:"/sub-account/contacts/bulk-actions"}}]}}async bulkSms(t){let e=tI.supabaseAdmin.from("Contact").select("id, firstName, lastName, phone").eq("subAccountId",this.subAccountId).not("phone","is",null);t.filterStatus&&(e=e.eq("status",t.filterStatus));let{data:a,error:s}=await e;return s||!a||0===a.length?{success:!1,action:"bulk_sms",message:"No contacts with phone numbers found. Try adding phone numbers to your contacts."}:{success:!0,action:"bulk_sms",message:`Ready to send SMS to **${a.length}** contacts with phone numbers.

Please compose your message:`,data:{contacts:a,count:a.length},actionButtons:[{label:"Open Bulk Actions",action:"navigate",params:{url:"/sub-account/contacts/bulk-actions"}}]}}async bulkTag(t){return t.tags&&0!==t.tags.length?{success:!0,action:"bulk_tag",message:`Ready to add tag **${t.tags.join(", ")}** to selected contacts.

Would you like to proceed?`,data:{tags:t.tags},actionButtons:[{label:"Go to Bulk Actions",action:"navigate",params:{url:"/sub-account/contacts/bulk-actions"}}]}:{success:!1,action:"bulk_tag",message:"What tag would you like to add? For example: 'Add tag VIP to all customers'",suggestions:["Add tag 'VIP' to all customers","Tag all new contacts with 'Newsletter'"]}}async bulkDelete(t){return{success:!0,action:"bulk_delete",message:"âš ï¸ **Warning:** Bulk delete is a destructive action.\n\nPlease go to the Contacts page, select the contacts you want to delete, and use the bulk delete option.",actionButtons:[{label:"Go to Contacts",action:"navigate",params:{url:"/sub-account/contacts"}}]}}async createSmartList(t){return t.listName?{success:!0,action:"smart_list",message:`I'll help you create a smart list called **${t.listName}**.

Please go to the Smart Lists page to configure the filters.`,data:{listName:t.listName},actionButtons:[{label:"Create Smart List",action:"navigate",params:{url:"/sub-account/contacts/smart-lists"}}]}:{success:!1,action:"smart_list",message:"What would you like to name this smart list? For example: 'Save as Hot Leads'",suggestions:["Save as 'Hot Leads'","Create list 'VIP Customers'","Save filter as 'Needs Follow-up'"]}}async exportContacts(t){let e=t.exportFormat||"csv";return{success:!0,action:"export",message:`I'll help you export your contacts as ${e.toUpperCase()}.

Click the button below or go to the Contacts page and click the Export button.`,data:{format:e},actionButtons:[{label:"Export Contacts",action:"navigate",params:{url:"/sub-account/contacts?export=true"}}]}}async importContacts(){return{success:!0,action:"import",message:`I can help you import contacts from:

1. **CSV File** - Upload a spreadsheet
2. **GoHighLevel** - Import from your GHL account
3. **Other CRMs** - HubSpot, Salesforce, etc. (coming soon)

Click below to get started!`,actionButtons:[{label:"Import CSV",action:"navigate",params:{url:"/sub-account/contacts?import=true"}},{label:"Import from GHL",action:"navigate",params:{url:"/sub-account/settings/import"}}]}}async initiateCall(t){let e=await this.searchContacts(t);if(!e.data?.contacts?.length)return{success:!1,action:"call",message:"I couldn't find that contact. Please provide a name or phone number.",suggestions:["Call John Smith","Dial 555-0123"]};let a=e.data.contacts[0];return a.phone?{success:!0,action:"call",message:`Ready to call **${a.firstName} ${a.lastName}** at ${a.phone}`,data:{contact:a},actionButtons:[{label:`Call ${a.phone}`,action:"call",params:{phone:a.phone,contactId:a.id}},{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${a.id}`}}]}:{success:!1,action:"call",message:`**${a.firstName} ${a.lastName}** doesn't have a phone number on file. Would you like to add one?`,actionButtons:[{label:"Edit Contact",action:"edit",params:{contactId:a.id}}]}}async composeEmail(t){let e=await this.searchContacts(t);if(!e.data?.contacts?.length)return{success:!1,action:"email",message:"I couldn't find that contact. Please provide a name or email address."};let a=e.data.contacts[0];return{success:!0,action:"email",message:`Ready to send email to **${a.firstName} ${a.lastName}** (${a.email})`,data:{contact:a},actionButtons:[{label:"Compose Email",action:"email",params:{contactId:a.id,email:a.email}},{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${a.id}`}}]}}async composeSms(t){let e=await this.searchContacts(t);if(!e.data?.contacts?.length)return{success:!1,action:"sms",message:"I couldn't find that contact. Please provide a name or phone number."};let a=e.data.contacts[0];return a.phone?{success:!0,action:"sms",message:`Ready to send SMS to **${a.firstName} ${a.lastName}** (${a.phone})`,data:{contact:a},actionButtons:[{label:"Send SMS",action:"sms",params:{contactId:a.id,phone:a.phone}},{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${a.id}`}}]}:{success:!1,action:"sms",message:`**${a.firstName} ${a.lastName}** doesn't have a phone number. Would you like to add one?`,actionButtons:[{label:"Edit Contact",action:"edit",params:{contactId:a.id}}]}}async processRequest(t){let e=this.parseIntent(t);return this.executeAction(e)}async processRequestWithContact(t,e){let a=this.parseIntent(t);return"update"===a.action?this.updateContactDirect(e,a.entities):(!a.entities.email&&e.email&&(a.entities.email=e.email),!a.entities.firstName&&e.firstName&&(a.entities.firstName=e.firstName,a.entities.lastName=e.lastName),!a.entities.contactId&&e.id&&(a.entities.contactId=e.id),this.executeAction(a))}async updateContactDirect(t,e){let a={lastActivityAt:new Date().toISOString()},s=[];if(e.newEmail&&(a.email=e.newEmail,s.push(`email from **${t.email}** to **${e.newEmail}**`)),e.newPhone&&(a.phone=e.newPhone,s.push(`phone to **${e.newPhone}**`)),e.status&&(a.status=e.status,s.push(`status to **${e.status}**`)),e.tags&&e.tags.length>0&&(a.tags=[...t.tags||[],...e.tags],s.push(`added tags: **${e.tags.join(", ")}**`)),s.length>0)try{let{data:e,error:n}=await tI.supabaseAdmin.from("Contact").update(a).eq("id",t.id).eq("subAccountId",this.subAccountId).select().single();if(n)throw n;return{success:!0,action:"update",message:`âœ… Updated **${t.firstName} ${t.lastName}**:
â€¢ ${s.join("\nâ€¢ ")}`,data:{contact:e},actionButtons:[{label:"View Contact",action:"navigate",params:{url:`/sub-account/contacts/${t.id}`}}]}}catch(t){return{success:!1,action:"update",message:`Failed to update contact: ${t.message}`}}return{success:!0,action:"update",message:`What would you like to update for **${t.firstName} ${t.lastName}** (${t.email})?

You can say:
â€¢ "Update email to newemail@example.com"
â€¢ "Change status to customer"
â€¢ "Add tag VIP"`,data:{contact:t},actionButtons:[{label:"Edit Contact",action:"edit",params:{contactId:t.id}}]}}}let tP=new class{constructor(t){this.apiKey=t}getGenerativeModel(t,e){if(!t.model)throw new Y("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new tb(this.apiKey,t,e)}getGenerativeModelFromCachedContent(t,e,a){if(!t.name)throw new W("Cached content must contain a `name` field.");if(!t.model)throw new W("Cached content must contain a `model` field.");for(let a of["model","systemInstruction"])if((null==e?void 0:e[a])&&t[a]&&(null==e?void 0:e[a])!==t[a]){if("model"===a&&(e.model.startsWith("models/")?e.model.replace("models/",""):e.model)===(t.model.startsWith("models/")?t.model.replace("models/",""):t.model))continue;throw new W(`Different value for "${a}" specified in modelParams (${e[a]}) and cachedContent (${t[a]})`)}let s=Object.assign(Object.assign({},e),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new tb(this.apiKey,s,a)}}(process.env.GEMINI_API_KEY||""),tU=`You are Sarah, an intelligent AI assistant for RISIVO CRM. Your job is to help users manage their CRM effectively.

Analyze the user's message and determine the intent and extract relevant entities.

CONTACT INTENTS:
- create_contact: User wants to add a new contact
- search_contacts: User wants to find contacts
- list_contacts: User wants to see all contacts or a summary
- update_contact: User wants to modify a contact
- delete_contact: User wants to remove a contact
- analyze_contacts: User wants statistics or insights about contacts

PIPELINE INTENTS:
- create_pipeline: User wants to create a sales pipeline
- list_pipelines: User wants to see pipelines
- pipeline_stats: User wants pipeline analytics

OTHER INTENTS:
- help: User needs guidance
- greeting: User is greeting
- unknown: Cannot determine intent

Respond in JSON format:
{
  "intent": "intent_name",
  "confidence": 0.0-1.0,
  "entities": {
    "firstName": "extracted name",
    "lastName": "if found",
    "email": "if found",
    "phone": "if found",
    "company": "if found",
    "query": "search term if applicable"
  },
  "suggestedResponse": "A helpful response to guide the user"
}

User message: `;async function tD(t){try{let e,a,{message:s,subAccountId:n,userId:o,context:i}=await t.json();if(!s||"string"!=typeof s)return q.NextResponse.json({success:!1,error:"Message is required"},{status:400});if(!n||!o)return q.NextResponse.json({success:!1,error:"subAccountId and userId are required"},{status:400});let c=tP.getGenerativeModel({model:"gemini-2.0-flash-exp"}),r=(await c.generateContent(tU+s)).response.text();try{let t=r.match(/\{[\s\S]*\}/);if(t)e=JSON.parse(t[0]);else throw Error("No JSON found in response")}catch(t){console.error("Failed to parse intent:",r),e={intent:"unknown",confidence:0,entities:{},suggestedResponse:"I'd be happy to help! You can ask me to manage contacts, search your CRM, create pipelines, or get analytics. What would you like to do?"}}let l=e.intent;if(l.includes("contact")){let t=new tM(n),e=await t.processRequest(s);a={message:e.message,action:{type:e.action,data:e.data,suggestions:e.suggestions,actionButtons:e.actionButtons}}}else if("create_pipeline"===l)a={message:"I can help you create a pipeline! What type of business are you in? I'll suggest stages that work best for your industry.\n\n**Popular templates:**\nâ€¢ Sales Pipeline (Lead â†’ Qualified â†’ Demo â†’ Proposal â†’ Closed)\nâ€¢ Real Estate (Inquiry â†’ Showing â†’ Offer â†’ Contract â†’ Closed)\nâ€¢ Agency (Prospect â†’ Discovery â†’ Proposal â†’ Negotiation â†’ Won)",action:{type:"create_pipeline",suggestions:["Create a sales pipeline","Create a real estate pipeline","Create a custom pipeline"]}};else if("list_pipelines"===l||"pipeline_stats"===l){let{data:t}=await tI.supabaseAdmin.from("Pipeline").select("*, stages:PipelineStage(*)").eq("subAccountId",n);if(t&&0!==t.length){let e=t.map((t,e)=>`${e+1}. **${t.name}** - ${t.stages?.length||0} stages`).join("\n");a={message:`You have **${t.length}** pipeline${1!==t.length?"s":""}:

${e}`,action:{type:"list_pipelines",data:{pipelines:t},suggestions:["View pipeline details","Create new pipeline","Show pipeline analytics"]}}}else a={message:"You don't have any pipelines set up yet. Would you like me to help you create one?",action:{type:"list_pipelines",data:{pipelines:[]},suggestions:["Create a new pipeline","What is a pipeline?"]}}}else if("help"===l)a={message:`**Here's what I can help you with:**

ðŸ§‘â€ðŸ’¼ **Contacts**
â€¢ "Add a new contact" - Create contacts with voice or text
â€¢ "Find John Smith" - Search your contacts
â€¢ "Show all my contacts" - List and manage contacts
â€¢ "How many customers do I have?" - Get contact analytics

ðŸ“Š **Pipelines**
â€¢ "Create a sales pipeline" - Set up deal stages
â€¢ "Show my pipelines" - View your sales funnels

ðŸ“ˆ **Analytics**
â€¢ "Analyze my contacts" - Get insights and reports

ðŸ’¬ **Just ask naturally!** I understand context, so feel free to chat like you would with a real assistant.`,action:{type:"help",suggestions:["Add a new contact","Show my contacts","Create a pipeline","Analyze my data"]}};else if("greeting"===l){let t=["Hello! ðŸ‘‹ I'm Sarah, your AI assistant. How can I help you manage your CRM today?","Hi there! Ready to help you with your contacts, pipelines, or anything else you need!","Hey! What can I do for you today? I'm here to make CRM management easier."];a={message:t[Math.floor(Math.random()*t.length)],action:{type:"greeting",suggestions:["Show my contacts","Create a contact","What can you do?"]}}}else a={message:e.suggestedResponse||"I'm not sure what you'd like to do. Try asking me to manage contacts, search your CRM, or create pipelines!",action:{type:"unknown",suggestions:["Show all contacts","Add a contact","Help"]}};return await tH({subAccountId:n,userId:o,message:s,intent:l,response:a.message}),q.NextResponse.json({success:!0,data:a})}catch(t){return console.error("AI Assistant Error:",t),q.NextResponse.json({success:!1,error:t.message||"Failed to process request",data:{message:"Sorry, I encountered an error. Please try again or rephrase your request.",action:{type:"error",suggestions:["Try again","Help"]}}},{status:500})}}async function tH(t){try{await tI.supabaseAdmin.from("AiUsageLog").insert({subAccountId:t.subAccountId,aiModel:"gemini-2.0-flash-exp",tokensUsed:Math.ceil((t.message.length+t.response.length)/4),cost:0,metadata:{type:"assistant_interaction",intent:t.intent,userId:t.userId}})}catch(t){console.error("Failed to log interaction:",t)}}async function tL(){return q.NextResponse.json({success:!0,data:{name:"Sarah",model:"Gemini 2.0 Flash",capabilities:["contact_management","pipeline_management","voice_commands","natural_language_search","analytics"],status:"active",version:"1.0.0"}})}t.s(["GET",()=>tL,"POST",()=>tD],55576);var tj=t.i(55576);let tF=new v.AppRouteRouteModule({definition:{kind:S.RouteKind.APP_ROUTE,page:"/api/v1/ai/assistant/route",pathname:"/api/v1/ai/assistant",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/ai/assistant/route.ts",nextConfigOutput:"",userland:tj}),{workAsyncStorage:tB,workUnitAsyncStorage:tq,serverHooks:tG}=tF;function tY(){return(0,_.patchFetch)({workAsyncStorage:tB,workUnitAsyncStorage:tq})}async function tK(t,e,a){tF.isDev&&(0,R.addRequestMeta)(t,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/v1/ai/assistant/route";s=s.replace(/\/index$/,"")||"/";let n=await tF.prepare(t,e,{srcPage:s,multiZoneDraftMode:!1});if(!n)return e.statusCode=400,e.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:o,params:i,nextConfig:c,parsedUrl:r,isDraftMode:l,prerenderManifest:u,routerServerContext:d,isOnDemandRevalidate:m,revalidateOnlyGenerated:h,resolvedPathname:p,clientReferenceManifest:g,serverActionsManifest:f}=n,y=(0,k.normalizeAppPath)(s),C=!!(u.dynamicRoutes[y]||u.routes[p]),w=async()=>((null==d?void 0:d.render404)?await d.render404(t,e,r,!1):e.end("This page could not be found"),null);if(C&&!l){let t=!!u.routes[p],e=u.dynamicRoutes[y];if(e&&!1===e.fallback&&!t){if(c.experimental.adapterPath)return await w();throw new F.NoFallbackError}}let E=null;!C||tF.isDev||l||(E="/index"===(E=p)?"/":E);let b=!0===tF.isDev||!C,I=C&&!b;f&&g&&(0,$.setReferenceManifestsSingleton)({page:s,clientReferenceManifest:g,serverActionsManifest:f,serverModuleMap:(0,T.createServerModuleMap)({serverActionsManifest:f})});let A=t.method||"GET",N=(0,O.getTracer)(),v=N.getActiveScopeSpan(),_={params:i,prerenderManifest:u,renderOpts:{experimental:{authInterrupts:!!c.experimental.authInterrupts},cacheComponents:!!c.cacheComponents,supportsDynamicResponse:b,incrementalCache:(0,R.getRequestMeta)(t,"incrementalCache"),cacheLifeProfiles:c.cacheLife,waitUntil:a.waitUntil,onClose:t=>{e.on("close",t)},onAfterTaskError:void 0,onInstrumentationRequestError:(e,a,s)=>tF.onRequestError(t,e,s,d)},sharedContext:{buildId:o}},q=new x.NodeNextRequest(t),G=new x.NodeNextResponse(e),Y=M.NextRequestAdapter.fromNodeNextRequest(q,(0,M.signalFromNodeResponse)(e));try{let n=async t=>tF.handle(Y,_).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":e.statusCode,"next.rsc":!1});let a=N.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==P.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${A} ${n}`;t.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),t.updateName(e)}else t.updateName(`${A} ${s}`)}),o=!!(0,R.getRequestMeta)(t,"minimalMode"),i=async i=>{var r,p;let g=async({previousCacheEntry:c})=>{try{if(!o&&m&&h&&!c)return e.statusCode=404,e.setHeader("x-nextjs-cache","REVALIDATED"),e.end("This page could not be found"),null;let s=await n(i);t.fetchMetrics=_.renderOpts.fetchMetrics;let r=_.renderOpts.pendingWaitUntil;r&&a.waitUntil&&(a.waitUntil(r),r=void 0);let l=_.renderOpts.collectedTags;if(!C)return await (0,D.sendResponse)(q,G,s,_.renderOpts.pendingWaitUntil),null;{let t=await s.blob(),e=(0,H.toNodeOutgoingHttpHeaders)(s.headers);l&&(e[j.NEXT_CACHE_TAGS_HEADER]=l),!e["content-type"]&&t.type&&(e["content-type"]=t.type);let a=void 0!==_.renderOpts.collectedRevalidate&&!(_.renderOpts.collectedRevalidate>=j.INFINITE_CACHE)&&_.renderOpts.collectedRevalidate,n=void 0===_.renderOpts.collectedExpire||_.renderOpts.collectedExpire>=j.INFINITE_CACHE?void 0:_.renderOpts.collectedExpire;return{value:{kind:B.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await t.arrayBuffer()),headers:e},cacheControl:{revalidate:a,expire:n}}}}catch(e){throw(null==c?void 0:c.isStale)&&await tF.onRequestError(t,e,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,U.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:m})},d),e}},f=await tF.handleResponse({req:t,nextConfig:c,cacheKey:E,routeKind:S.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:u,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:h,responseGenerator:g,waitUntil:a.waitUntil,isMinimalMode:o});if(!C)return null;if((null==f||null==(r=f.value)?void 0:r.kind)!==B.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(p=f.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||e.setHeader("x-nextjs-cache",m?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),l&&e.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,H.fromNodeOutgoingHttpHeaders)(f.value.headers);return o&&C||y.delete(j.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||e.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,L.getCacheControlHeader)(f.cacheControl)),await (0,D.sendResponse)(q,G,new Response(f.value.body,{headers:y,status:f.value.status||200})),null};v?await i(v):await N.withPropagatedContext(t.headers,()=>N.trace(P.BaseServerSpan.handleRequest,{spanName:`${A} ${s}`,kind:O.SpanKind.SERVER,attributes:{"http.method":A,"http.target":t.url}},i))}catch(e){if(e instanceof F.NoFallbackError||await tF.onRequestError(t,e,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,U.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:m})}),C)throw e;return await (0,D.sendResponse)(q,G,new Response(null,{status:500})),null}}t.s(["handler",()=>tK,"patchFetch",()=>tY,"routeModule",()=>tF,"serverHooks",()=>tG,"workAsyncStorage",()=>tB,"workUnitAsyncStorage",()=>tq],39848)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_dcb157ab.js.map