module.exports=[89838,e=>{"use strict";var t=e.i(47909),o=e.i(74017),i=e.i(96250),n=e.i(59756),a=e.i(61916),r=e.i(14444),s=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),m=e.i(66012),h=e.i(70101),g=e.i(26937),f=e.i(10372),v=e.i(93695);e.i(52474);var y=e.i(220),R=e.i(89171),x=e.i(62294),w=e.i(87772),E=e.i(15976),S=e.i(54799);function A(){return S.default.randomBytes(32).toString("hex")}async function b(e,t,o){let i=process.env.NEXT_PUBLIC_APP_URL||"https://app.risivo.com",n=`${i}/demo/verify?token=${o}`,a=process.env.SENDGRID_API_KEY;if(!a)return console.log("========================================"),console.log("DEMO VERIFICATION EMAIL (No email service configured)"),console.log("To:",e),console.log("Name:",t),console.log("Verification Link:",n),console.log("========================================"),!0;try{let o=await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({personalizations:[{to:[{email:e,name:t}],subject:"Verify your RISIVO CRM Demo Access"}],from:{email:process.env.SENDGRID_FROM_EMAIL||"hello@risivo.com",name:process.env.SENDGRID_FROM_NAME||"RISIVO CRM"},content:[{type:"text/html",value:`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
      <div style="text-align: center; margin-bottom: 30px;">
        <img src="https://app.risivo.com/risivo-logo-color.png" alt="RISIVO CRM" style="height: 40px;">
      </div>
      
      <h1 style="color: #1a1a1a; font-size: 24px; margin-bottom: 20px;">Welcome to RISIVO CRM, ${t}!</h1>
      
      <p style="margin-bottom: 20px;">Thank you for signing up for a demo of RISIVO CRM. Please verify your email address to complete your registration and access the demo.</p>
      
      <div style="text-align: center; margin: 30px 0;">
        <a href="${n}" style="display: inline-block; background-color: #2563eb; color: white; padding: 14px 28px; text-decoration: none; border-radius: 8px; font-weight: 600;">Verify Email & Set Password</a>
      </div>
      
      <p style="color: #666; font-size: 14px;">This link will expire in 24 hours. If you didn't request this, you can safely ignore this email.</p>
      
      <p style="color: #666; font-size: 14px;">If the button doesn't work, copy and paste this link into your browser:</p>
      <p style="color: #2563eb; font-size: 12px; word-break: break-all;">${n}</p>
      
      <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
        <p style="color: #999; font-size: 12px; text-align: center; margin: 0 0 10px 0;">
          <a href="https://risivo.com/terms-of-service" style="color: #666; text-decoration: none;">Terms of Service</a>
          &nbsp;|&nbsp;
          <a href="https://risivo.com/privacy-policy" style="color: #666; text-decoration: none;">Privacy Policy</a>
          &nbsp;|&nbsp;
          <a href="mailto:support@risivo.com" style="color: #666; text-decoration: none;">Contact Support</a>
        </p>
        <p style="color: #999; font-size: 11px; text-align: center; margin: 0;">
          \xa9 ${new Date().getFullYear()} Risivoâ„¢ by Velocity Automation Corp. All rights reserved.
        </p>
      </div>
    </body>
    </html>
  `}],tracking_settings:{click_tracking:{enable:!1},open_tracking:{enable:!1}}})});if(!o.ok){let e=await o.text();return console.error("[Demo Signup] Failed to send verification email via SendGrid:",o.status,e),!1}return console.log("[Demo Signup] Verification email sent successfully to:",e),!0}catch(e){return console.error("[Demo Signup] Error sending verification email:",e),!1}}async function D(e){console.log("[Demo Signup] Request received");let t="true"===new URL(e.url).searchParams.get("test");try{let{name:o,email:i,company:n,phone:a}=await e.json();if(!o||!i||!n)return R.NextResponse.json({success:!1,error:"Name, email, and company are required"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return R.NextResponse.json({success:!1,error:"Invalid email format"},{status:400});let r=i.toLowerCase().trim();if(!x.prisma)return R.NextResponse.json({success:!1,error:"Database not available"},{status:503});let s=await x.prisma.demoAccess.findUnique({where:{email:r}});if(s){if(s.emailVerified&&"active"===s.status)return R.NextResponse.json({success:!1,error:"An account with this email already exists. Please log in instead."},{status:409});if(!s.emailVerified||"pending_verification"===s.status){let e=A();return await x.prisma.demoAccess.update({where:{id:s.id},data:{verificationToken:e,verificationSentAt:new Date,name:o,company:n,phone:a}}),await b(r,o,e),R.NextResponse.json({success:!0,message:"A verification email has been sent. Please check your inbox.",isResend:!0})}if("expired"===s.status||"revoked"===s.status){let e=A(),t=new Date;return t.setDate(t.getDate()+w.DEMO_SETTINGS.EXPIRY_DAYS),await x.prisma.demoAccess.update({where:{id:s.id},data:{name:o,company:n,phone:a,verificationToken:e,verificationSentAt:new Date,emailVerified:!1,password:null,status:"pending_verification",expiresAt:t,signupSource:"self_signup"}}),await b(r,o,e),R.NextResponse.json({success:!0,message:"A verification email has been sent. Please check your inbox."})}}let l=A(),c=new Date;c.setDate(c.getDate()+w.DEMO_SETTINGS.EXPIRY_DAYS);let d=await x.prisma.demoAccess.create({data:{name:o,email:r,company:n,phone:a,verificationToken:l,verificationSentAt:new Date,status:"pending_verification",expiresAt:c,signupSource:"self_signup"}});console.log("[Demo Signup] Created demo access:",d.id),await b(r,o,l)||console.error("[Demo Signup] Failed to send verification email");let u=(0,E.getAdminNewSignupEmail)({name:o,email:r,company:n,phone:a,signupTime:new Date});try{await (0,E.sendAdminNotification)(u)?console.log("[Demo Signup] Admin notification sent successfully"):console.error("[Demo Signup] Admin notification failed to send")}catch(e){console.error("[Demo Signup] Failed to send admin notification:",e)}let p=process.env.NEXT_PUBLIC_APP_URL||"https://app.risivo.com",m=`${p}/demo/verify?token=${l}`,h=!!process.env.SENDGRID_API_KEY;return R.NextResponse.json({success:!0,message:h?"Thank you for signing up! Please check your email to verify your account.":"Thank you for signing up! Email service not configured - use the verification URL below.",...(t||!h)&&{verificationUrl:m,_note:"Use this URL to verify your email and set your password"}})}catch(e){if(console.error("[Demo Signup] Error:",e),"P2002"===e.code)return R.NextResponse.json({success:!1,error:"An account with this email already exists."},{status:409});return R.NextResponse.json({success:!1,error:"Failed to process signup. Please try again."},{status:500})}}e.s(["POST",()=>D,"dynamic",0,"force-dynamic","runtime",0,"nodejs"],85705);var C=e.i(85705);let N=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/demo/signup/route",pathname:"/api/demo/signup",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/demo/signup/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:P,workUnitAsyncStorage:_,serverHooks:I}=N;function T(){return(0,i.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:_})}async function k(e,t,i){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/demo/signup/route";R=R.replace(/\/index$/,"")||"/";let x=await N.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:S,parsedUrl:A,isDraftMode:b,prerenderManifest:D,routerServerContext:C,isOnDemandRevalidate:P,revalidateOnlyGenerated:_,resolvedPathname:I,clientReferenceManifest:T,serverActionsManifest:k}=x,O=(0,l.normalizeAppPath)(R),M=!!(D.dynamicRoutes[O]||D.routes[I]),U=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,A,!1):t.end("This page could not be found"),null);if(M&&!b){let e=!!D.routes[I],t=D.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await U();throw new v.NoFallbackError}}let j=null;!M||N.isDev||b||(j="/index"===(j=I)?"/":j);let $=!0===N.isDev||!M,q=M&&!$;k&&T&&(0,r.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:T,serverActionsManifest:k,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:k})});let F=e.method||"GET",H=(0,a.getTracer)(),V=H.getActiveScopeSpan(),L={params:E,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,i)=>N.onRequestError(e,t,i,C)},sharedContext:{buildId:w}},B=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let r=async e=>N.handle(K,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=H.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=o.get("next.route");if(i){let t=`${F} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${R}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let c=async({previousCacheEntry:o})=>{try{if(!s&&P&&_&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await r(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)(B,G,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:i}}}}catch(t){throw(null==o?void 0:o.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},C),t}},d=await N.handleResponse({req:e,nextConfig:S,cacheKey:j,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:_,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:s});if(!M)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&M||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(B,G,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};V?await l(V):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${R}`,kind:a.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})}),M)throw t;return await (0,m.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>T,"routeModule",()=>N,"serverHooks",()=>I,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>_],89838)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_41a1a497.js.map