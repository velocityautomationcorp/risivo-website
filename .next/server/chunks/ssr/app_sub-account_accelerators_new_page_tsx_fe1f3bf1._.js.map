{"version":3,"sources":["../../../../app/sub-account/accelerators/new/page.tsx"],"sourcesContent":["'use client'\n\nexport const dynamic = 'force-dynamic'\n\nimport { useState, useEffect, Suspense } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport WorkflowBuilder from '@/components/accelerator/WorkflowBuilder'\nimport { WorkflowTrigger, WorkflowAction, WorkflowTemplate } from '@/lib/accelerator/types'\n\nfunction NewWorkflowContent() {\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const templateId = searchParams.get('template')\n  \n  // State\n  const [step, setStep] = useState<'details' | 'builder'>('details')\n  const [workflowName, setWorkflowName] = useState('')\n  const [workflowDescription, setWorkflowDescription] = useState('')\n  const [folderId, setFolderId] = useState<string | null>(null)\n  const [folders, setFolders] = useState<{ id: string; name: string; color?: string }[]>([])\n  const [template, setTemplate] = useState<WorkflowTemplate | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  \n  // TODO: Get from auth context\n  const subAccountId = 'b0000000-0000-0000-0000-000000000001'\n\n  // Load folders and template on mount\n  useEffect(() => {\n    loadFolders()\n    if (templateId) {\n      loadTemplate(templateId)\n    }\n  }, [templateId])\n\n  const loadFolders = async () => {\n    try {\n      const res = await fetch(`/api/v1/workflows/folders?subAccountId=${subAccountId}`)\n      const data = await res.json()\n      if (data.success) {\n        setFolders(data.data || [])\n      }\n    } catch (err) {\n      console.error('Error loading folders:', err)\n    }\n  }\n\n  const loadTemplate = async (id: string) => {\n    setLoading(true)\n    try {\n      const res = await fetch(`/api/v1/workflows/templates?id=${id}`)\n      const data = await res.json()\n      if (data.success && data.data) {\n        setTemplate(data.data)\n        setWorkflowName(data.data.name + ' (Copy)')\n        setWorkflowDescription(data.data.description || '')\n      }\n    } catch (err) {\n      console.error('Error loading template:', err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleProceedToBuilder = () => {\n    if (!workflowName.trim()) {\n      setError('Please enter a workflow name')\n      return\n    }\n    setError(null)\n    setStep('builder')\n  }\n\n  const handleSaveWorkflow = async (trigger: WorkflowTrigger, actions: WorkflowAction[]) => {\n    setSaving(true)\n    setError(null)\n\n    try {\n      const res = await fetch('/api/v1/workflows', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          subAccountId,\n          name: workflowName,\n          description: workflowDescription,\n          folderId: folderId || undefined,\n          trigger,\n          actions: actions.map(a => ({\n            type: a.type,\n            name: a.name,\n            config: a.config,\n            delay: a.delay,\n            continueOnError: a.continueOnError,\n            order: a.order,\n            conditions: a.conditions\n          })),\n          status: 'draft'\n        })\n      })\n\n      const data = await res.json()\n      \n      if (data.success && data.data) {\n        router.push(`/sub-account/accelerators/${data.data.id}`)\n      } else {\n        setError(data.error || 'Failed to create workflow')\n      }\n    } catch (err) {\n      console.error('Error saving workflow:', err)\n      setError('Failed to save workflow')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleCancel = () => {\n    if (step === 'builder') {\n      if (confirm('Are you sure you want to discard your changes?')) {\n        router.push('/sub-account/accelerators')\n      }\n    } else {\n      router.push('/sub-account/accelerators')\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading template...</p>\n        </div>\n      </div>\n    )\n  }\n\n  // Details step\n  if (step === 'details') {\n    return (\n      <div className=\"max-w-2xl mx-auto py-12 px-4\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <button\n            onClick={handleCancel}\n            className=\"text-gray-600 hover:text-gray-800 flex items-center gap-2 mb-4\"\n          >\n            <i className=\"fas fa-arrow-left\"></i>\n            Back to Workflows\n          </button>\n          <h1 className=\"text-3xl font-bold text-gray-900\">\n            {template ? 'Create from Template' : 'Create New Workflow'}\n          </h1>\n          <p className=\"text-gray-600 mt-2\">\n            {template \n              ? `You're creating a workflow based on \"${template.name}\"`\n              : 'Give your workflow a name and configure its basic settings'}\n          </p>\n        </div>\n\n        {/* Template Info */}\n        {template && (\n          <div className=\"mb-6 p-4 bg-blue-50 border border-blue-100 rounded-xl\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <i className=\"fas fa-magic text-blue-600 text-xl\"></i>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900\">{template.name}</h3>\n                <p className=\"text-sm text-gray-600 mt-1\">{template.description}</p>\n                <div className=\"flex items-center gap-2 mt-2\">\n                  <span className=\"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded\">\n                    {template.category.replace(/_/g, ' ')}\n                  </span>\n                  <span className=\"text-xs text-gray-500\">\n                    Used {template.usageCount?.toLocaleString() || 0} times\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Form */}\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-6\">\n          {error && (\n            <div className=\"p-4 bg-red-50 border border-red-100 rounded-lg\">\n              <p className=\"text-red-600 text-sm\">{error}</p>\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Workflow Name <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              value={workflowName}\n              onChange={(e) => setWorkflowName(e.target.value)}\n              placeholder=\"e.g., Lead Follow-up Sequence\"\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Description\n            </label>\n            <textarea\n              value={workflowDescription}\n              onChange={(e) => setWorkflowDescription(e.target.value)}\n              placeholder=\"Describe what this workflow does...\"\n              rows={3}\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Folder (optional)\n            </label>\n            <select\n              value={folderId || ''}\n              onChange={(e) => setFolderId(e.target.value || null)}\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"\">No folder</option>\n              {folders.map(folder => (\n                <option key={folder.id} value={folder.id}>\n                  {folder.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"pt-4 flex justify-end gap-3\">\n            <button\n              onClick={handleCancel}\n              className=\"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={handleProceedToBuilder}\n              className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\"\n            >\n              Continue to Builder\n              <i className=\"fas fa-arrow-right\"></i>\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // Builder step\n  return (\n    <div className=\"h-[calc(100vh-64px)]\">\n      <WorkflowBuilder\n        initialTrigger={template?.trigger}\n        initialActions={template?.actions?.map((a, i) => ({\n          ...a,\n          id: `action-${i}`,\n          order: i,\n          continueOnError: a.continueOnError ?? true\n        })) as WorkflowAction[] | undefined}\n        onSave={handleSaveWorkflow}\n        onCancel={handleCancel}\n      />\n      \n      {/* Saving overlay */}\n      {saving && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-xl p-8 text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n            <p className=\"text-gray-600\">Creating workflow...</p>\n          </div>\n        </div>\n      )}\n\n      {/* Error toast */}\n      {error && (\n        <div className=\"fixed bottom-4 right-4 bg-red-600 text-white px-4 py-3 rounded-lg shadow-lg z-50\">\n          <div className=\"flex items-center gap-3\">\n            <i className=\"fas fa-exclamation-circle\"></i>\n            <span>{error}</span>\n            <button onClick={() => setError(null)} className=\"ml-2\">\n              <i className=\"fas fa-times\"></i>\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default function NewWorkflowPage() {\n  return (\n    <Suspense fallback={<div className=\"min-h-screen bg-gray-50 dark:bg-[#0a0a0a] flex items-center justify-center\"><div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div></div>}>\n      <NewWorkflowContent />\n    </Suspense>\n  )\n}\n"],"names":[],"mappings":"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"}