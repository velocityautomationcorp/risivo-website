{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../hooks/useUser.tsx","../../../../app/providers.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client'\n\nimport { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react'\n\nexport interface User {\n  id: string\n  name: string\n  email: string\n  role: string\n  isMasterAdmin: boolean\n  isDemoUser: boolean\n  agencyId: string | null\n  agencyName: string\n  avatar: string | null\n  status: string\n  company?: string | null\n}\n\ninterface UserContextType {\n  user: User | null\n  isLoading: boolean\n  error: string | null\n  refetch: () => Promise<void>\n}\n\nconst UserContext = createContext<UserContextType>({\n  user: null,\n  isLoading: true,\n  error: null,\n  refetch: async () => {},\n})\n\nexport function UserProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const fetchUser = useCallback(async () => {\n    try {\n      setIsLoading(true)\n      setError(null)\n      \n      const response = await fetch('/api/user/profile', {\n        credentials: 'include',\n        cache: 'no-store',\n      })\n\n      if (!response.ok) {\n        if (response.status === 401) {\n          // Not authenticated - that's OK, just set user to null\n          setUser(null)\n          return\n        }\n        throw new Error('Failed to fetch user')\n      }\n\n      const data = await response.json()\n      \n      if (data.success && data.profile) {\n        setUser({\n          id: data.profile.id,\n          name: `${data.profile.firstName || ''} ${data.profile.lastName || ''}`.trim() || 'User',\n          email: data.profile.email,\n          role: data.profile.role,\n          isMasterAdmin: data.profile.isMasterAdmin || false,\n          isDemoUser: data.profile.isDemoUser || data.profile.role === 'demo' || false,\n          agencyId: data.profile.agencyId,\n          agencyName: data.profile.agencyName || '',\n          avatar: data.profile.avatar,\n          status: data.profile.status || 'active',\n          company: data.profile.company || null,\n        })\n      } else {\n        setUser(null)\n      }\n    } catch (err: any) {\n      console.error('[useUser] Error fetching user:', err)\n      setError(err.message || 'Failed to fetch user')\n      setUser(null)\n    } finally {\n      setIsLoading(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    fetchUser()\n  }, [fetchUser])\n\n  return (\n    <UserContext.Provider value={{ user, isLoading, error, refetch: fetchUser }}>\n      {children}\n    </UserContext.Provider>\n  )\n}\n\nexport function useUser() {\n  const context = useContext(UserContext)\n  if (!context) {\n    throw new Error('useUser must be used within a UserProvider')\n  }\n  return context\n}\n\n/**\n * Simple hook to get user data without context (standalone fetch)\n * Use this for simple components that need user data on mount\n */\nexport function useUserData() {\n  const [user, setUser] = useState<User | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    async function fetchUser() {\n      try {\n        const response = await fetch('/api/user/profile', {\n          credentials: 'include',\n          cache: 'no-store',\n        })\n\n        if (!response.ok) {\n          if (response.status === 401) {\n            setUser(null)\n            return\n          }\n          throw new Error('Failed to fetch user')\n        }\n\n        const data = await response.json()\n        \n        if (data.success && data.profile) {\n          setUser({\n            id: data.profile.id,\n            name: `${data.profile.firstName || ''} ${data.profile.lastName || ''}`.trim() || 'User',\n            email: data.profile.email,\n            role: data.profile.role,\n            isMasterAdmin: data.profile.isMasterAdmin || false,\n            isDemoUser: data.profile.isDemoUser || data.profile.role === 'demo' || false,\n            agencyId: data.profile.agencyId,\n            agencyName: data.profile.agencyName || '',\n            avatar: data.profile.avatar,\n            status: data.profile.status || 'active',\n            company: data.profile.company || null,\n          })\n        }\n      } catch (err: any) {\n        console.error('[useUserData] Error:', err)\n        setError(err.message)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    fetchUser()\n  }, [])\n\n  return { user, isLoading, error }\n}\n","'use client'\n\nimport { UserProvider } from '@/hooks/useUser'\n\n/**\n * Root Providers for RISIVO CRM\n * \n * NOTE: SessionProvider from next-auth has been removed because:\n * 1. We use a custom JWT flow via /api/login (not next-auth)\n * 2. SessionProvider was calling /api/auth/session which couldn't decode our custom JWT\n * 3. This caused client-side redirects to /auth/signin on protected pages\n * \n * User data is now managed via:\n * - UserProvider: Fetches user data from /api/user/profile\n * - useUser hook: Provides user data to components\n */\nexport function Providers({ children }: { children: React.ReactNode }) {\n  return (\n    <UserProvider>\n      {children}\n    </UserProvider>\n  )\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"0NA0BQG,EAAOC,OAAO,CAAGC,EAAQ,CAAA,CAAA,IAAA,iCC1BjCF,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEC,eAAe,+BCFxCP,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEE,KAAK,0CCA9B,EAAA,EAAA,CAAA,CAAA,OAuBA,IAAM,EAAc,CAAA,EAAA,EAAA,aAAA,AAAa,EAAkB,CACjD,KAAM,KACN,WAAW,EACX,MAAO,KACP,QAAS,UAAa,CACxB,GAEO,SAAS,EAAa,UAAE,CAAQ,CAA2B,EAChE,GAAM,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACxC,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACrC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAE5C,EAAY,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,UAC5B,GAAI,CACF,GAAa,GACb,EAAS,MAET,IAAM,EAAW,MAAM,MAAM,oBAAqB,CAChD,YAAa,UACb,MAAO,UACT,GAEA,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,GAAwB,MAApB,EAAS,MAAM,CAAU,YAE3B,EAAQ,KAGV,OAAM,AAAI,MAAM,uBAClB,CAEA,IAAM,EAAO,MAAM,EAAS,IAAI,GAE5B,EAAK,OAAO,EAAI,EAAK,OAAO,CAC9B,CADgC,CACxB,CACN,GAAI,EAAK,OAAO,CAAC,EAAE,CACnB,KAAM,CAAA,EAAG,EAAK,OAAO,CAAC,SAAS,EAAI,GAAG,CAAC,EAAE,EAAK,OAAO,CAAC,QAAQ,EAAI,GAAA,CAAI,CAAC,IAAI,IAAM,OACjF,MAAO,EAAK,OAAO,CAAC,KAAK,CACzB,KAAM,EAAK,OAAO,CAAC,IAAI,CACvB,cAAe,EAAK,OAAO,CAAC,aAAa,GAAI,EAC7C,WAAY,EAAK,OAAO,CAAC,UAAU,EAA0B,SAAtB,EAAK,OAAO,CAAC,IAAI,GAAe,EACvE,SAAU,EAAK,OAAO,CAAC,QAAQ,CAC/B,WAAY,EAAK,OAAO,CAAC,UAAU,EAAI,GACvC,OAAQ,EAAK,OAAO,CAAC,MAAM,CAC3B,OAAQ,EAAK,OAAO,CAAC,MAAM,EAAI,SAC/B,QAAS,EAAK,OAAO,CAAC,OAAO,EAAI,IACnC,GAEA,EAAQ,KAEZ,CAAE,MAAO,EAAU,CACjB,QAAQ,KAAK,CAAC,iCAAkC,GAChD,EAAS,EAAI,OAAO,EAAI,wBACxB,EAAQ,KACV,QAAU,CACR,GAAa,EACf,CACF,EAAG,EAAE,EAML,MAJA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GACF,EAAG,CAAC,EAAU,EAGZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAY,QAAQ,CAAA,CAAC,MAAO,MAAE,YAAM,EAAW,QAAO,QAAS,CAAU,WACvE,GAGP,CAEO,SAAS,IACd,IAAM,EAAU,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,GAC3B,GAAI,CAAC,EACH,MAAM,AAAI,CADE,KACI,8CAElB,OAAO,CACT,sFCnGA,EAAA,EAAA,CAAA,CAAA,OAcO,SAAS,EAAU,UAAE,CAAQ,CAAiC,EACnE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,UACV,GAGP","ignoreList":[0,1,2]}