module.exports=[97953,(e,t,n)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},33861,e=>{"use strict";var t=e.i(97953);let n=(0,t.registerClientReference)(function(){throw Error("Attempted to call useARaging() from the server but useARaging is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useARaging"),o=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingCustomers() from the server but useAccountingCustomers is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingCustomers"),c=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingInit() from the server but useAccountingInit is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingInit"),i=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingIntegration() from the server but useAccountingIntegration is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingIntegration"),a=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingInvoices() from the server but useAccountingInvoices is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingInvoices"),r=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingPayments() from the server but useAccountingPayments is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingPayments"),s=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingSync() from the server but useAccountingSync is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useAccountingSync"),u=(0,t.registerClientReference)(function(){throw Error("Attempted to call useGLAccounts() from the server but useGLAccounts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useGLAccounts"),d=(0,t.registerClientReference)(function(){throw Error("Attempted to call useJournalEntries() from the server but useJournalEntries is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useJournalEntries"),l=(0,t.registerClientReference)(function(){throw Error("Attempted to call useSyncQueue() from the server but useSyncQueue is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useSyncQueue"),p=(0,t.registerClientReference)(function(){throw Error("Attempted to call useTaxCodes() from the server but useTaxCodes is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useTaxCodes"),m=(0,t.registerClientReference)(function(){throw Error("Attempted to call useTrialBalance() from the server but useTrialBalance is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts <module evaluation>","useTrialBalance");e.s(["useARaging",0,n,"useAccountingCustomers",0,o,"useAccountingInit",0,c,"useAccountingIntegration",0,i,"useAccountingInvoices",0,a,"useAccountingPayments",0,r,"useAccountingSync",0,s,"useGLAccounts",0,u,"useJournalEntries",0,d,"useSyncQueue",0,l,"useTaxCodes",0,p,"useTrialBalance",0,m])},74434,e=>{"use strict";var t=e.i(97953);let n=(0,t.registerClientReference)(function(){throw Error("Attempted to call useARaging() from the server but useARaging is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useARaging"),o=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingCustomers() from the server but useAccountingCustomers is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingCustomers"),c=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingInit() from the server but useAccountingInit is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingInit"),i=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingIntegration() from the server but useAccountingIntegration is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingIntegration"),a=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingInvoices() from the server but useAccountingInvoices is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingInvoices"),r=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingPayments() from the server but useAccountingPayments is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingPayments"),s=(0,t.registerClientReference)(function(){throw Error("Attempted to call useAccountingSync() from the server but useAccountingSync is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useAccountingSync"),u=(0,t.registerClientReference)(function(){throw Error("Attempted to call useGLAccounts() from the server but useGLAccounts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useGLAccounts"),d=(0,t.registerClientReference)(function(){throw Error("Attempted to call useJournalEntries() from the server but useJournalEntries is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useJournalEntries"),l=(0,t.registerClientReference)(function(){throw Error("Attempted to call useSyncQueue() from the server but useSyncQueue is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useSyncQueue"),p=(0,t.registerClientReference)(function(){throw Error("Attempted to call useTaxCodes() from the server but useTaxCodes is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useTaxCodes"),m=(0,t.registerClientReference)(function(){throw Error("Attempted to call useTrialBalance() from the server but useTrialBalance is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/lib/accounting/hooks.ts","useTrialBalance");e.s(["useARaging",0,n,"useAccountingCustomers",0,o,"useAccountingInit",0,c,"useAccountingIntegration",0,i,"useAccountingInvoices",0,a,"useAccountingPayments",0,r,"useAccountingSync",0,s,"useGLAccounts",0,u,"useJournalEntries",0,d,"useSyncQueue",0,l,"useTaxCodes",0,p,"useTrialBalance",0,m])},46823,e=>{"use strict";e.i(33861);var t=e.i(74434);e.n(t)},7608,27514,91848,69669,e=>{"use strict";let t=[{accountCode:"1000",accountName:"Cash",accountType:"asset",isActive:!0,currency:"USD",description:"Cash on hand"},{accountCode:"1010",accountName:"Bank Account",accountType:"asset",isActive:!0,currency:"USD",description:"Primary bank account"},{accountCode:"1100",accountName:"Accounts Receivable",accountType:"asset",isActive:!0,currency:"USD",description:"Money owed by customers"},{accountCode:"1200",accountName:"Inventory",accountType:"asset",isActive:!0,currency:"USD",description:"Products for sale"},{accountCode:"1300",accountName:"Prepaid Expenses",accountType:"asset",isActive:!0,currency:"USD",description:"Expenses paid in advance"},{accountCode:"2000",accountName:"Accounts Payable",accountType:"liability",isActive:!0,currency:"USD",description:"Money owed to vendors"},{accountCode:"2100",accountName:"Credit Card Payable",accountType:"liability",isActive:!0,currency:"USD",description:"Credit card balance"},{accountCode:"2200",accountName:"Sales Tax Payable",accountType:"liability",isActive:!0,currency:"USD",description:"Sales tax collected"},{accountCode:"2300",accountName:"Unearned Revenue",accountType:"liability",isActive:!0,currency:"USD",description:"Prepayments from customers"},{accountCode:"3000",accountName:"Owner's Equity",accountType:"equity",isActive:!0,currency:"USD",description:"Owner investment"},{accountCode:"3100",accountName:"Retained Earnings",accountType:"equity",isActive:!0,currency:"USD",description:"Accumulated profits"},{accountCode:"4000",accountName:"Sales Revenue",accountType:"revenue",isActive:!0,currency:"USD",description:"Product sales"},{accountCode:"4100",accountName:"Service Revenue",accountType:"revenue",isActive:!0,currency:"USD",description:"Service income"},{accountCode:"4200",accountName:"Subscription Revenue",accountType:"revenue",isActive:!0,currency:"USD",description:"Recurring subscriptions"},{accountCode:"4900",accountName:"Other Income",accountType:"revenue",isActive:!0,currency:"USD",description:"Miscellaneous income"},{accountCode:"5000",accountName:"Cost of Goods Sold",accountType:"expense",isActive:!0,currency:"USD",description:"Direct product costs"},{accountCode:"5100",accountName:"Salaries & Wages",accountType:"expense",isActive:!0,currency:"USD",description:"Employee compensation"},{accountCode:"5200",accountName:"Rent Expense",accountType:"expense",isActive:!0,currency:"USD",description:"Office/warehouse rent"},{accountCode:"5300",accountName:"Utilities",accountType:"expense",isActive:!0,currency:"USD",description:"Electric, water, internet"},{accountCode:"5400",accountName:"Marketing & Advertising",accountType:"expense",isActive:!0,currency:"USD",description:"Marketing costs"},{accountCode:"5500",accountName:"Software & Subscriptions",accountType:"expense",isActive:!0,currency:"USD",description:"SaaS and tools"},{accountCode:"5600",accountName:"Professional Services",accountType:"expense",isActive:!0,currency:"USD",description:"Legal, accounting, consulting"},{accountCode:"5700",accountName:"Bank Fees",accountType:"expense",isActive:!0,currency:"USD",description:"Bank and payment processing fees"},{accountCode:"5800",accountName:"Depreciation",accountType:"expense",isActive:!0,currency:"USD",description:"Asset depreciation"},{accountCode:"5900",accountName:"Other Expenses",accountType:"expense",isActive:!0,currency:"USD",description:"Miscellaneous expenses"}],n=[{code:"NO-TAX",name:"No Tax",rate:0,type:"both",isDefault:!1,isActive:!0},{code:"TAX-10",name:"Sales Tax 10%",rate:10,type:"sales",isDefault:!0,isActive:!0},{code:"TAX-20",name:"VAT 20%",rate:20,type:"both",isDefault:!1,isActive:!0},{code:"TAX-7",name:"Sales Tax 7%",rate:7,type:"sales",isDefault:!1,isActive:!0}],o="accounting_invoices",c="accounting_payments",i="accounting_customers",a="accounting_gl_accounts",r="accounting_journal_entries",s="accounting_sync_queue";function u(e,t){}function d(e){let t=Date.now().toString(36),n=Math.random().toString(36).substring(2,8);return`${e}_${t}${n}`}let l={initializeChartOfAccounts:e=>{let n=[],o=n.filter(t=>t.id.startsWith(e));if(o.length>0)return o;let c=new Date().toISOString(),i=t.map(t=>({...t,id:`${e}_${d("gl")}`,balance:0,createdAt:c,updatedAt:c}));return u(a,[...n,...i]),i},getGLAccounts:e=>[].filter(t=>t.id.startsWith(e)||!t.id.includes("_")),getGLAccountByCode:(e,t)=>l.getGLAccounts(e).find(e=>e.accountCode===t),createGLAccount:(e,t)=>{let n=new Date().toISOString(),o={...t,id:`${e}_${d("gl")}`,balance:0,createdAt:n,updatedAt:n};return u(a,[o]),o},updateGLAccountBalance:(e,t,n)=>{let o=[],c=o.findIndex(t=>t.id===e);if(-1===c)return;let i=o[c],r=["asset","expense","contra_liability","contra_equity","contra_revenue"].includes(i.accountType);n?i.balance+=r?t:-t:i.balance+=r?-t:t,i.updatedAt=new Date().toISOString(),o[c]=i,u(a,o)},initializeTaxCodes:e=>{let t=[],o=t.filter(t=>t.id.startsWith(e));if(o.length>0)return o;let c=new Date().toISOString(),i=n.map(t=>({...t,id:`${e}_${d("tax")}`,createdAt:c}));return u("accounting_tax_codes",[...t,...i]),i},getTaxCodes:e=>[].filter(t=>t.id.startsWith(e)||!t.id.includes("_")),getJournalEntries:(e,t)=>{let n=[];return n=n.filter(t=>t.id.startsWith(e)),t?.status&&(n=n.filter(e=>e.status===t.status)),t?.referenceType&&(n=n.filter(e=>e.referenceType===t.referenceType)),t?.startDate&&(n=n.filter(e=>e.date>=t.startDate)),t?.endDate&&(n=n.filter(e=>e.date<=t.endDate)),n.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},createJournalEntry:(e,t)=>{let n=[],o=n.filter(t=>t.id.startsWith(e)),c=new Date().toISOString(),i=new Date().getFullYear(),a=`JE-${i}-${String(o.length+1).padStart(4,"0")}`,s={...t,id:`${e}_${d("je")}`,entryNumber:a,createdAt:c};if(s.totalDebit!==s.totalCredit)throw Error("Journal entry must balance: total debits must equal total credits");if(u(r,[...n,s]),"posted"===s.status)for(let e of s.lines)e.debit>0&&l.updateGLAccountBalance(e.accountId,e.debit,!0),e.credit>0&&l.updateGLAccountBalance(e.accountId,e.credit,!1);return s},postJournalEntry:e=>{let t=[],n=t.findIndex(t=>t.id===e);if(-1===n)throw Error("Journal entry not found");let o=t[n];if("posted"===o.status)throw Error("Journal entry already posted");if("voided"===o.status)throw Error("Cannot post voided journal entry");for(let e of(o.status="posted",o.postedAt=new Date().toISOString(),t[n]=o,u(r,t),o.lines))e.debit>0&&l.updateGLAccountBalance(e.accountId,e.debit,!0),e.credit>0&&l.updateGLAccountBalance(e.accountId,e.credit,!1);return o},voidJournalEntry:(e,t)=>{let n=[],o=n.findIndex(t=>t.id===e);if(-1===o)throw Error("Journal entry not found");let c=n[o];if("voided"===c.status)throw Error("Journal entry already voided");if("posted"===c.status)for(let e of c.lines)e.debit>0&&l.updateGLAccountBalance(e.accountId,e.debit,!1),e.credit>0&&l.updateGLAccountBalance(e.accountId,e.credit,!0);return c.status="voided",c.voidedAt=new Date().toISOString(),c.voidReason=t,n[o]=c,u(r,n),c},syncCustomer:(e,t)=>{let n=[],o=n.find(n=>n.crmContactId===t.id&&n.subAccountId===e),c=new Date().toISOString();if(o){o.companyName=t.company||t.name,o.billingEmail=t.email,o.contactPerson=t.name,o.phone=t.phone,o.address=t.address,o.updatedAt=c;let e=n.findIndex(e=>e.id===o.id);return n[e]=o,u(i,n),o}let a=n.filter(t=>t.subAccountId===e).length,r={id:`${e}_${d("cust")}`,customerCode:`CUST-${String(a+1).padStart(3,"0")}`,companyName:t.company||t.name,contactPerson:t.name,billingEmail:t.email,phone:t.phone,address:t.address,currency:"USD",status:"active",crmContactId:t.id,subAccountId:e,createdAt:c,updatedAt:c};return u(i,[...n,r]),r},getCustomers:e=>[].filter(t=>t.subAccountId===e),getCustomerByCompanyName:(e,t)=>l.getCustomers(e).find(e=>e.companyName.toLowerCase()===t.toLowerCase()),syncInvoice:(e,t,n=!0)=>{let c,i,a=[],r=new Date().toISOString();t.contactId&&(c=l.syncCustomer(e,{id:t.contactId,name:t.contactName||"Unknown",email:t.contactEmail||""}));let s=a.findIndex(n=>n.crmInvoiceId===t.id&&n.subAccountId===e),p=l.getGLAccountByCode(e,"1100"),m=l.getGLAccountByCode(e,"4000"),y=l.getGLAccountByCode(e,"2200"),f=t.items.map((t,n)=>({id:`${e}_item_${n}_${Date.now()}`,description:t.description,quantity:t.quantity,unitPrice:t.unitPrice,amount:t.quantity*t.unitPrice,taxRate:t.taxRate,taxAmount:t.taxRate?t.quantity*t.unitPrice*t.taxRate/100:0,total:t.quantity*t.unitPrice+(t.taxRate?t.quantity*t.unitPrice*t.taxRate/100:0),accountId:m?.id})),g=a.filter(t=>t.subAccountId===e).length,v={id:s>=0?a[s].id:`${e}_${d("inv")}`,invoiceNumber:t.invoiceNumber||`INV-${String(g+1).padStart(3,"0")}`,customerId:c?.id||"",customerName:c?.companyName||t.contactName||"Unknown",customerEmail:c?.billingEmail||t.contactEmail,subtotal:t.subtotal,taxAmount:t.taxAmount,discountAmount:t.discountAmount||0,total:t.total,amountPaid:"paid"===t.status?t.total:0,amountDue:"paid"===t.status?0:t.total,currency:"USD",issueDate:t.issueDate,dueDate:t.dueDate,paidDate:"paid"===t.status?r:void 0,status:{draft:"draft",sent:"sent",paid:"paid",overdue:"overdue",partial:"partial",cancelled:"cancelled",void:"void"}[t.status]||"draft",items:f,arAccountId:p?.id,revenueAccountId:m?.id,crmInvoiceId:t.id,subAccountId:e,notes:t.notes,createdAt:s>=0?a[s].createdAt:r,updatedAt:r,syncedAt:r};if(s>=0?a[s]=v:a.push(v),u(o,a),"draft"!==v.status&&!v.journalEntryId&&n){let t=[];p&&t.push({id:d("jel"),accountId:p.id,accountCode:p.accountCode,accountName:p.accountName,description:`Invoice ${v.invoiceNumber}`,debit:v.total,credit:0}),m&&t.push({id:d("jel"),accountId:m.id,accountCode:m.accountCode,accountName:m.accountName,description:`Revenue from ${v.invoiceNumber}`,debit:0,credit:v.subtotal-(v.discountAmount||0)}),y&&v.taxAmount>0&&t.push({id:d("jel"),accountId:y.id,accountCode:y.accountCode,accountName:y.accountName,description:`Tax on ${v.invoiceNumber}`,debit:0,credit:v.taxAmount});let c=t.reduce((e,t)=>e+t.debit,0),r=t.reduce((e,t)=>e+t.credit,0);if(t.length>0&&c===r)try{i=l.createJournalEntry(e,{date:v.issueDate,description:`Invoice ${v.invoiceNumber} - ${v.customerName}`,reference:v.invoiceNumber,referenceType:"invoice",referenceId:v.id,lines:t,status:n?"posted":"draft",totalDebit:c,totalCredit:r}),v.journalEntryId=i.id;let s=a.findIndex(e=>e.id===v.id);s>=0&&(a[s]=v,u(o,a))}catch(e){console.error("Failed to create journal entry:",e)}}return{invoice:v,journalEntry:i}},getInvoices:(e,t)=>{let n=[];return n=n.filter(t=>t.subAccountId===e),t?.status&&(n=n.filter(e=>e.status===t.status)),t?.customerId&&(n=n.filter(e=>e.customerId===t.customerId)),t?.startDate&&(n=n.filter(e=>e.issueDate>=t.startDate)),t?.endDate&&(n=n.filter(e=>e.issueDate<=t.endDate)),n.sort((e,t)=>new Date(t.issueDate).getTime()-new Date(e.issueDate).getTime())},syncPayment:(e,t,n=!0)=>{let i,a,r=[],s=new Date().toISOString();t.contactId&&(i=l.syncCustomer(e,{id:t.contactId,name:t.contactName||"Unknown",email:""}));let p=r.findIndex(n=>n.crmPaymentId===t.id&&n.subAccountId===e),m=l.getGLAccountByCode(e,"1100"),y=l.getGLAccountByCode(e,"1010"),f=r.filter(t=>t.subAccountId===e).length,g={id:p>=0?r[p].id:`${e}_${d("pay")}`,paymentNumber:t.paymentNumber||`PAY-${String(f+1).padStart(3,"0")}`,customerId:i?.id||"",customerName:i?.companyName||t.contactName||"Unknown",invoiceId:t.invoiceId,invoiceNumber:t.invoiceNumber,amount:t.amount,currency:"USD",method:{credit_card:"credit_card",bank_transfer:"bank_transfer",check:"check",cash:"cash",paypal:"paypal",stripe:"stripe"}[t.method]||"other",status:{pending:"pending",completed:"completed",failed:"failed",refunded:"refunded"}[t.status]||"pending",gatewayId:t.gatewayId,gateway:t.gateway,date:t.date,processedAt:"completed"===t.status?s:void 0,bankAccountId:y?.id,reference:t.reference,notes:t.notes,crmPaymentId:t.id,subAccountId:e,createdAt:p>=0?r[p].createdAt:s,updatedAt:s,syncedAt:s};if(p>=0?r[p]=g:r.push(g),u(c,r),"completed"===g.status&&!g.journalEntryId&&n){let t=[];y&&t.push({id:d("jel"),accountId:y.id,accountCode:y.accountCode,accountName:y.accountName,description:`Payment ${g.paymentNumber}`,debit:g.amount,credit:0}),m&&t.push({id:d("jel"),accountId:m.id,accountCode:m.accountCode,accountName:m.accountName,description:`Payment received for ${g.invoiceNumber||"invoice"}`,debit:0,credit:g.amount});let i=t.reduce((e,t)=>e+t.debit,0),p=t.reduce((e,t)=>e+t.credit,0);if(t.length>0&&i===p)try{a=l.createJournalEntry(e,{date:g.date,description:`Payment ${g.paymentNumber} - ${g.customerName}`,reference:g.paymentNumber,referenceType:"payment",referenceId:g.id,lines:t,status:n?"posted":"draft",totalDebit:i,totalCredit:p}),g.journalEntryId=a.id;let d=r.findIndex(e=>e.id===g.id);if(d>=0&&(r[d]=g,u(c,r)),g.invoiceId){let e=[],t=e.findIndex(e=>e.crmInvoiceId===g.invoiceId||e.id===g.invoiceId);t>=0&&(e[t].amountPaid+=g.amount,e[t].amountDue=Math.max(0,e[t].total-e[t].amountPaid),0===e[t].amountDue?(e[t].status="paid",e[t].paidDate=s):e[t].amountPaid>0&&(e[t].status="partial"),e[t].updatedAt=s,u(o,e))}}catch(e){console.error("Failed to create journal entry:",e)}}return{payment:g,journalEntry:a}},getPayments:(e,t)=>{let n=[];return n=n.filter(t=>t.subAccountId===e),t?.status&&(n=n.filter(e=>e.status===t.status)),t?.method&&(n=n.filter(e=>e.method===t.method)),t?.invoiceId&&(n=n.filter(e=>e.invoiceId===t.invoiceId)),t?.startDate&&(n=n.filter(e=>e.date>=t.startDate)),t?.endDate&&(n=n.filter(e=>e.date<=t.endDate)),n.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},getTrialBalance:e=>l.getGLAccounts(e).filter(e=>0!==e.balance).map(e=>{let t=["asset","expense","contra_liability","contra_equity","contra_revenue"].includes(e.accountType);return{accountCode:e.accountCode,accountName:e.accountName,accountType:e.accountType,debit:t&&e.balance>0?e.balance:!t&&e.balance<0?Math.abs(e.balance):0,credit:!t&&e.balance>0?e.balance:t&&e.balance<0?Math.abs(e.balance):0}}).sort((e,t)=>e.accountCode.localeCompare(t.accountCode)),getAccountsReceivableAging:e=>{let t=l.getInvoices(e).filter(e=>e.amountDue>0&&!["cancelled","void","draft"].includes(e.status)),n=new Date,o={current:0,days30:0,days60:0,days90:0,days90Plus:0,total:0};for(let e of t){let t=new Date(e.dueDate),c=Math.floor((n.getTime()-t.getTime())/864e5);c<=0?o.current+=e.amountDue:c<=30?o.days30+=e.amountDue:c<=60?o.days60+=e.amountDue:c<=90?o.days90+=e.amountDue:o.days90Plus+=e.amountDue,o.total+=e.amountDue}return o}},p={addToQueue:e=>{let t={...e,id:d("sq"),status:"pending",attempts:0,createdAt:new Date().toISOString()};return u(s,[t]),t},getQueuedItems:(e,t)=>{let n=[];return e&&(n=n.filter(t=>t.subAccountId===e)),t&&(n=n.filter(e=>e.status===t)),n.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},updateQueueItem:(e,t)=>{let n=[],o=n.findIndex(t=>t.id===e);o>=0&&(n[o]={...n[o],...t},u(s,n))},processQueue:async e=>{let t=p.getQueuedItems(e,"pending"),n=[];for(let e of t){p.updateQueueItem(e.id,{status:"processing",attempts:e.attempts+1});try{if("internal"===e.integrationType)p.updateQueueItem(e.id,{status:"completed",processedAt:new Date().toISOString()}),n.push({success:!0,entityType:e.entityType,entityId:e.entityId,action:e.action,timestamp:new Date().toISOString()});else throw Error(`Integration type ${e.integrationType} not yet implemented`)}catch(o){let t=e.attempts<e.maxAttempts;p.updateQueueItem(e.id,{status:t?"pending":"failed",lastError:o.message,nextRetryAt:t?new Date(Date.now()+6e4*Math.pow(2,e.attempts)).toISOString():void 0}),n.push({success:!1,entityType:e.entityType,entityId:e.entityId,action:e.action,error:o.message,timestamp:new Date().toISOString()})}}return n}},m={isRisivoHub:e=>"risivo-hub"===e||e.includes("risivo-hub"),getIntegration:e=>[].find(t=>t.subAccountId===e&&"active"===t.status)||null,initializeAccounting:(e,t="internal")=>{l.initializeChartOfAccounts(e),l.initializeTaxCodes(e);let n=[],o=n.findIndex(t=>t.subAccountId===e),c=new Date().toISOString(),i={id:o>=0?n[o].id:d("int"),subAccountId:e,type:t,status:"active",settings:{syncCustomers:!0,syncInvoices:!0,syncPayments:!0,syncProducts:!0,autoPostJournalEntries:!0},createdAt:o>=0?n[o].createdAt:c,updatedAt:c};o>=0?n[o]=i:n.push(i),u("accounting_integrations",n)},syncCustomer:async(e,t)=>{let n=m.getIntegration(e);if(!n||!n.settings.syncCustomers)return{success:!1,entityType:"customer",entityId:t.id,action:"sync",error:"Customer sync not enabled",timestamp:new Date().toISOString()};if("internal"===n.type||m.isRisivoHub(e)){let n=l.syncCustomer(e,t);return{success:!0,entityType:"customer",entityId:t.id,action:"sync",externalId:n.id,timestamp:new Date().toISOString()}}return p.addToQueue({subAccountId:e,integrationType:n.type,entityType:"customer",entityId:t.id,action:"sync",payload:t,maxAttempts:3}),{success:!0,entityType:"customer",entityId:t.id,action:"sync",timestamp:new Date().toISOString()}},syncInvoice:async(e,t)=>{let n=m.getIntegration(e);if(!n||!n.settings.syncInvoices)return{success:!1,entityType:"invoice",entityId:t.id,action:"sync",error:"Invoice sync not enabled",timestamp:new Date().toISOString()};if("internal"===n.type||m.isRisivoHub(e)){let o=n.settings.autoPostJournalEntries,{invoice:c}=l.syncInvoice(e,t,o);return{success:!0,entityType:"invoice",entityId:t.id,action:"sync",externalId:c.id,timestamp:new Date().toISOString()}}return p.addToQueue({subAccountId:e,integrationType:n.type,entityType:"invoice",entityId:t.id,action:"sync",payload:t,maxAttempts:3}),{success:!0,entityType:"invoice",entityId:t.id,action:"sync",timestamp:new Date().toISOString()}},syncPayment:async(e,t)=>{let n=m.getIntegration(e);if(!n||!n.settings.syncPayments)return{success:!1,entityType:"payment",entityId:t.id,action:"sync",error:"Payment sync not enabled",timestamp:new Date().toISOString()};if("internal"===n.type||m.isRisivoHub(e)){let o=n.settings.autoPostJournalEntries,{payment:c}=l.syncPayment(e,t,o);return{success:!0,entityType:"payment",entityId:t.id,action:"sync",externalId:c.id,timestamp:new Date().toISOString()}}return p.addToQueue({subAccountId:e,integrationType:n.type,entityType:"payment",entityId:t.id,action:"sync",payload:t,maxAttempts:3}),{success:!0,entityType:"payment",entityId:t.id,action:"sync",timestamp:new Date().toISOString()}}};e.s(["accountingSyncService",0,m,"internalAccountingService",0,l,"syncQueueService",0,p],27514);e.s(["quickbooksConnectionStatus",0,{isConnected:e=>{let t=null;return null!==t&&""!==t.accessToken},getConnectionInfo:e=>{let t=null;return t?{connected:!0,realmId:t.realmId,expiresAt:t.expiresAt}:{connected:!1}},disconnect:e=>{var t;t=0}}],91848);e.s(["xeroConnectionStatus",0,{isConnected:e=>{let t=null;return null!==t&&""!==t.accessToken},getConnectionInfo:e=>{let t=null;return t?{connected:!0,tenantId:t.tenantId,tenantName:t.tenantName,expiresAt:t.expiresAt}:{connected:!1}},disconnect:e=>{var t;t=0}}],69669),e.i(46823),e.s([],7608)}];

//# sourceMappingURL=_80af0935._.js.map