{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'http')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`http`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'querystring')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`querystring`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,WAAW,CAAC"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'https')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`https`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,KAAK,CAAC"}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/auth.config.ts"],"sourcesContent":["/**\n * RISIVO CRM - Auth.js Configuration (Edge Compatible)\n * \n * This file contains the configuration that can run on the Edge.\n * It does NOT include the Prisma adapter (which is not edge-compatible).\n * \n * Used by: middleware.ts\n * \n * IMPORTANT: This config is ONLY for session validation in middleware.\n * Actual credential verification happens in auth.ts via the API route.\n */\n\nimport type { NextAuthConfig } from 'next-auth'\n\nexport default {\n  providers: [],\n  pages: {\n    signIn: '/auth/signin',\n    signOut: '/auth/signin',\n    error: '/auth/signin',\n  },\n  callbacks: {\n    // Allow the signin page and api routes to always be accessible\n    authorized({ request, auth }) {\n      const { pathname } = request.nextUrl\n      \n      // Always allow API routes\n      if (pathname.startsWith('/api/')) {\n        return true\n      }\n      \n      // Always allow auth pages\n      if (pathname.startsWith('/auth/')) {\n        return true\n      }\n      \n      // Always allow public pages\n      if (pathname === '/' || pathname.startsWith('/demo/')) {\n        return true\n      }\n      \n      // Protected routes need a session\n      const isProtected = ['/sub-account', '/admin', '/company', '/agency', '/dashboard', '/super-admin']\n        .some(prefix => pathname.startsWith(prefix))\n      \n      if (isProtected) {\n        return !!auth\n      }\n      \n      return true\n    }\n  },\n  session: {\n    strategy: 'jwt',\n  },\n  trustHost: true,\n  secret: process.env.NEXTAUTH_SECRET || process.env.AUTH_SECRET,\n} satisfies NextAuthConfig\n"],"names":[],"mappings":"AAAA;;;;;;;;;;CAUC;;;;uCAIc;IACb,WAAW,EAAE;IACb,OAAO;QACL,QAAQ;QACR,SAAS;QACT,OAAO;IACT;IACA,WAAW;QACT,+DAA+D;QAC/D,YAAW,EAAE,OAAO,EAAE,IAAI,EAAE;YAC1B,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;YAEpC,0BAA0B;YAC1B,IAAI,SAAS,UAAU,CAAC,UAAU;gBAChC,OAAO;YACT;YAEA,0BAA0B;YAC1B,IAAI,SAAS,UAAU,CAAC,WAAW;gBACjC,OAAO;YACT;YAEA,4BAA4B;YAC5B,IAAI,aAAa,OAAO,SAAS,UAAU,CAAC,WAAW;gBACrD,OAAO;YACT;YAEA,kCAAkC;YAClC,MAAM,cAAc;gBAAC;gBAAgB;gBAAU;gBAAY;gBAAW;gBAAc;aAAe,CAChG,IAAI,CAAC,CAAA,SAAU,SAAS,UAAU,CAAC;YAEtC,IAAI,aAAa;gBACf,OAAO,CAAC,CAAC;YACX;YAEA,OAAO;QACT;IACF;IACA,SAAS;QACP,UAAU;IACZ;IACA,WAAW;IACX,QAAQ,QAAQ,GAAG,CAAC,eAAe,IAAI,QAAQ,GAAG,CAAC,WAAW;AAChE"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport NextAuth from 'next-auth'\nimport authConfig from './auth.config'\n\n/**\n * RISIVO CRM Middleware\n * \n * Auth.js v5 compatible middleware\n */\n\nconst { auth } = NextAuth(authConfig)\n\n// Routes that require authentication\nconst PROTECTED_ROUTE_PREFIXES = [\n  '/sub-account',\n  '/admin',\n  '/company',\n  '/agency',\n  '/dashboard',\n  '/super-admin',\n]\n\n// Routes that are always public\nconst PUBLIC_ROUTES = [\n  '/',\n  '/auth/signin',\n  '/auth/signup',\n  '/auth/forgot-password',\n  '/auth/reset-password',\n  '/demo/access',\n  '/book',\n  '/api/',\n]\n\n// Demo users cannot access these routes\nconst DEMO_RESTRICTED_ROUTES = [\n  '/sub-account/settings',\n  '/sub-account/platform-admin',\n  '/sub-account/settings/my-staff',\n  '/sub-account/settings/business-profile',\n  '/sub-account/settings/branding',\n  '/sub-account/settings/import',\n  '/company/settings',\n  '/agency/settings',\n]\n\n// Redirect map from old admin paths to new platform-admin paths\nconst adminRedirects: Record<string, string> = {\n  '/super-admin': '/sub-account/platform-admin',\n  '/super-admin/agencies': '/sub-account/platform-admin/agencies',\n  '/super-admin/settings': '/sub-account/platform-admin/settings',\n  '/super-admin/settings/telephony': '/sub-account/platform-admin/settings/telephony',\n  '/super-admin/settings/subscriptions': '/sub-account/platform-admin/settings/subscriptions',\n  '/super-admin/billing': '/sub-account/platform-admin/billing',\n  '/super-admin/analytics': '/sub-account/platform-admin/analytics',\n  '/super-admin/health': '/sub-account/platform-admin/health',\n  '/super-admin/logs': '/sub-account/platform-admin/logs',\n  '/super-admin/features': '/sub-account/platform-admin/features',\n  '/admin': '/sub-account/platform-admin',\n  '/admin/overview': '/sub-account/platform-admin',\n  '/admin/staff': '/sub-account/platform-admin/staff',\n  '/admin/support': '/sub-account/platform-admin/support',\n  '/admin/users': '/sub-account/platform-admin/users',\n  '/admin/companies': '/sub-account/platform-admin/agencies',\n  '/admin/newsletters': '/sub-account/platform-admin/newsletters',\n  '/admin/settings': '/sub-account/platform-admin/settings',\n  '/admin/settings/roles': '/sub-account/platform-admin/settings/roles',\n  '/admin/settings/custom-fields': '/sub-account/platform-admin/settings/custom-fields',\n  '/admin/settings/email-service': '/sub-account/platform-admin/settings/email-service',\n}\n\nexport default auth(async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n  \n  // Skip static files\n  if (\n    pathname.startsWith('/_next/') ||\n    pathname.startsWith('/favicon') ||\n    pathname.includes('.')\n  ) {\n    return NextResponse.next()\n  }\n\n  // Check for admin path redirects (only when ?no-redirect is not present)\n  const noRedirect = request.nextUrl.searchParams.get('no-redirect')\n  if (!noRedirect) {\n    // Check exact matches first\n    if (adminRedirects[pathname]) {\n      const url = request.nextUrl.clone()\n      url.pathname = adminRedirects[pathname]\n      return NextResponse.redirect(url, { status: 301 })\n    }\n    \n    // Check for path prefixes\n    for (const [oldPath, newPath] of Object.entries(adminRedirects)) {\n      if (pathname.startsWith(oldPath + '/')) {\n        const remainingPath = pathname.slice(oldPath.length)\n        const url = request.nextUrl.clone()\n        url.pathname = newPath + remainingPath\n        return NextResponse.redirect(url, { status: 301 })\n      }\n    }\n  }\n  \n  // Handle locale prefixes\n  const localePattern = /^\\/(en|fr|es|de|pt|zh|ar|ja|ko|it|nl|ru|pl)(\\/|$)/\n  if (localePattern.test(pathname)) {\n    const newPath = pathname.replace(localePattern, '/')\n    const url = request.nextUrl.clone()\n    url.pathname = newPath || '/'\n    return NextResponse.redirect(url)\n  }\n\n  // Check if route is public\n  const isPublicRoute = PUBLIC_ROUTES.some(route => \n    pathname === route || pathname.startsWith(route + '/') || pathname.startsWith(route)\n  )\n  \n  if (isPublicRoute) {\n    return NextResponse.next()\n  }\n\n  // Check if route requires authentication\n  const isProtectedRoute = PROTECTED_ROUTE_PREFIXES.some(prefix =>\n    pathname.startsWith(prefix)\n  )\n\n  if (isProtectedRoute) {\n    // Auth.js v5 provides the session via request.auth\n    const session = (request as any).auth\n\n    // Check for demo access token in cookies\n    const demoToken = request.cookies.get('demo_access_token')?.value\n\n    // If no regular session and no demo token, redirect to signin\n    if (!session && !demoToken) {\n      const signinUrl = new URL('/auth/signin', request.url)\n      signinUrl.searchParams.set('callbackUrl', pathname)\n      return NextResponse.redirect(signinUrl)\n    }\n\n    // Handle demo user restrictions\n    const isDemo = session?.user?.role === 'demo' || demoToken\n    \n    if (isDemo) {\n      const isRestrictedForDemo = DEMO_RESTRICTED_ROUTES.some(route =>\n        pathname.startsWith(route)\n      )\n\n      if (isRestrictedForDemo) {\n        const dashboardUrl = new URL('/sub-account/dashboard', request.url)\n        dashboardUrl.searchParams.set('restricted', 'demo')\n        return NextResponse.redirect(dashboardUrl)\n      }\n    }\n\n    // Check user status\n    if (session?.user?.status === 'suspended') {\n      const suspendedUrl = new URL('/auth/suspended', request.url)\n      return NextResponse.redirect(suspendedUrl)\n    }\n\n    // Add user info to headers for server components\n    const response = NextResponse.next()\n    \n    if (session?.user) {\n      response.headers.set('x-user-id', session.user.id || '')\n      response.headers.set('x-user-role', session.user.role || '')\n      response.headers.set('x-user-email', session.user.email || '')\n      response.headers.set('x-agency-id', session.user.agencyId || '')\n      \n      if (session.user.isMasterAdmin) {\n        response.headers.set('x-is-master-admin', 'true')\n      }\n    }\n\n    if (demoToken) {\n      response.headers.set('x-demo-token', demoToken)\n      response.headers.set('x-user-role', 'demo')\n    }\n\n    return response\n  }\n\n  return NextResponse.next()\n})\n\n// Configure which paths the middleware runs on\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico).*)',\n  ],\n}\n"],"names":[],"mappings":"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"}}]
}