{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/lib/db.ts"],"sourcesContent":["// Database Connection - Prisma Client Singleton\n// Prevents multiple Prisma Client instances in development\n\nimport { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | null }\n\n// Check if DATABASE_URL is available\nconst hasDatabaseUrl = !!process.env.DATABASE_URL\n\nfunction createPrismaClient(): PrismaClient | null {\n  if (!hasDatabaseUrl) {\n    console.warn('[Prisma] DATABASE_URL not set - database features disabled')\n    return null\n  }\n  \n  try {\n    return new PrismaClient({\n      datasources: {\n        db: {\n          url: process.env.DATABASE_URL,\n        },\n      },\n      log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n    })\n  } catch (error) {\n    console.error('[Prisma] Failed to create client:', error)\n    return null\n  }\n}\n\nexport const prisma: PrismaClient | null =\n  globalForPrisma.prisma ?? createPrismaClient()\n\nif (process.env.NODE_ENV !== 'production' && prisma) {\n  globalForPrisma.prisma = prisma\n}\n\nexport default prisma\n"],"names":[],"mappings":"AAAA,gDAAgD;AAChD,2DAA2D;;;;;;;AAE3D;;AAEA,MAAM;AAEN,qCAAqC;AACrC,MAAM,iBAAiB,CAAC,CAAC,QAAQ,GAAG,CAAC,YAAY;AAEjD,SAAS;IACP,IAAI,CAAC,gBAAgB;QACnB,QAAQ,IAAI,CAAC;QACb,OAAO;IACT;IAEA,IAAI;QACF,OAAO,IAAI,6IAAY,CAAC;YACtB,aAAa;gBACX,IAAI;oBACF,KAAK,QAAQ,GAAG,CAAC,YAAY;gBAC/B;YACF;YACA,KAAK,uCAAyC;gBAAC;gBAAS;aAAO,GAAG;QACpE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO;IACT;AACF;AAEO,MAAM,SACX,gBAAgB,MAAM,IAAI;AAE5B,IAAI,oDAAyB,gBAAgB,QAAQ;IACnD,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from 'next-auth'\nimport CredentialsProvider from 'next-auth/providers/credentials'\nimport { NextResponse } from 'next/server'\n\n// Check if required environment variables are available\nconst hasRequiredEnvVars = !!(\n  process.env.NEXTAUTH_SECRET &&\n  process.env.DATABASE_URL\n)\n\n// Dynamic imports to avoid errors when env vars are missing\nlet prisma: any = null\nlet PrismaAdapter: any = null\nlet bcrypt: any = null\n\nif (hasRequiredEnvVars) {\n  try {\n    prisma = require('@/lib/db').prisma\n    PrismaAdapter = require('@auth/prisma-adapter').PrismaAdapter\n    bcrypt = require('bcryptjs')\n  } catch (e) {\n    console.warn('Failed to load auth dependencies:', e)\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  ...(prisma && PrismaAdapter ? { adapter: PrismaAdapter(prisma) } : {}),\n  providers: [\n    CredentialsProvider({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' }\n      },\n      async authorize(credentials) {\n        // Check if we have database connection\n        if (!prisma || !bcrypt) {\n          console.warn('Auth: Missing database or bcrypt module')\n          return null\n        }\n\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error('Invalid credentials')\n        }\n\n        try {\n          const user = await prisma.user.findUnique({\n            where: { email: credentials.email },\n            include: { agency: true }\n          })\n\n          if (!user || !user.password) {\n            throw new Error('Invalid credentials')\n          }\n\n          const isPasswordValid = await bcrypt.compare(\n            credentials.password,\n            user.password\n          )\n\n          if (!isPasswordValid) {\n            throw new Error('Invalid credentials')\n          }\n\n          return {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            role: user.role,\n            agencyId: user.agencyId,\n            agencyName: user.agency?.name || 'Unknown',\n          }\n        } catch (error) {\n          console.error('Auth error:', error)\n          return null\n        }\n      }\n    })\n  ],\n  pages: {\n    signIn: '/auth/signin',\n    signOut: '/auth/signin',\n    error: '/auth/signin',\n  },\n  session: {\n    strategy: 'jwt',\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id\n        token.role = user.role\n        token.agencyId = user.agencyId\n        token.agencyName = user.agencyName\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string\n        session.user.role = token.role as string\n        session.user.agencyId = token.agencyId as string\n        session.user.agencyName = token.agencyName as string\n      }\n      return session\n    }\n  },\n  secret: process.env.NEXTAUTH_SECRET || 'fallback-secret-for-development-only',\n  debug: process.env.NODE_ENV === 'development',\n}\n\n// Create handler only if we have minimum requirements\nconst handler = NextAuth(authOptions)\n\n// Export handlers with error handling\nexport async function GET(request: Request, context: any) {\n  try {\n    return await handler(request, context)\n  } catch (error) {\n    console.error('NextAuth GET error:', error)\n    return NextResponse.json({ error: 'Authentication service unavailable' }, { status: 503 })\n  }\n}\n\nexport async function POST(request: Request, context: any) {\n  try {\n    return await handler(request, context)\n  } catch (error) {\n    console.error('NextAuth POST error:', error)\n    return NextResponse.json({ error: 'Authentication service unavailable' }, { status: 503 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}