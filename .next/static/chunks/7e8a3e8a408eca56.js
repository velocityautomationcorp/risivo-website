(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44758,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566),l=e.i(50669);function r({params:e}){let{workflowId:r}=(0,t.use)(e),i=(0,a.useRouter)(),[c,n]=(0,t.useState)(null),[d,o]=(0,t.useState)("builder"),[x,m]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[g,f]=(0,t.useState)(null),[b,p]=(0,t.useState)(null),[j,y]=(0,t.useState)([]),[N,w]=(0,t.useState)(!1),[v,k]=(0,t.useState)(""),[E,S]=(0,t.useState)(""),[C,T]=(0,t.useState)(!0),[A,$]=(0,t.useState)(1),D="b0000000-0000-0000-0000-000000000001";(0,t.useEffect)(()=>{W()},[r]),(0,t.useEffect)(()=>{"history"===d&&0===j.length&&F()},[d]);let W=async()=>{m(!0);try{let e=await fetch(`/api/v1/workflows?id=${r}&subAccountId=${D}`),s=await e.json();s.success&&s.data?(n(s.data),k(s.data.name),S(s.data.description||""),T(s.data.allowMultipleExecutions??!0),$(s.data.maxExecutionsPerContact??1)):f("Workflow not found")}catch(e){console.error("Error loading workflow:",e),f("Failed to load workflow")}finally{m(!1)}},F=async()=>{w(!0);try{let e=await fetch(`/api/v1/workflows/${r}/executions?limit=50`),s=await e.json();s.success&&y(s.data||[])}catch(e){console.error("Error loading executions:",e)}finally{w(!1)}},L=async(e,s)=>{h(!0),f(null);try{let t=await fetch("/api/v1/workflows",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,subAccountId:D,name:v,description:E,trigger:e,actions:s.map(e=>({id:e.id,type:e.type,name:e.name,config:e.config,delay:e.delay,continueOnError:e.continueOnError,order:e.order,conditions:e.conditions})),allowMultipleExecutions:C,maxExecutionsPerContact:A})}),a=await t.json();a.success?(p("Workflow saved successfully!"),setTimeout(()=>p(null),3e3),await W()):f(a.error||"Failed to save workflow")}catch(e){console.error("[WorkflowEditPage] Error saving workflow:",e),f("Failed to save workflow")}finally{h(!1)}},P=async()=>{h(!0),f(null);try{let e=await fetch("/api/v1/workflows",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,subAccountId:D,name:v,description:E,allowMultipleExecutions:C,maxExecutionsPerContact:A})}),s=await e.json();s.success?(p("Settings saved!"),setTimeout(()=>p(null),3e3),W()):f(s.error||"Failed to save settings")}catch(e){console.error("Error saving settings:",e),f("Failed to save settings")}finally{h(!1)}},M=async()=>{if(!c)return;let e="active"===c.status?"inactive":"active";try{let s=await fetch("/api/v1/workflows",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,subAccountId:D,status:e})});(await s.json()).success&&(p(`Workflow ${"active"===e?"activated":"deactivated"}!`),setTimeout(()=>p(null),3e3),W())}catch(e){console.error("Error toggling status:",e)}},O=async()=>{if(confirm("Are you sure you want to delete this workflow? This action cannot be undone."))try{let e=await fetch(`/api/v1/workflows?id=${r}&subAccountId=${D}&permanent=true`,{method:"DELETE"}),s=await e.json();s.success?i.push("/sub-account/accelerators"):f(s.error||"Failed to delete workflow")}catch(e){console.error("Error deleting workflow:",e),f("Failed to delete workflow")}},R=()=>{i.push("/sub-account/accelerators")};return x?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading workflow..."})]})}):g&&!c?(0,s.jsxs)("div",{className:"max-w-2xl mx-auto py-12 px-4 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("i",{className:"fas fa-exclamation-triangle text-red-600 text-2xl"})}),(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Workflow Not Found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:g}),(0,s.jsx)("button",{onClick:()=>i.push("/sub-account/accelerators"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Workflows"})]}):c?(0,s.jsxs)("div",{className:"min-h-[calc(100vh-200px)] flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-white border-b px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:R,className:"text-gray-600 hover:text-gray-800",children:(0,s.jsx)("i",{className:"fas fa-arrow-left"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:c.name}),(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"draft":return"bg-yellow-100 text-yellow-800"}})(c.status)}`,children:c.status})]}),c.description&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:c.description})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)("button",{onClick:M,className:`px-4 py-2 rounded-lg flex items-center gap-2 ${"active"===c.status?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[(0,s.jsx)("i",{className:`fas fa-${"active"===c.status?"pause":"play"}`}),"active"===c.status?"Deactivate":"Activate"]})})]}),(0,s.jsx)("div",{className:"flex gap-6 mt-4 -mb-4",children:[{id:"builder",label:"Builder",icon:"project-diagram"},{id:"history",label:"Execution History",icon:"history"},{id:"analytics",label:"Analytics",icon:"chart-line"},{id:"settings",label:"Settings",icon:"cog"}].map(e=>(0,s.jsxs)("button",{onClick:()=>o(e.id),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${d===e.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[(0,s.jsx)("i",{className:`fas fa-${e.icon} mr-2`}),e.label]},e.id))})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden min-h-[500px]",children:["builder"===d&&(0,s.jsx)(l.default,{workflowId:r,initialTrigger:c.trigger,initialActions:c.actions,onSave:L,onCancel:R},`${r}-${c.version||0}`),"history"===d&&(0,s.jsx)("div",{className:"p-6 overflow-y-auto h-full",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Execution History"}),(0,s.jsxs)("button",{onClick:F,className:"text-blue-600 hover:text-blue-700 text-sm flex items-center gap-2",children:[(0,s.jsx)("i",{className:"fas fa-sync-alt"}),"Refresh"]})]}),N?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Loading executions..."})]}):0===j.length?(0,s.jsxs)("div",{className:"text-center py-12 bg-white rounded-xl border",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("i",{className:"fas fa-history text-gray-400 text-2xl"})}),(0,s.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No executions yet"}),(0,s.jsx)("p",{className:"text-gray-500",children:"When this workflow runs, execution history will appear here."})]}):(0,s.jsx)("div",{className:"bg-white rounded-xl border divide-y",children:j.map(e=>(0,s.jsxs)("div",{className:"p-4 hover:bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"running":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status)}`,children:e.status}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.triggerType.replace(/_/g," ")}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.triggeredAt).toLocaleString()})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[e.actionResults?.length||0," actions"]}),e.completedAt&&(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Duration: ",Math.round((new Date(e.completedAt).getTime()-new Date(e.startedAt).getTime())/1e3),"s"]})]})]}),e.errorMessage&&(0,s.jsx)("div",{className:"mt-3 p-3 bg-red-50 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-red-600",children:[(0,s.jsx)("i",{className:"fas fa-exclamation-circle mr-2"}),e.errorMessage]})})]},e.id))})]})}),"analytics"===d&&(0,s.jsx)("div",{className:"p-6 overflow-y-auto h-full",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Workflow Analytics"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)("div",{className:"bg-white rounded-xl border p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("i",{className:"fas fa-rocket text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:c.totalExecutions}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Total Runs"})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl border p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("i",{className:"fas fa-check text-green-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:c.successfulExecutions}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Successful"})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl border p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("i",{className:"fas fa-times text-red-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:c.failedExecutions}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Failed"})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl border p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("i",{className:"fas fa-percentage text-purple-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[c.totalExecutions>0?Math.round(c.successfulExecutions/c.totalExecutions*100):0,"%"]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Success Rate"})]})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Workflow Performance"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Last Executed"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:c.lastExecutedAt?new Date(c.lastExecutedAt).toLocaleString():"Never"})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Created"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:new Date(c.createdAt).toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Last Updated"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:new Date(c.updatedAt).toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Version"}),(0,s.jsxs)("span",{className:"font-medium text-gray-900",children:["v",c.version]})]})]})]})]})}),"settings"===d&&(0,s.jsx)("div",{className:"p-6 overflow-y-auto h-full",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Workflow Settings"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Basic Information"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,s.jsx)("input",{type:"text",value:v,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)("textarea",{value:E,onChange:e=>S(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Execution Settings"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:"Allow Multiple Executions"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Allow same contact to trigger multiple times"})]}),(0,s.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:C,onChange:e=>T(e.target.checked),className:"sr-only peer"}),(0,s.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),C&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Executions Per Contact"}),(0,s.jsx)("input",{type:"number",min:"1",value:A,onChange:e=>$(parseInt(e.target.value)||1),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"0 = unlimited"})]})]})]}),(0,s.jsx)("div",{className:"flex justify-end gap-3",children:(0,s.jsxs)("button",{onClick:P,disabled:u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[u&&(0,s.jsx)("i",{className:"fas fa-spinner fa-spin"}),"Save Settings"]})}),(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-red-800 mb-2",children:"Danger Zone"}),(0,s.jsx)("p",{className:"text-sm text-red-600 mb-4",children:"Deleting this workflow is permanent and cannot be undone."}),(0,s.jsxs)("button",{onClick:O,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2",children:[(0,s.jsx)("i",{className:"fas fa-trash"}),"Delete Workflow"]})]})]})})]}),b&&(0,s.jsx)("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg z-50",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("i",{className:"fas fa-check-circle"}),(0,s.jsx)("span",{children:b})]})}),g&&(0,s.jsx)("div",{className:"fixed bottom-4 right-4 bg-red-600 text-white px-4 py-3 rounded-lg shadow-lg z-50",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("i",{className:"fas fa-exclamation-circle"}),(0,s.jsx)("span",{children:g}),(0,s.jsx)("button",{onClick:()=>f(null),className:"ml-2",children:(0,s.jsx)("i",{className:"fas fa-times"})})]})}),u&&"builder"===d&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-8 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Saving workflow..."})]})})]}):null}e.s(["default",()=>r])}]);